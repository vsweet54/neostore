<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>NeoStore Premium</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyACbPIgufXB1kUR2gSnHLqkhHggc_UVHb8",
      authDomain: "neostore-770c6.firebaseapp.com",
      projectId: "neostore-770c6",
      storageBucket: "neostore-770c6.firebasestorage.app",
      messagingSenderId: "1025091375713",
      appId: "1:1025091375713:web:a010e86c6f8c0527159020"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window._fb = {
      db,
      ordersRef: collection(db, "orders"),
      testiRef: collection(db, "testimoni"),
      produksRef: collection(db, "produks"),
      settingsRef: collection(db, "settings"),
      addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy, getDocs
    };
    window.dispatchEvent(new Event('firebase-ready'));
  </script>

  <style>
    :root {
      --neon: #00ffe1;
      --neon-glow: 0 0 20px rgba(0,255,225,0.6), 0 0 60px rgba(0,255,225,0.2);
      --bg1: #040c12;
      --border: rgba(0,255,225,0.16);
      --text: #cde8f0;
      --red: #ff4d6d;
      --orange: #ffa94d;
      --green: #69db7c;
      --yellow: #ffd43b;
      --card-bg: rgba(7,21,32,0.85);
      --nav-h: 60px;
      --bottom-h: 70px;
    }

    * { box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent; }
    html { scroll-behavior:smooth; }
    body { font-family:'Rajdhani',sans-serif;background:var(--bg1);color:var(--text);overflow-x:hidden;min-height:100vh;padding-bottom:var(--bottom-h); }

    #matrixCanvas { position:fixed;inset:0;z-index:0;pointer-events:none;opacity:0.1; }
    #particleCanvas { position:fixed;inset:0;z-index:1;pointer-events:none; }
    .bg-overlay { position:fixed;inset:0;background:radial-gradient(ellipse at 20% 50%,rgba(0,255,225,0.06) 0%,transparent 60%),radial-gradient(ellipse at 80% 30%,rgba(0,150,255,0.04) 0%,transparent 60%);z-index:1;pointer-events:none; }

    /* ══ SPLASH SCREEN ══ */
    #splashScreen {
      position: fixed; inset: 0; z-index: 99999;
      background: var(--bg1);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      transition: opacity 0.6s ease;
    }
    .splash-logo {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(32px,8vw,60px);
      font-weight: 900; color: var(--neon);
      letter-spacing: 6px;
      text-shadow: var(--neon-glow);
      animation: splashPulse 1.2s ease infinite;
      margin-bottom: 12px;
    }
    @keyframes splashPulse {
      0%,100% { text-shadow: 0 0 20px rgba(0,255,225,0.6),0 0 60px rgba(0,255,225,0.2); }
      50% { text-shadow: 0 0 40px rgba(0,255,225,1),0 0 100px rgba(0,255,225,0.5); }
    }
    .splash-sub {
      font-family: 'Share Tech Mono', monospace;
      font-size: 12px; letter-spacing: 4px;
      color: rgba(0,255,225,0.4); margin-bottom: 40px;
    }
    .splash-bar-wrap {
      width: 200px; height: 3px;
      background: rgba(0,255,225,0.1);
      border-radius: 2px; overflow: hidden;
    }
    .splash-bar {
      height: 100%; width: 0%;
      background: linear-gradient(90deg, var(--neon), #00b0ff);
      border-radius: 2px;
      box-shadow: 0 0 10px rgba(0,255,225,0.6);
      transition: width 0.1s linear;
    }
    .splash-pct {
      font-family: 'Share Tech Mono', monospace;
      font-size: 11px; color: rgba(0,255,225,0.4);
      margin-top: 10px; letter-spacing: 2px;
    }

    /* ══ KONFETI ══ */
    #konfeti { position:fixed;inset:0;z-index:9990;pointer-events:none;overflow:hidden; }
    .konfeti-piece {
      position: absolute; top: -20px;
      width: 10px; height: 10px;
      border-radius: 2px;
      animation: konfetiFall linear forwards;
    }
    @keyframes konfetiFall {
      0% { transform: translateY(0) rotate(0deg) scale(1); opacity:1; }
      80% { opacity:1; }
      100% { transform: translateY(110vh) rotate(720deg) scale(0.5); opacity:0; }
    }

    /* ══ TOP NAV ══ */
    .top-nav { position:fixed;top:0;left:0;right:0;height:var(--nav-h);background:rgba(4,12,18,0.95);backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,255,225,0.1);display:flex;align-items:center;justify-content:space-between;padding:0 18px;z-index:100; }
    .nav-logo { font-family:'Orbitron',sans-serif;font-size:16px;font-weight:900;color:var(--neon);letter-spacing:3px;text-shadow:var(--neon-glow);cursor:pointer;user-select:none;position:relative;padding:10px 4px;z-index:102; }
    .tap-dots { display:flex;gap:4px;position:absolute;bottom:-2px;left:50%;transform:translateX(-50%); }
    .tap-dot { width:4px;height:4px;border-radius:50%;background:rgba(0,255,225,0.25);transition:all 0.2s; }
    .tap-dot.active { background:var(--neon);transform:scale(1.3);box-shadow:0 0 6px var(--neon); }
    .nav-right { display:flex;align-items:center;gap:10px; }
    .fb-status { display:flex;align-items:center;gap:6px;font-family:'Share Tech Mono',monospace;font-size:10px;letter-spacing:1px; }
    .fb-dot { width:8px;height:8px;border-radius:50%;background:var(--orange);box-shadow:0 0 8px var(--orange);animation:blink 1.2s ease infinite; }
    .fb-dot.connected { background:var(--green);box-shadow:0 0 8px var(--green);animation:none; }
    .fb-dot.error { background:var(--red);box-shadow:0 0 8px var(--red);animation:none; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

    .nav-cart-btn {
      position: relative; background: rgba(0,255,225,0.08);
      border: 1px solid rgba(0,255,225,0.2); border-radius: 10px;
      padding: 7px 12px; cursor: pointer;
      font-size: 16px; color: var(--neon);
      transition: all 0.2s;
    }
    .nav-cart-btn:active { background: rgba(0,255,225,0.15); }
    .nav-cart-count {
      position: absolute; top: -6px; right: -6px;
      background: var(--red); color: #fff;
      font-family: 'Orbitron', sans-serif;
      font-size: 8px; font-weight: 700;
      min-width: 16px; height: 16px;
      border-radius: 8px; display: flex;
      align-items: center; justify-content: center;
      padding: 0 4px;
    }

    /* ══ BOTTOM NAV ══ */
    .bottom-nav { position:fixed;bottom:0;left:0;right:0;height:var(--bottom-h);background:rgba(4,12,18,0.97);backdrop-filter:blur(20px);border-top:1px solid rgba(0,255,225,0.1);display:flex;z-index:100; }
    .bottom-tab { flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;transition:all 0.2s;border:none;background:transparent;color:rgba(255,255,255,0.3);padding-bottom:env(safe-area-inset-bottom);position:relative; }
    .bottom-tab.active { color:var(--neon); }
    .tab-icon { font-size:20px;line-height:1; }
    .tab-label { font-family:'Orbitron',sans-serif;font-size:7px;letter-spacing:2px;text-transform:uppercase; }
    .tab-badge { position:absolute;top:8px;right:calc(50% - 18px);background:var(--red);color:#fff;font-family:'Orbitron',sans-serif;font-size:8px;font-weight:700;min-width:16px;height:16px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0 4px; }

    /* ══ PAGES ══ */
    .page { position:relative;z-index:5;padding-top:var(--nav-h);display:none; }
    .page.active { display:block; }

    /* ══ STORE ══ */
    header { padding:36px 20px 16px;text-align:center;animation:slideDown 0.8s cubic-bezier(0.22,1,0.36,1) forwards; }
    .logo-wrap { display:inline-block;position:relative; }
    .logo-wrap::before { content:'NEOSTORE⚡';position:absolute;inset:0;color:var(--neon);filter:blur(20px);opacity:0.5;pointer-events:none; }
    header h1 { font-family:'Orbitron',sans-serif;font-size:clamp(26px,7vw,52px);font-weight:900;color:var(--neon);letter-spacing:5px;text-shadow:var(--neon-glow); }
    .tagline { font-size:11px;letter-spacing:4px;color:rgba(0,255,225,0.4);margin-top:6px;font-family:'Share Tech Mono',monospace; }
    .header-line { width:100px;height:2px;background:linear-gradient(90deg,transparent,var(--neon),transparent);margin:14px auto 0; }
    .section-title { font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:4px;color:rgba(0,255,225,0.4);text-align:center;margin:28px 0 14px;text-transform:uppercase; }

    /* ══ COUNTDOWN TIMER ══ */
    .promo-banner { max-width: 700px; margin: 0 auto 0; padding: 0 14px; }
    .promo-box {
      background: linear-gradient(135deg, rgba(255,77,109,0.12), rgba(255,169,77,0.08));
      border: 1px solid rgba(255,100,130,0.3);
      border-radius: 14px; padding: 14px 18px;
      display: flex; align-items: center;
      justify-content: space-between; gap: 12px;
      flex-wrap: wrap;
    }
    .promo-left { display: flex; align-items: center; gap: 10px; }
    .promo-emoji { font-size: 24px; }
    .promo-text-label { font-family: 'Orbitron', sans-serif; font-size: 10px; letter-spacing: 2px; color: var(--red); text-transform: uppercase; margin-bottom: 2px; }
    .promo-text-sub { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: rgba(255,255,255,0.4); letter-spacing: 1px; }
    .countdown-wrap { display: flex; gap: 6px; align-items: center; }
    .cd-unit { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,100,130,0.25); border-radius: 8px; padding: 6px 10px; text-align: center; min-width: 44px; }
    .cd-num { font-family: 'Orbitron', sans-serif; font-size: 18px; font-weight: 700; color: var(--red); line-height: 1; display: block; }
    .cd-lbl { font-family: 'Share Tech Mono', monospace; font-size: 8px; color: rgba(255,255,255,0.25); letter-spacing: 1px; display: block; margin-top: 2px; }
    .cd-sep { font-family: 'Orbitron', sans-serif; font-size: 18px; color: rgba(255,100,130,0.4); line-height: 1; padding-bottom: 10px; }

    /* ══ SEARCH & FILTER ══ */
    .search-filter-wrap { max-width: 700px; margin: 16px auto 0; padding: 0 14px; display: flex; gap: 8px; align-items: center; }
    .search-input {
      flex: 1; background: rgba(0,0,0,0.3);
      border: 1px solid rgba(0,255,225,0.16);
      border-radius: 10px; padding: 11px 14px 11px 38px;
      font-size: 14px; font-family: 'Rajdhani', sans-serif;
      font-weight: 500; color: #fff; outline: none;
      transition: border-color 0.3s;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='rgba(0,255,225,0.4)' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: 12px center;
    }
    .search-input:focus { border-color: rgba(0,255,225,0.5); }
    .search-input::placeholder { color: rgba(255,255,255,0.2); }
    .filter-sort { background: rgba(0,0,0,0.3); border: 1px solid rgba(0,255,225,0.16); border-radius: 10px; padding: 11px 14px; font-size: 13px; font-family: 'Rajdhani', sans-serif; color: #fff; outline: none; cursor: pointer; -webkit-appearance: none; }
    .filter-sort option { background: #071520; }

    /* ══ FLASH SALE BADGE & PROMO PRICE ══ */
    .card-sale-badge {
      position: absolute; top: 8px; left: 8px;
      background: linear-gradient(135deg, #ff4d6d, #ff8c00);
      color: #fff; font-family: 'Orbitron', sans-serif;
      font-size: 8px; font-weight: 700; padding: 3px 8px;
      border-radius: 5px; letter-spacing: 1px;
      box-shadow: 0 0 12px rgba(255,77,109,0.6);
      animation: salePulse 1.5s ease infinite;
      z-index: 10;
    }
    @keyframes salePulse {
      0%,100% { box-shadow: 0 0 12px rgba(255,77,109,0.6); }
      50%      { box-shadow: 0 0 24px rgba(255,77,109,1); }
    }
    .card-price-ori {
      font-family: 'Share Tech Mono', monospace;
      font-size: 10px; color: rgba(255,255,255,0.35);
      text-decoration: line-through; display: block;
      margin-bottom: 1px;
    }
    .card-price.sale {
      color: #ff4d6d !important;
      text-shadow: 0 0 10px rgba(255,77,109,0.6) !important;
    }
    .pac-promo-tag {
      display: inline-block;
      background: linear-gradient(135deg,#ff4d6d,#ff8c00);
      color: #fff; font-family: 'Orbitron', sans-serif;
      font-size: 7px; font-weight: 700; padding: 2px 6px;
      border-radius: 4px; letter-spacing: 1px; margin-bottom: 4px;
    }

    /* ══ PRODUK CARDS ══ */
    .card-container { display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:0 14px;max-width:700px;margin:14px auto 0; }
    @media(max-width:500px){ .card-container{grid-template-columns:1fr 1fr;} }

    /* Flash Sale section */
    .flash-section-wrap { max-width:700px;margin:24px auto 0;padding:0 14px; }
    .flash-section-title {
      display:flex;align-items:center;gap:10px;margin-bottom:12px;
      font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;
      letter-spacing:3px;color:#ff4d6d;text-transform:uppercase;
      text-shadow:0 0 12px rgba(255,77,109,0.7);
    }
    .flash-section-title::before { content:''; flex:0 0 3px;height:18px;background:linear-gradient(180deg,#ff4d6d,#ff8c00);border-radius:2px;box-shadow:0 0 8px rgba(255,77,109,0.8); }
    .flash-section-title::after { content:''; flex:1;height:1px;background:linear-gradient(90deg,rgba(255,77,109,0.4),transparent); }
    .flash-grid { display:grid;grid-template-columns:repeat(2,1fr);gap:10px; }
    @media(min-width:501px){ .flash-grid{grid-template-columns:repeat(3,1fr);} }
    @media(min-width:769px){ .flash-grid{grid-template-columns:repeat(4,1fr);} }

    /* Regular section */
    .regular-section-wrap { max-width:700px;margin:24px auto 0;padding:0 14px; }
    .regular-section-title {
      display:flex;align-items:center;gap:10px;margin-bottom:12px;
      font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;
      letter-spacing:3px;color:rgba(0,255,225,0.5);text-transform:uppercase;
    }
    .regular-section-title::before { content:''; flex:0 0 3px;height:18px;background:linear-gradient(180deg,rgba(0,255,225,0.6),rgba(0,180,255,0.3));border-radius:2px; }
    .regular-section-title::after { content:''; flex:1;height:1px;background:linear-gradient(90deg,rgba(0,255,225,0.2),transparent); }
    .regular-grid { display:grid;grid-template-columns:repeat(3,1fr);gap:10px; }
    @media(max-width:500px){ .regular-grid{grid-template-columns:1fr 1fr;} }

    .card {
      position:relative;background:rgba(255,255,255,0.03);border:1px solid var(--border);
      border-radius:14px;overflow:hidden;aspect-ratio:1/1.25;cursor:pointer;
      transition:transform 0.45s cubic-bezier(0.34,1.56,0.64,1),
                 box-shadow 0.4s cubic-bezier(0.22,1,0.36,1),
                 border-color 0.3s ease;
      animation:fadeUp 0.55s cubic-bezier(0.22,1,0.36,1) both;
      will-change:transform;
    }
    .card:nth-child(1){animation-delay:.04s}.card:nth-child(2){animation-delay:.08s}
    .card:nth-child(3){animation-delay:.12s}.card:nth-child(4){animation-delay:.16s}
    .card:nth-child(5){animation-delay:.20s}.card:nth-child(6){animation-delay:.24s}
    .card:nth-child(7){animation-delay:.28s}.card:nth-child(8){animation-delay:.32s}
    .card:nth-child(9){animation-delay:.36s}.card:nth-child(10){animation-delay:.40s}
    .card:nth-child(11){animation-delay:.44s}.card:nth-child(12){animation-delay:.48s}
    @media(hover:hover){
      .card:hover { transform:translateY(-7px) scale(1.028); box-shadow:0 20px 50px rgba(0,0,0,0.55),0 0 0 1px rgba(0,255,225,0.12); }
      .card:hover .card-img { transform:scale(1.08); }
    }
    .card:active{transform:scale(0.96);}
    .card.selected{border-color:var(--neon);box-shadow:0 0 0 2px var(--neon),0 10px 40px rgba(0,255,225,0.25);}
    .card.out-of-stock { opacity:0.5; pointer-events:none; }

    /* Shimmer sweep on hover */
    .card::after {
      content:'';position:absolute;inset:0;
      background:linear-gradient(115deg,transparent 30%,rgba(255,255,255,0.07) 50%,transparent 70%);
      transform:translateX(-110%);transition:transform 0.55s ease;pointer-events:none;z-index:3;
    }
    @media(hover:hover){ .card:hover::after { transform:translateX(120%); } }

    .card-img{position:absolute;inset:0;background-size:cover;background-position:center;transition:transform 0.55s cubic-bezier(0.22,1,0.36,1);}
    .card.selected .card-img{transform:scale(1.05);}
    .card-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(4,12,18,0.95) 0%,rgba(4,12,18,0.15) 55%,transparent 100%);}
    .card-content{position:absolute;bottom:0;left:0;right:0;padding:10px 12px;}
    .card-name{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;letter-spacing:1px;color:rgba(255,255,255,0.55);text-transform:uppercase;margin-bottom:2px;}
    .card-price{font-family:'Orbitron',sans-serif;font-size:15px;font-weight:700;color:var(--neon);text-shadow:0 0 10px rgba(0,255,225,0.5);transition:all 0.4s;}
    .card-price.animating { color:#fff;text-shadow:0 0 20px rgba(255,255,255,0.8);transform:scale(1.1); }
    .card-sold { font-family: 'Share Tech Mono', monospace; font-size: 9px; color: rgba(255,255,255,0.3); letter-spacing: 0.5px; margin-top: 2px; }
    .card-select-badge{position:absolute;top:8px;right:8px;background:var(--neon);color:#040c12;font-family:'Orbitron',sans-serif;font-size:7px;font-weight:700;padding:3px 7px;border-radius:5px;opacity:0;transform:scale(0.7);transition:all 0.2s;}
    .card.selected .card-select-badge{opacity:1;transform:scale(1);}
    .card-stok-badge { position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.7); border-radius: 5px; padding: 3px 7px; font-family: 'Orbitron', sans-serif; font-size: 7px; font-weight: 700; letter-spacing: 1px; }
    .stok-ok { color: var(--green); border: 1px solid rgba(105,219,124,0.3); }
    .stok-low { color: var(--orange); border: 1px solid rgba(255,169,77,0.3); }
    .stok-empty { color: var(--red); border: 1px solid rgba(255,77,109,0.3); }
    .card-cart-btn {
      position: absolute; bottom: 50px; right: 8px; width: 32px; height: 32px;
      border-radius: 50%; background: rgba(0,255,225,0.15); border: 1px solid rgba(0,255,225,0.4);
      display: flex; align-items: center; justify-content: center; font-size: 14px;
      cursor: pointer; z-index: 5;
      opacity: 1; transform: translateY(0);
      transition: opacity 0.25s ease, transform 0.35s cubic-bezier(0.34,1.56,0.64,1), background 0.2s;
    }
    /* Di desktop (hover capable): sembunyikan dulu, tampil saat hover */
    @media(hover:hover){
      .card-cart-btn { opacity: 0; transform: translateY(6px); }
      .card:hover .card-cart-btn { opacity: 1; transform: translateY(0); }
    }
    .card-cart-btn:active { transform: scale(0.9) !important; background: rgba(0,255,225,0.3); }

    /* ══ KERANJANG ══ */
    #cartPopup { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(16px); z-index: 500; justify-content: flex-end; align-items: flex-end; }
    .cart-box { background: rgba(7,21,32,0.99); border: 1px solid rgba(0,255,225,0.2); border-radius: 24px 24px 0 0; padding: 24px 18px 36px; width: 100%; max-width: 480px; animation: slideUp 0.4s cubic-bezier(0.22,1,0.36,1); max-height: 85vh; overflow-y: auto; }
    .cart-handle { width:40px;height:4px;background:rgba(255,255,255,0.15);border-radius:2px;margin:0 auto 20px; }
    .cart-title { font-family: 'Orbitron', sans-serif; font-size: 14px; letter-spacing: 3px; color: var(--neon); margin-bottom: 16px; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; }
    .cart-empty { text-align: center; padding: 30px; font-family: 'Share Tech Mono', monospace; font-size: 12px; color: rgba(255,255,255,0.2); letter-spacing: 2px; }
    .cart-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid rgba(0,255,225,0.07); }
    .cart-item-img { width: 50px; height: 50px; border-radius: 10px; background-size: cover; background-position: center; background-color: rgba(0,255,225,0.05); flex-shrink: 0; border: 1px solid rgba(0,255,225,0.15); }
    .cart-item-info { flex: 1; min-width: 0; }
    .cart-item-name { font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 700; color: #fff; margin-bottom: 3px; text-transform: uppercase; letter-spacing: 0.5px; }
    .cart-item-price { font-family: 'Rajdhani', sans-serif; font-size: 14px; color: var(--neon); font-weight: 600; }
    .cart-qty-wrap { display:flex;align-items:center;gap:8px;flex-shrink:0; }
    .cart-qty-btn { width: 28px; height: 28px; border-radius: 50%; border: 1px solid rgba(0,255,225,0.3); background: transparent; color: var(--neon); font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .cart-qty-btn:active { background: rgba(0,255,225,0.1); }
    .cart-qty-num { font-family: 'Orbitron', sans-serif; font-size: 14px; color: #fff; min-width: 20px; text-align: center; }
    .cart-remove { width: 28px; height: 28px; border-radius: 50%; border: 1px solid rgba(255,77,109,0.3); background: transparent; color: var(--red); font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .cart-total-row { display: flex; justify-content: space-between; align-items: center; padding: 16px 0 12px; margin-top: 4px; border-top: 1px solid rgba(0,255,225,0.1); }
    .cart-total-label { font-family: 'Orbitron', sans-serif; font-size: 10px; letter-spacing: 2px; color: rgba(0,255,225,0.4); text-transform: uppercase; }
    .cart-total-val { font-family: 'Orbitron', sans-serif; font-size: 22px; font-weight: 700; color: var(--neon); text-shadow: var(--neon-glow); }
    .btn-checkout { width: 100%; padding: 16px; background: linear-gradient(135deg,#00ffe1,#00b0a2); border: none; border-radius: 12px; font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 12px; letter-spacing: 2px; color: #040c12; cursor: pointer; text-transform: uppercase; transition: all 0.2s; }
    .btn-checkout:active { transform: scale(0.97); }
    .btn-cart-close { background: transparent; border: none; color: rgba(255,255,255,0.3); font-size: 20px; cursor: pointer; }

    /* ══ FORM ORDER ══ */
    .order-section{max-width:480px;margin:20px auto;padding:0 14px 20px;}
    .form-card{background:var(--card-bg);border:1px solid var(--border);border-radius:18px;padding:22px 18px;backdrop-filter:blur(20px);box-shadow:0 30px 60px rgba(0,0,0,0.4),inset 0 1px 0 rgba(0,255,225,0.06);}
    .form-title{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:3px;color:var(--neon);margin-bottom:18px;padding-bottom:12px;border-bottom:1px solid var(--border);text-transform:uppercase;display:flex;align-items:center;gap:8px;}
    .cart-summary-banner { background: rgba(0,255,225,0.04); border: 1px solid rgba(0,255,225,0.12); border-radius: 12px; padding: 12px 14px; margin-bottom: 14px; display: none; }
    .cart-summary-banner.visible { display: block; }
    .csb-title { font-family: 'Orbitron', sans-serif; font-size: 9px; letter-spacing: 2px; color: rgba(0,255,225,0.4); text-transform: uppercase; margin-bottom: 8px; }
    .csb-item { display: flex; justify-content: space-between; font-size: 13px; color: rgba(255,255,255,0.65); padding: 3px 0; }
    .csb-total { display: flex; justify-content: space-between; font-family: 'Orbitron', sans-serif; font-size: 15px; font-weight: 700; color: var(--neon); padding-top: 8px; margin-top: 6px; border-top: 1px solid rgba(0,255,225,0.1); }
    .selected-product-banner{display:none;background:rgba(0,255,225,0.06);border:1px solid rgba(0,255,225,0.18);border-radius:10px;padding:11px 14px;margin-bottom:16px;font-size:14px;color:var(--neon);font-weight:600;justify-content:space-between;align-items:center;}
    .selected-product-banner.visible{display:flex;}
    .input-row{margin-bottom:12px;}
    .input-label{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:rgba(0,255,225,0.38);margin-bottom:5px;display:block;font-family:'Orbitron',sans-serif;}
    .input-field{width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,225,0.16);border-radius:10px;padding:13px 14px;font-size:16px;font-family:'Rajdhani',sans-serif;font-weight:500;color:#fff;outline:none;transition:border-color 0.3s;-webkit-appearance:none;}
    .input-field:focus{border-color:rgba(0,255,225,0.5);}
    .input-field option{background:#071520;}
    .total-display{background:rgba(0,255,225,0.04);border:1px solid rgba(0,255,225,0.13);border-radius:12px;padding:14px 16px;margin:14px 0 12px;display:flex;justify-content:space-between;align-items:center;}
    .total-label{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:rgba(0,255,225,0.42);text-transform:uppercase;}
    .total-amount{font-family:'Orbitron',sans-serif;font-size:22px;font-weight:700;color:var(--neon);text-shadow:var(--neon-glow);transition:all 0.4s;}
    .total-amount.pop { transform:scale(1.15);color:#fff; }
    .summary-box{display:none;background:rgba(0,0,0,0.25);border-left:3px solid var(--neon);border-radius:0 10px 10px 0;padding:11px 13px;margin-bottom:12px;font-size:13px;line-height:1.85;color:rgba(255,255,255,0.68);}
    .summary-box.visible{display:block;}
    .id-box{display:flex;align-items:center;gap:8px;background:rgba(0,0,0,0.2);border:1px dashed rgba(0,255,225,0.2);border-radius:10px;padding:9px 13px;margin-bottom:16px;font-size:11px;color:rgba(0,255,225,0.6);font-family:'Share Tech Mono',monospace;}
    .btn-order{width:100%;padding:17px;background:linear-gradient(135deg,#00ffe1,#00b0a2);border:none;border-radius:12px;font-family:'Orbitron',sans-serif;font-weight:700;font-size:13px;letter-spacing:2px;color:#040c12;cursor:pointer;transition:all 0.25s;text-transform:uppercase;}
    .btn-order:active{transform:scale(0.97);}
    .btn-order:disabled{opacity:0.5;}
    .divider{display:flex;align-items:center;gap:12px;margin:22px 0 18px;color:rgba(0,255,225,0.2);font-size:9px;font-family:'Orbitron',sans-serif;letter-spacing:3px;}
    .divider::before,.divider::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent,rgba(0,255,225,0.15),transparent);}
    .btn-cek{width:100%;padding:13px;background:transparent;border:1px solid rgba(0,255,225,0.28);border-radius:12px;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;color:var(--neon);cursor:pointer;margin-top:10px;transition:all 0.2s;text-transform:uppercase;}
    .btn-cek:active{background:rgba(0,255,225,0.06);}
    .hasil-cek{margin-top:10px;padding:12px 13px;border-radius:10px;font-size:13px;background:rgba(0,0,0,0.25);border:1px solid rgba(0,255,225,0.07);min-height:42px;font-family:'Share Tech Mono',monospace;}

    /* ══ PAYMENT METHOD ══ */
    .payment-card { display:none; border-radius:14px; padding:16px 18px; margin-bottom:12px; animation:fadeUp 0.3s ease; position:relative; overflow:hidden; }
    .payment-card.visible { display:block; }
    .payment-card.dana  { background:linear-gradient(135deg,rgba(0,100,255,0.12),rgba(0,60,200,0.06)); border:1px solid rgba(0,120,255,0.3); }
    .payment-card.ovo   { background:linear-gradient(135deg,rgba(120,0,200,0.12),rgba(80,0,160,0.06)); border:1px solid rgba(130,0,220,0.3); }
    .payment-card.gopay { background:linear-gradient(135deg,rgba(0,180,80,0.12),rgba(0,140,60,0.06)); border:1px solid rgba(0,200,80,0.3); }
    .payment-card.qris  { background:linear-gradient(135deg,rgba(0,255,225,0.08),rgba(0,180,200,0.04)); border:1px solid rgba(0,255,225,0.25); }
    .pm-header { display:flex; align-items:center; gap:10px; margin-bottom:12px; }
    .pm-logo { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:18px; flex-shrink:0; }
    .dana .pm-logo{background:rgba(0,100,255,0.2);}.ovo .pm-logo{background:rgba(120,0,200,0.2);}.gopay .pm-logo{background:rgba(0,180,80,0.2);}.qris .pm-logo{background:rgba(0,255,225,0.12);}
    .pm-name { font-family:'Orbitron',sans-serif; font-size:13px; font-weight:700; letter-spacing:2px; }
    .dana .pm-name{color:#4d9fff;}.ovo .pm-name{color:#c084fc;}.gopay .pm-name{color:#4ade80;}.qris .pm-name{color:var(--neon);}
    .pm-divider { height:1px; margin-bottom:12px; }
    .dana .pm-divider{background:rgba(0,100,255,0.15);}.ovo .pm-divider{background:rgba(120,0,200,0.15);}.gopay .pm-divider{background:rgba(0,180,80,0.15);}.qris .pm-divider{background:rgba(0,255,225,0.1);}
    .pm-label { font-family:'Orbitron',sans-serif; font-size:8px; letter-spacing:2px; color:rgba(255,255,255,0.3); text-transform:uppercase; margin-bottom:4px; }
    .pm-number { font-family:'Share Tech Mono',monospace; font-size:20px; font-weight:700; color:#fff; letter-spacing:2px; margin-bottom:4px; }
    .pm-name-rek { font-size:13px; color:rgba(255,255,255,0.5); font-family:'Rajdhani',sans-serif; font-weight:500; margin-bottom:14px; }
    .btn-copy { width:100%; padding:11px; border-radius:10px; cursor:pointer; font-family:'Orbitron',sans-serif; font-size:10px; letter-spacing:2px; font-weight:700; transition:all 0.2s; text-transform:uppercase; border:none; }
    .dana .btn-copy{background:rgba(0,100,255,0.2);color:#4d9fff;border:1px solid rgba(0,100,255,0.3)!important;}
    .ovo .btn-copy{background:rgba(120,0,200,0.2);color:#c084fc;border:1px solid rgba(120,0,200,0.3)!important;}
    .gopay .btn-copy{background:rgba(0,180,80,0.18);color:#4ade80;border:1px solid rgba(0,180,80,0.3)!important;}
    .qris .btn-copy{background:rgba(0,255,225,0.08);color:var(--neon);border:1px solid rgba(0,255,225,0.25)!important;}
    .btn-copy:active{opacity:0.7;transform:scale(0.97);}

    /* ══ UPLOAD BUKTI ══ */
    .upload-section{max-width:480px;margin:0 auto;padding:0 14px 30px;}
    .upload-card{background:var(--card-bg);border:1px solid var(--border);border-radius:18px;padding:22px 18px;backdrop-filter:blur(20px);box-shadow:0 20px 50px rgba(0,0,0,0.3);}
    .upload-title{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:3px;color:var(--neon);margin-bottom:6px;text-transform:uppercase;}
    .upload-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.3);letter-spacing:1px;margin-bottom:18px;padding-bottom:14px;border-bottom:1px solid var(--border);}
    .upload-steps{background:rgba(0,255,225,0.04);border:1px solid rgba(0,255,225,0.12);border-radius:12px;padding:14px 16px;margin-bottom:16px;font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.45);letter-spacing:0.5px;line-height:2;}
    .upload-steps span{color:var(--neon);}
    .upload-id-row{display:flex;gap:8px;margin-bottom:14px;}
    .upload-id-input{flex:1;background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,225,0.16);border-radius:10px;padding:12px 14px;font-size:14px;font-family:'Share Tech Mono',monospace;color:#fff;outline:none;transition:border-color 0.3s;}
    .upload-id-input:focus{border-color:rgba(0,255,225,0.5);}
    .btn-autofill{padding:12px 14px;background:rgba(0,255,225,0.08);border:1px solid rgba(0,255,225,0.25);border-radius:10px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;color:var(--neon);cursor:pointer;transition:all 0.2s;white-space:nowrap;text-transform:uppercase;}
    .btn-autofill:active{background:rgba(0,255,225,0.15);}
    .drop-zone{border:2px dashed rgba(0,255,225,0.25);border-radius:14px;padding:30px 20px;text-align:center;cursor:pointer;transition:all 0.3s;position:relative;overflow:hidden;background:rgba(0,255,225,0.02);margin-bottom:14px;display:block;}
    .drop-zone:hover,.drop-zone.dragover{border-color:rgba(0,255,225,0.6);background:rgba(0,255,225,0.05);}
    .drop-icon{font-size:36px;margin-bottom:10px;}
    .drop-text{font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:rgba(0,255,225,0.5);text-transform:uppercase;}
    .drop-sub{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.25);margin-top:6px;letter-spacing:1px;}
    .bukti-preview{display:none;position:relative;margin-bottom:14px;}
    .bukti-preview.visible{display:block;}
    .bukti-preview img{width:100%;border-radius:12px;border:1px solid rgba(0,255,225,0.2);max-height:220px;object-fit:cover;}
    .bukti-preview-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(4,12,18,0.7) 0%,transparent 50%);border-radius:12px;display:flex;align-items:flex-end;padding:12px;}
    .bukti-preview-label{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:var(--neon);text-transform:uppercase;}
    .bukti-remove{position:absolute;top:8px;right:8px;width:28px;height:28px;border-radius:50%;background:rgba(255,77,109,0.8);border:none;color:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .btn-upload-submit{width:100%;padding:16px;background:linear-gradient(135deg,rgba(0,255,225,0.15),rgba(0,180,255,0.1));border:1px solid rgba(0,255,225,0.35);border-radius:12px;font-family:'Orbitron',sans-serif;font-weight:700;font-size:12px;letter-spacing:2px;color:var(--neon);cursor:pointer;transition:all 0.25s;text-transform:uppercase;}
    .btn-upload-submit:active{transform:scale(0.97);}
    .btn-upload-submit:disabled{opacity:0.4;}
    .upload-progress{display:none;margin-top:10px;}
    .upload-progress.visible{display:block;}
    .progress-bar-wrap{background:rgba(0,0,0,0.3);border-radius:6px;height:6px;overflow:hidden;margin-bottom:6px;}
    .progress-bar-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--neon),#00b0ff);border-radius:6px;transition:width 0.3s ease;box-shadow:0 0 8px rgba(0,255,225,0.5);}
    .progress-label{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(0,255,225,0.5);letter-spacing:1px;text-align:center;}

    /* ══ TESTIMONI PAGE ══ */
    .testi-page-wrap { max-width: 700px; margin: 0 auto; padding: 28px 14px 20px; }
    .testi-page-title { font-family:'Orbitron',sans-serif; font-size:18px; font-weight:900; color:var(--neon); letter-spacing:3px; text-shadow:var(--neon-glow); margin-bottom:4px; }
    .testi-page-sub { font-family:'Share Tech Mono',monospace; font-size:11px; color:rgba(255,255,255,0.28); letter-spacing:1px; margin-bottom:20px; }
    .stars-input { display:flex; gap:6px; margin-bottom:14px; }
    .star-btn { font-size:28px; cursor:pointer; filter: grayscale(1); opacity:0.4; transition: all 0.15s; background:none; border:none; }
    .star-btn.active { filter:grayscale(0); opacity:1; transform:scale(1.15); }
    .testi-grid { display:grid; grid-template-columns:1fr; gap:12px; margin-top:20px; }
    .testi-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 16px 18px; backdrop-filter: blur(10px); animation: fadeUp 0.3s ease both; position: relative; }
    .testi-card::before { content: '"'; position: absolute; top: 10px; right: 16px; font-size: 60px; color: rgba(0,255,225,0.06); font-family: Georgia, serif; line-height: 1; }
    .testi-header { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .testi-avatar { width: 38px; height: 38px; border-radius: 50%; background: linear-gradient(135deg, rgba(0,255,225,0.2), rgba(0,120,255,0.2)); border: 1px solid rgba(0,255,225,0.2); display: flex; align-items:center; justify-content:center; font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 700; color: var(--neon); flex-shrink: 0; }
    .testi-name { font-family:'Orbitron',sans-serif; font-size:12px; font-weight:700; color:#fff; letter-spacing:1px; }
    .testi-produk { font-family:'Share Tech Mono',monospace; font-size:10px; color:rgba(0,255,225,0.4); margin-top:2px; }
    .testi-stars { display:flex; gap:2px; margin-left:auto; }
    .testi-star { font-size:13px; }
    .testi-text { font-size:14px; color:rgba(255,255,255,0.65); line-height:1.6; }
    .testi-time { font-family:'Share Tech Mono',monospace; font-size:9px; color:rgba(255,255,255,0.2); margin-top:8px; letter-spacing:1px; }
    .testi-form-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 18px; padding: 20px 18px; backdrop-filter: blur(20px); margin-bottom: 20px; }
    .testi-form-title { font-family: 'Orbitron', sans-serif; font-size: 11px; letter-spacing: 3px; color: var(--neon); margin-bottom: 16px; text-transform: uppercase; }
    .btn-testi-submit { width:100%; padding:14px; background:linear-gradient(135deg,rgba(0,255,225,0.15),rgba(0,180,255,0.1)); border:1px solid rgba(0,255,225,0.35); border-radius:12px; font-family:'Orbitron',sans-serif; font-weight:700; font-size:11px; letter-spacing:2px; color:var(--neon); cursor:pointer; text-transform:uppercase; transition:all 0.2s; }
    .btn-testi-submit:active { transform:scale(0.97); }

    /* ══ RIWAYAT PAGE ══ */
    .riwayat-header { padding:28px 14px 0; max-width:600px; margin:0 auto; }
    .riwayat-title { font-family:'Orbitron',sans-serif; font-size:18px; font-weight:900; color:var(--neon); letter-spacing:3px; text-shadow:var(--neon-glow); margin-bottom:4px; }
    .riwayat-sub { font-family:'Share Tech Mono',monospace; font-size:11px; color:rgba(255,255,255,0.28); letter-spacing:1px; margin-bottom:20px; }
    .riwayat-stats { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:20px; }
    .rw-stat { background:var(--card-bg); border:1px solid var(--border); border-radius:12px; padding:14px 10px; text-align:center; backdrop-filter:blur(10px); position:relative; overflow:hidden; }
    .rw-stat::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; }
    .rw-stat.s-total::before { background:linear-gradient(90deg,transparent,var(--neon),transparent); }
    .rw-stat.s-berhasil::before { background:linear-gradient(90deg,transparent,var(--green),transparent); }
    .rw-stat.s-pending::before { background:linear-gradient(90deg,transparent,var(--orange),transparent); }
    .rw-stat-label { font-family:'Orbitron',sans-serif; font-size:7px; letter-spacing:2px; color:rgba(0,255,225,0.35); text-transform:uppercase; margin-bottom:5px; }
    .rw-stat-val { font-family:'Orbitron',sans-serif; font-size:22px; font-weight:700; }
    .s-total .rw-stat-val{color:var(--neon);text-shadow:var(--neon-glow);}
    .s-berhasil .rw-stat-val{color:var(--green);}
    .s-pending .rw-stat-val{color:var(--orange);}
    .riwayat-toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;flex-wrap:wrap;gap:10px;}
    .rw-filter-tabs{display:flex;gap:6px;overflow-x:auto;scrollbar-width:none;}
    .rw-filter-tabs::-webkit-scrollbar{display:none;}
    .rw-tab{flex-shrink:0;padding:7px 14px;border-radius:20px;font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1.5px;border:1px solid rgba(0,255,225,0.18);background:transparent;color:rgba(255,255,255,0.35);cursor:pointer;transition:all 0.2s;text-transform:uppercase;white-space:nowrap;}
    .rw-tab.active{background:rgba(0,255,225,0.1);border-color:rgba(0,255,225,0.45);color:var(--neon);}
    .rw-actions { display:flex;gap:8px; }
    .btn-clear-riwayat{padding:7px 12px;border-radius:8px;border:1px solid rgba(255,77,109,0.25);background:transparent;color:var(--red);font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;white-space:nowrap;}
    .btn-export-rw{padding:7px 12px;border-radius:8px;border:1px solid rgba(0,255,225,0.25);background:transparent;color:var(--neon);font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;white-space:nowrap;}
    .riwayat-list{display:flex;flex-direction:column;gap:10px;padding-bottom:20px;}
    .hc{background:var(--card-bg);border:1px solid var(--border);border-radius:14px;overflow:hidden;backdrop-filter:blur(10px);animation:fadeUp 0.3s ease both;transition:border-color 0.3s;position:relative;}
    .hc.pending{border-left:3px solid var(--orange);}
    .hc.berhasil{border-left:3px solid var(--green);}
    .hc.gagal{border-left:3px solid var(--red);}
    .hc-top{display:flex;justify-content:space-between;align-items:center;padding:12px 16px 8px;border-bottom:1px solid rgba(0,255,225,0.05);}
    .hc-id{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(0,255,225,0.5);letter-spacing:0.5px;}
    .hc-time{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.25);}
    .hc-body{padding:12px 16px;display:flex;align-items:center;gap:14px;}
    .hc-icon{width:52px;height:52px;border-radius:10px;border:1px solid rgba(0,255,225,0.2);flex-shrink:0;background-size:cover;background-position:center;background-color:rgba(0,255,225,0.05);}
    .hc-info{flex:1;min-width:0;}
    .hc-produk{font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700;color:#fff;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .hc-detail{font-size:12px;color:rgba(255,255,255,0.45);font-family:'Share Tech Mono',monospace;letter-spacing:0.5px;}
    .hc-right{text-align:right;flex-shrink:0;}
    .hc-total{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:700;color:var(--neon);margin-bottom:4px;}
    .hc-badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:20px;font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1px;font-weight:700;text-transform:uppercase;}
    .hc-badge.pending{background:rgba(255,169,77,0.12);color:var(--orange);border:1px solid rgba(255,169,77,0.28);}
    .hc-badge.berhasil{background:rgba(105,219,124,0.1);color:var(--green);border:1px solid rgba(105,219,124,0.25);}
    .hc-badge.gagal{background:rgba(255,77,109,0.1);color:var(--red);border:1px solid rgba(255,77,109,0.22);}
    .hc-expand{padding:0 16px 12px;display:none;border-top:1px solid rgba(0,255,225,0.05);}
    .hc-expand.open{display:block;padding-top:12px;}
    .hc-expand-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px;}
    .hce-field-label{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1.5px;color:rgba(0,255,225,0.3);text-transform:uppercase;margin-bottom:2px;}
    .hce-field-val{font-size:13px;font-weight:600;color:rgba(255,255,255,0.8);font-family:'Share Tech Mono',monospace;}
    .btn-recheck{width:100%;padding:10px;background:transparent;border:1px solid rgba(0,255,225,0.2);border-radius:8px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:rgba(0,255,225,0.6);cursor:pointer;transition:all 0.2s;text-transform:uppercase;margin-top:6px;}
    .hc-toggle{display:flex;justify-content:center;align-items:center;padding:8px;border-top:1px solid rgba(0,255,225,0.05);cursor:pointer;color:rgba(0,255,225,0.3);font-family:'Share Tech Mono',monospace;font-size:11px;gap:6px;transition:color 0.2s;}
    .hc-toggle-arrow{transition:transform 0.3s;display:inline-block;}
    .hc-toggle.open .hc-toggle-arrow{transform:rotate(180deg);}
    .riwayat-empty{text-align:center;padding:60px 20px;color:rgba(0,255,225,0.2);font-family:'Share Tech Mono',monospace;font-size:13px;letter-spacing:2px;line-height:2.2;}

    /* ══ ORDER TRACKING TIMELINE ══ */
    .order-timeline {
      display: flex; align-items: flex-start; gap: 0;
      margin: 14px 0 4px; position: relative;
    }
    .otl-step {
      flex: 1; display: flex; flex-direction: column; align-items: center;
      position: relative; gap: 0;
    }
    /* connector line between steps */
    .otl-step:not(:last-child)::after {
      content: ''; position: absolute;
      top: 14px; left: 50%; width: 100%; height: 2px;
      background: rgba(0,255,225,0.1);
      transition: background 0.5s ease;
      z-index: 0;
    }
    .otl-step.done:not(:last-child)::after { background: rgba(0,255,225,0.45); }
    .otl-step.fail:not(:last-child)::after { background: rgba(255,77,109,0.3); }

    .otl-dot {
      width: 28px; height: 28px; border-radius: 50%;
      border: 2px solid rgba(0,255,225,0.15);
      background: rgba(0,0,0,0.4);
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; position: relative; z-index: 1;
      transition: all 0.4s cubic-bezier(0.34,1.56,0.64,1);
      flex-shrink: 0;
    }
    .otl-step.done .otl-dot {
      border-color: var(--neon);
      background: rgba(0,255,225,0.15);
      box-shadow: 0 0 12px rgba(0,255,225,0.45);
    }
    .otl-step.active .otl-dot {
      border-color: var(--orange);
      background: rgba(255,169,77,0.15);
      box-shadow: 0 0 14px rgba(255,169,77,0.5);
      animation: otlPulse 1.4s ease infinite;
    }
    .otl-step.fail .otl-dot {
      border-color: var(--red);
      background: rgba(255,77,109,0.15);
      box-shadow: 0 0 10px rgba(255,77,109,0.4);
    }
    @keyframes otlPulse {
      0%,100% { box-shadow: 0 0 10px rgba(255,169,77,0.4); }
      50% { box-shadow: 0 0 22px rgba(255,169,77,0.8); }
    }
    .otl-label {
      font-family: 'Share Tech Mono', monospace;
      font-size: 8px; letter-spacing: 0.5px;
      color: rgba(255,255,255,0.2);
      text-align: center; margin-top: 6px;
      line-height: 1.3; max-width: 56px;
      transition: color 0.3s;
    }
    .otl-step.done .otl-label { color: rgba(0,255,225,0.65); }
    .otl-step.active .otl-label { color: var(--orange); }
    .otl-step.fail .otl-label { color: rgba(255,77,109,0.7); }
    .otl-time {
      font-family: 'Share Tech Mono', monospace;
      font-size: 7px; color: rgba(255,255,255,0.2);
      text-align: center; margin-top: 2px;
    }

    /* ══ ADMIN PAGE ══ */
    .admin-header-bar{display:flex;justify-content:space-between;align-items:center;padding:20px 14px 10px;max-width:700px;margin:0 auto;}
    .admin-title{font-family:'Orbitron',sans-serif;font-size:16px;letter-spacing:3px;color:var(--neon);text-shadow:var(--neon-glow);text-transform:uppercase;}
    .btn-logout{padding:8px 14px;border-radius:8px;border:1px solid rgba(255,77,109,0.3);background:transparent;color:var(--red);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;}
    .admin-tab-bar{display:flex;gap:0;max-width:700px;margin:0 auto 0;padding:0 14px;border-bottom:1px solid rgba(0,255,225,0.1);overflow-x:auto;scrollbar-width:none;}
    .admin-tab-bar::-webkit-scrollbar{display:none;}
    .admin-tab-btn{padding:12px 16px;font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:2px;color:rgba(255,255,255,0.3);border:none;background:transparent;cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;text-transform:uppercase;position:relative;bottom:-1px;white-space:nowrap;flex-shrink:0;}
    .admin-tab-btn.active{color:var(--neon);border-bottom-color:var(--neon);}
    .admin-section{display:none;}
    .admin-section.active{display:block;}
    .admin-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:14px 14px 10px;max-width:700px;margin:0 auto;}
    .stat-card{background:var(--card-bg);border:1px solid var(--border);border-radius:14px;padding:16px 10px;text-align:center;backdrop-filter:blur(10px);position:relative;overflow:hidden;}
    .stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
    .stat-card.total::before{background:linear-gradient(90deg,transparent,var(--neon),transparent);}
    .stat-card.berhasil::before{background:linear-gradient(90deg,transparent,var(--green),transparent);}
    .stat-card.pending::before{background:linear-gradient(90deg,transparent,var(--orange),transparent);}
    .stat-label{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:2px;color:rgba(0,255,225,0.38);text-transform:uppercase;margin-bottom:6px;}
    .stat-value{font-family:'Orbitron',sans-serif;font-size:26px;font-weight:700;}
    .stat-value.total-v{color:var(--neon);text-shadow:var(--neon-glow);}
    .stat-value.berhasil-v{color:var(--green);}
    .stat-value.pending-v{color:var(--orange);}
    .omzet-bar { max-width:700px; margin:0 auto 10px; padding:0 14px; }
    .omzet-card { background:linear-gradient(135deg,rgba(0,255,225,0.08),rgba(0,120,255,0.05)); border:1px solid rgba(0,255,225,0.2); border-radius:14px; padding:16px 18px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; }
    .omzet-label{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:rgba(0,255,225,0.4);text-transform:uppercase;margin-bottom:4px;}
    .omzet-val{font-family:'Orbitron',sans-serif;font-size:22px;font-weight:700;color:var(--neon);text-shadow:var(--neon-glow);}
    .omzet-sub{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.25);margin-top:2px;}
    .chart-wrap { max-width:700px; margin:0 auto 14px; padding:0 14px; }
    .chart-card { background:var(--card-bg); border:1px solid var(--border); border-radius:16px; padding:18px 16px; backdrop-filter:blur(10px); }
    .chart-title { font-family:'Orbitron',sans-serif; font-size:10px; letter-spacing:3px; color:rgba(0,255,225,0.5); text-transform:uppercase; margin-bottom:16px; }
    .chart-bars { display:flex; align-items:flex-end; gap:4px; height:100px; }
    .chart-bar-wrap { flex:1; display:flex; flex-direction:column; align-items:center; gap:4px; }
    .chart-bar { width:100%; border-radius:4px 4px 0 0; background:linear-gradient(to top,rgba(0,255,225,0.4),rgba(0,255,225,0.8)); box-shadow:0 0 8px rgba(0,255,225,0.3); transition:height 0.6s cubic-bezier(0.22,1,0.36,1); min-height:2px; }
    .chart-bar-lbl { font-family:'Share Tech Mono',monospace; font-size:8px; color:rgba(255,255,255,0.25); letter-spacing:0.5px; text-align:center; }
    .chart-bar-val { font-family:'Orbitron',sans-serif; font-size:8px; color:rgba(0,255,225,0.6); letter-spacing:0.5px; }
    .filter-tabs{display:flex;gap:8px;padding:10px 14px;overflow-x:auto;scrollbar-width:none;max-width:700px;margin:0 auto;}
    .filter-tabs::-webkit-scrollbar{display:none;}
    .filter-tab{flex-shrink:0;padding:8px 16px;border-radius:20px;cursor:pointer;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1.5px;border:1px solid rgba(0,255,225,0.18);background:transparent;color:rgba(255,255,255,0.4);transition:all 0.2s;text-transform:uppercase;white-space:nowrap;}
    .filter-tab.active{background:rgba(0,255,225,0.1);border-color:rgba(0,255,225,0.45);color:var(--neon);}
    .admin-toolbar{display:flex;align-items:center;justify-content:space-between;padding:4px 14px 10px;max-width:700px;margin:0 auto;flex-wrap:wrap;gap:8px;}
    .live-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(105,219,124,0.1);border:1px solid rgba(105,219,124,0.25);border-radius:20px;padding:5px 12px;font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--green);letter-spacing:1px;}
    .live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);animation:blink 1.5s ease infinite;}
    .admin-action-btns { display:flex;gap:8px;flex-wrap:wrap; }
    .btn-clear{padding:7px 14px;border-radius:8px;border:1px solid rgba(255,77,109,0.28);background:transparent;color:var(--red);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;}
    .btn-export{padding:7px 14px;border-radius:8px;border:1px solid rgba(0,255,225,0.25);background:transparent;color:var(--neon);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;}
    .orders-list{padding:0 14px 20px;max-width:700px;margin:0 auto;display:flex;flex-direction:column;gap:12px;}
    .order-card{background:var(--card-bg);border:1px solid var(--border);border-radius:16px;overflow:hidden;backdrop-filter:blur(10px);animation:fadeUp 0.35s ease both;}
    .order-card.pending{border-left:3px solid var(--orange);}
    .order-card.berhasil{border-left:3px solid var(--green);}
    .order-card.gagal{border-left:3px solid var(--red);}
    .oc-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px 10px;border-bottom:1px solid rgba(0,255,225,0.06);}
    .oc-id{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(0,255,225,0.55);}
    .oc-time{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.28);}
    .oc-body{padding:12px 16px;}
    .oc-user{font-family:'Orbitron',sans-serif;font-size:15px;font-weight:700;color:#fff;margin-bottom:10px;}
    .oc-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;}
    .oc-field-label{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1.5px;color:rgba(0,255,225,0.35);text-transform:uppercase;margin-bottom:3px;}
    .oc-field-value{font-size:14px;font-weight:600;color:rgba(255,255,255,0.85);}
    .oc-total{font-family:'Orbitron',sans-serif;font-size:20px;font-weight:700;color:var(--neon);}
    .status-badge{display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:20px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;font-weight:700;text-transform:uppercase;}
    .status-badge.pending{background:rgba(255,169,77,0.12);color:var(--orange);border:1px solid rgba(255,169,77,0.28);}
    .status-badge.berhasil{background:rgba(105,219,124,0.1);color:var(--green);border:1px solid rgba(105,219,124,0.25);}
    .status-badge.gagal{background:rgba(255,77,109,0.1);color:var(--red);border:1px solid rgba(255,77,109,0.22);}
    .oc-actions{display:grid;grid-template-columns:1fr 1fr;gap:0;border-top:1px solid rgba(0,255,225,0.07);}
    .oc-btn{padding:15px 10px;border:none;background:transparent;font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;letter-spacing:1.5px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;display:flex;align-items:center;justify-content:center;gap:6px;}
    .oc-btn:first-child{border-right:1px solid rgba(0,255,225,0.07);border-radius:0 0 0 13px;}
    .oc-btn:last-child{border-radius:0 0 13px 0;}
    .oc-btn.confirm{color:var(--green);}
    .oc-btn.reject{color:var(--red);}
    .oc-btn.confirm:active{background:rgba(105,219,124,0.1);}
    .oc-btn.reject:active{background:rgba(255,77,109,0.08);}
    .oc-btn:only-child{grid-column:1/-1;border-right:none;border-radius:0 0 13px 13px;}
    .oc-done{padding:13px;text-align:center;font-family:'Share Tech Mono',monospace;font-size:11px;letter-spacing:1px;color:rgba(255,255,255,0.2);border-top:1px solid rgba(0,255,225,0.06);}
    .btn-balas{padding:10px;border:none;background:transparent;font-family:'Orbitron',sans-serif;font-size:9px;color:rgba(0,255,225,0.5);cursor:pointer;width:100%;border-top:1px solid rgba(0,255,225,0.06);letter-spacing:1px;text-transform:uppercase;transition:all 0.2s;}
    .btn-balas:active{background:rgba(0,255,225,0.05);}
    .balas-form{display:none;padding:12px 16px;border-top:1px solid rgba(0,255,225,0.06);}
    .balas-form.open{display:block;}
    .balas-template-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px;}
    .balas-tpl{padding:6px 12px;border-radius:20px;border:1px solid rgba(0,255,225,0.2);background:transparent;color:rgba(0,255,225,0.5);font-family:'Share Tech Mono',monospace;font-size:10px;cursor:pointer;white-space:nowrap;transition:all 0.2s;}
    .balas-tpl:active{background:rgba(0,255,225,0.1);}
    .balas-input{width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,225,0.16);border-radius:10px;padding:11px 14px;font-size:14px;font-family:'Rajdhani',sans-serif;color:#fff;outline:none;resize:none;height:70px;margin-bottom:8px;}
    .balas-input:focus{border-color:rgba(0,255,225,0.5);}
    .btn-kirim-balas{padding:10px 16px;background:rgba(0,255,225,0.1);border:1px solid rgba(0,255,225,0.3);border-radius:8px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;color:var(--neon);cursor:pointer;text-transform:uppercase;}
    .produk-admin-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:14px 14px 10px;max-width:700px;margin:0 auto;}
    .produk-admin-card{background:var(--card-bg);border:1px solid var(--border);border-radius:14px;overflow:hidden;backdrop-filter:blur(10px);animation:fadeUp 0.3s ease both;position:relative;}
    .pac-img{width:100%;aspect-ratio:1/0.8;object-fit:cover;background:rgba(0,255,225,0.05);display:block;}
    .pac-img-placeholder{width:100%;aspect-ratio:1/0.8;background:rgba(0,255,225,0.04);display:flex;align-items:center;justify-content:center;font-size:32px;color:rgba(255,255,255,0.1);}
    .pac-body{padding:10px 12px 12px;}
    .pac-name{font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;color:#fff;letter-spacing:1px;margin-bottom:4px;text-transform:uppercase;}
    .pac-price{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700;color:var(--neon);margin-bottom:4px;}
    .pac-stok{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.3);margin-bottom:10px;}
    .pac-actions{display:flex;gap:6px;}
    .pac-btn{flex:1;padding:8px 6px;border-radius:8px;cursor:pointer;font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1px;border:none;transition:all 0.2s;text-transform:uppercase;font-weight:700;}
    .pac-btn.edit{background:rgba(0,255,225,0.1);color:var(--neon);border:1px solid rgba(0,255,225,0.25)!important;}
    .pac-btn.del{background:rgba(255,77,109,0.1);color:var(--red);border:1px solid rgba(255,77,109,0.22)!important;}
    .pac-btn:active{transform:scale(0.95);}
    .btn-add-produk{display:flex;align-items:center;justify-content:center;gap:8px;width:calc(100% - 28px);margin:0 14px 14px;max-width:672px;padding:14px;background:rgba(0,255,225,0.06);border:2px dashed rgba(0,255,225,0.25);border-radius:14px;cursor:pointer;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:rgba(0,255,225,0.5);transition:all 0.2s;text-transform:uppercase;}
    .settings-section { max-width:700px; margin:0 auto; padding:14px 14px 20px; }
    .settings-card { background:var(--card-bg);border:1px solid var(--border);border-radius:16px;padding:20px 18px;backdrop-filter:blur(10px);margin-bottom:14px; }
    .settings-title { font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:3px;color:var(--neon);text-transform:uppercase;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid var(--border); }
    .wa-tpl-input { width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,225,0.16);border-radius:10px;padding:12px 14px;font-size:13px;font-family:'Share Tech Mono',monospace;color:#fff;outline:none;resize:none;min-height:120px;margin-bottom:10px;line-height:1.6; }
    .wa-tpl-input:focus{border-color:rgba(0,255,225,0.5);}
    .tpl-hint { font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.25);letter-spacing:0.5px;margin-bottom:10px;line-height:1.8; }
    .btn-save-settings { padding:12px 20px;background:linear-gradient(135deg,#00ffe1,#00b0a2);border:none;border-radius:10px;font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;letter-spacing:2px;color:#040c12;cursor:pointer;text-transform:uppercase; }
    .promo-toggle-row { display:flex;align-items:center;justify-content:space-between;margin-bottom:12px; }
    .toggle-label { font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:1px;color:rgba(255,255,255,0.5);text-transform:uppercase; }
    .toggle-switch { position:relative;width:46px;height:26px; }
    .toggle-switch input { opacity:0;width:0;height:0; }
    .toggle-slider { position:absolute;inset:0;background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,225,0.2);border-radius:13px;cursor:pointer;transition:all 0.3s; }
    .toggle-slider:before { content:'';position:absolute;width:18px;height:18px;left:3px;top:3px;background:rgba(255,255,255,0.3);border-radius:50%;transition:all 0.3s; }
    input:checked + .toggle-slider { background:rgba(0,255,225,0.15);border-color:rgba(0,255,225,0.5); }
    input:checked + .toggle-slider:before { transform:translateX(20px);background:var(--neon);box-shadow:0 0 8px rgba(0,255,225,0.6); }
    /* Toggle merah khusus flash sale */
    .toggle-sale input:checked + .toggle-slider { background:rgba(255,77,109,0.2);border-color:rgba(255,77,109,0.6); }
    .toggle-sale input:checked + .toggle-slider:before { background:var(--red);box-shadow:0 0 8px rgba(255,77,109,0.6); }
    .bukti-thumb{width:52px;height:52px;border-radius:8px;object-fit:cover;border:1px solid rgba(0,255,225,0.25);cursor:pointer;transition:all 0.2s;flex-shrink:0;}
    .bukti-thumb:hover{border-color:var(--neon);transform:scale(1.05);}
    .no-bukti{width:52px;height:52px;border-radius:8px;border:1px dashed rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;color:rgba(255,255,255,0.15);}
    #lightbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);backdrop-filter:blur(20px);z-index:9998;justify-content:center;align-items:center;padding:20px;}
    #lightbox img{max-width:100%;max-height:90vh;border-radius:16px;border:1px solid rgba(0,255,225,0.2);}
    .lightbox-close{position:absolute;top:16px;right:16px;width:40px;height:40px;border-radius:50%;background:rgba(255,77,109,0.8);border:none;color:#fff;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:9999;}
    .lightbox-label{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(0,255,225,0.5);letter-spacing:2px;white-space:nowrap;}
    #produkModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.92);backdrop-filter:blur(16px);z-index:8000;justify-content:center;align-items:flex-end;padding:0;}
    .produk-modal-box{background:rgba(7,21,32,0.99);border:1px solid rgba(0,255,225,0.2);border-radius:24px 24px 0 0;padding:28px 22px 36px;width:100%;max-width:480px;animation:slideUp 0.4s cubic-bezier(0.22,1,0.36,1);max-height:88vh;overflow-y:auto;-webkit-overflow-scrolling:touch;}
    .modal-handle{width:40px;height:4px;background:rgba(255,255,255,0.15);border-radius:2px;margin:0 auto 22px;}
    .modal-title{font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:3px;color:var(--neon);margin-bottom:20px;text-transform:uppercase;text-align:center;}
    .img-upload-zone{border:2px dashed rgba(0,255,225,0.2);border-radius:12px;aspect-ratio:16/9;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;margin-bottom:14px;background:rgba(0,255,225,0.02);transition:all 0.2s;}
    .img-upload-zone:hover{border-color:rgba(0,255,225,0.45);}
    .img-upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;font-size:100px;}
    .img-upload-zone img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
    .img-upload-zone .upload-hint{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(0,255,225,0.4);letter-spacing:1px;text-align:center;z-index:1;}
    .modal-btns{display:flex;gap:10px;margin-top:6px;}
    .btn-modal-save{flex:2;padding:16px;background:linear-gradient(135deg,#00ffe1,#00b0a2);border:none;border-radius:12px;font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;color:#040c12;cursor:pointer;text-transform:uppercase;}
    .btn-modal-cancel{flex:1;padding:16px;background:transparent;border:1px solid rgba(255,255,255,0.1);border-radius:12px;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:rgba(255,255,255,0.3);cursor:pointer;text-transform:uppercase;}
    .produk-empty-state{grid-column:1/-1;text-align:center;padding:40px 20px;color:rgba(0,255,225,0.25);font-family:'Share Tech Mono',monospace;font-size:13px;letter-spacing:2px;}
    #pwPopup{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.92);backdrop-filter:blur(16px);justify-content:center;align-items:center;z-index:9000;}
    .pw-box{background:rgba(7,21,32,0.98);border:1px solid rgba(0,255,225,0.25);border-radius:24px;padding:36px 28px;width:90%;max-width:340px;text-align:center;box-shadow:0 0 80px rgba(0,255,225,0.15);animation:popIn 0.4s cubic-bezier(0.22,1,0.36,1);}
    .pw-icon{font-size:40px;margin-bottom:16px;}
    .pw-title{font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:3px;color:var(--neon);margin-bottom:6px;text-transform:uppercase;}
    .pw-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.3);letter-spacing:1px;margin-bottom:28px;}
    .pin-dots{display:flex;justify-content:center;gap:14px;margin-bottom:24px;}
    .pin-dot{width:16px;height:16px;border-radius:50%;border:2px solid rgba(0,255,225,0.3);background:transparent;transition:all 0.2s;}
    .pin-dot.filled{background:var(--neon);border-color:var(--neon);box-shadow:0 0 12px rgba(0,255,225,0.6);transform:scale(1.1);}
    .pin-dot.error{background:var(--red);border-color:var(--red);animation:shake 0.4s ease;}
    @keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
    .numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;}
    .num-btn{padding:18px 10px;background:rgba(0,255,225,0.05);border:1px solid rgba(0,255,225,0.12);border-radius:12px;font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700;color:var(--text);cursor:pointer;transition:all 0.15s;user-select:none;}
    .num-btn:active{background:rgba(0,255,225,0.15);border-color:rgba(0,255,225,0.4);transform:scale(0.94);}
    .num-btn.del{font-size:20px;color:rgba(255,255,255,0.4);}
    .num-btn.empty{background:transparent;border:none;cursor:default;}
    .pw-cancel{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.25);background:transparent;border:none;cursor:pointer;letter-spacing:1px;padding:8px;}
    #qrisPopup{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(12px);justify-content:center;align-items:flex-end;z-index:999;}
    .qrisContent{background:rgba(7,21,32,0.98);border:1px solid rgba(0,255,225,0.25);border-radius:24px 24px 0 0;padding:28px 24px 36px;text-align:center;width:100%;max-width:440px;animation:slideUp 0.4s cubic-bezier(0.22,1,0.36,1);}
    .qris-handle{width:40px;height:4px;background:rgba(255,255,255,0.15);border-radius:2px;margin:0 auto 22px;}
    .qrisContent h3{font-family:'Orbitron',sans-serif;font-size:13px;letter-spacing:2px;color:var(--neon);margin-bottom:18px;text-transform:uppercase;}
    .qrisContent img{width:200px;border-radius:14px;border:2px solid rgba(0,255,225,0.2);}
    .qris-amount{font-family:'Orbitron',sans-serif;font-size:20px;color:var(--neon);text-shadow:var(--neon-glow);margin:14px 0 6px;}
    .qris-btns{display:flex;gap:10px;margin-top:18px;}
    .qris-btns button{flex:1;padding:15px;border:none;border-radius:12px;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:1px;font-weight:700;cursor:pointer;text-transform:uppercase;}
    .btn-sudah{background:linear-gradient(135deg,#00ffe1,#00b0a2);color:#040c12;}
    .btn-tutup{background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.1)!important;color:rgba(255,255,255,0.45);}
    #sharePopup{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(12px);justify-content:center;align-items:flex-end;z-index:600;}
    .share-box{background:rgba(7,21,32,0.99);border:1px solid rgba(0,255,225,0.2);border-radius:24px 24px 0 0;padding:24px 18px 36px;width:100%;max-width:440px;animation:slideUp 0.4s cubic-bezier(0.22,1,0.36,1);}
    .share-handle{width:40px;height:4px;background:rgba(255,255,255,0.15);border-radius:2px;margin:0 auto 20px;}
    .share-title{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:3px;color:var(--neon);margin-bottom:18px;text-transform:uppercase;}
    .share-btns{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .share-btn{padding:14px;border-radius:12px;border:none;cursor:pointer;font-family:'Orbitron',sans-serif;font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:6px;}
    .share-btn span{font-size:24px;}
    .share-btn.wa{background:rgba(37,211,102,0.12);color:#25d366;border:1px solid rgba(37,211,102,0.25)!important;}
    .share-btn.ig{background:rgba(225,48,108,0.1);color:#e1306c;border:1px solid rgba(225,48,108,0.2)!important;}
    .share-btn.copy{background:rgba(0,255,225,0.08);color:var(--neon);border:1px solid rgba(0,255,225,0.2)!important;}
    .share-btn.close{background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.3);border:1px solid rgba(255,255,255,0.1)!important;}
    .share-btn:active{transform:scale(0.95);}
    .notif-banner { max-width:700px; margin:12px auto 0; padding:0 14px; display:none; }
    .notif-banner.visible{display:block;}
    .notif-box{background:rgba(0,180,255,0.08);border:1px solid rgba(0,180,255,0.25);border-radius:12px;padding:12px 16px;display:flex;align-items:center;gap:12px;}
    .notif-text{flex:1;font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.5);letter-spacing:0.5px;}
    .btn-allow-notif{padding:8px 14px;background:rgba(0,180,255,0.15);border:1px solid rgba(0,180,255,0.3);border-radius:8px;font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1px;color:#4dc3ff;cursor:pointer;text-transform:uppercase;white-space:nowrap;}
    .empty-state{text-align:center;padding:50px 20px;color:rgba(0,255,225,0.25);font-family:'Share Tech Mono',monospace;font-size:13px;letter-spacing:2px;line-height:2;}
    .loading-state{text-align:center;padding:50px;}
    .spinner{display:inline-block;width:32px;height:32px;border:3px solid rgba(0,255,225,0.12);border-top-color:var(--neon);border-radius:50%;animation:spin 0.8s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg)}}
    .toast{position:fixed;bottom:calc(var(--bottom-h) + 14px);left:50%;transform:translateX(-50%);background:rgba(7,21,32,0.97);border:1px solid rgba(0,255,225,0.3);color:var(--neon);padding:13px 22px;border-radius:12px;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:1.5px;backdrop-filter:blur(15px);z-index:9999;box-shadow:0 0 30px rgba(0,255,225,0.15);white-space:nowrap;animation:toastIn 0.3s ease;}
    @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(16px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
    @keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
    @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes popIn{from{opacity:0;transform:scale(0.85) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}

    @media(min-width:768px){
      .bottom-nav{position:fixed;left:0;top:0;bottom:0;width:80px;height:100vh;flex-direction:column;border-top:none;border-right:1px solid rgba(0,255,225,0.1);padding:80px 0 20px;z-index:98;}
      .bottom-tab{padding:16px 0;flex:none;width:100%;}
      .tab-badge{top:8px;right:14px;}
      .page{padding-left:80px;}
      .card-container{grid-template-columns:repeat(4,1fr);max-width:900px;gap:14px;padding:0 32px;}
      .flash-section-wrap{padding:0 32px;max-width:900px;}
      .regular-section-wrap{padding:0 32px;max-width:900px;}
      .flash-grid{grid-template-columns:repeat(4,1fr);gap:14px;}
      .regular-grid{grid-template-columns:repeat(4,1fr);gap:14px;}
      .order-section{max-width:600px;padding:0 32px 30px;}
      .upload-section{max-width:600px;padding:0 32px 30px;}
      header{padding:48px 32px 20px;}
      header h1{font-size:56px;}
      .promo-banner{padding:0 32px;}
      .search-filter-wrap{padding:0 32px;}
      .card-container{padding:0 32px;}
      .notif-banner{padding:0 32px;}
      .riwayat-header{padding:32px 32px 0;max-width:800px;}
      .testi-page-wrap{padding:28px 32px 20px;max-width:900px;}
      .testi-grid{grid-template-columns:repeat(2,1fr);}
      .admin-header-bar{padding:28px 32px 14px;max-width:900px;}
      .admin-stats{padding:14px 32px 10px;max-width:900px;}
      .filter-tabs{padding:10px 32px;max-width:900px;}
      .admin-toolbar{padding:4px 32px 12px;max-width:900px;}
      .orders-list{padding:0 32px 30px;max-width:900px;display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:start;}
      .riwayat-list{display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:start;}
      .top-nav{left:80px;z-index:101;}
      .omzet-bar{padding:0 32px;}
      .chart-wrap{padding:0 32px;}
      .produk-admin-grid{grid-template-columns:repeat(3,1fr);padding:14px 32px 10px;max-width:900px;}
      .btn-add-produk{width:calc(100% - 64px);margin:0 32px 14px;max-width:868px;}
      .settings-section{padding:14px 32px 20px;}
    }
    @media(min-width:1200px){ .card-container{grid-template-columns:repeat(5,1fr);max-width:1100px;} .flash-grid{grid-template-columns:repeat(5,1fr);} .regular-grid{grid-template-columns:repeat(5,1fr);} }
    ::-webkit-scrollbar{width:3px;}::-webkit-scrollbar-track{background:var(--bg1);}::-webkit-scrollbar-thumb{background:rgba(0,255,225,0.2);border-radius:2px;}

    /* ══ FLYING CART ANIMATION ══ */
    .cart-fly-dot{position:fixed;width:14px;height:14px;border-radius:50%;background:var(--neon);box-shadow:0 0 16px var(--neon);z-index:9999;pointer-events:none;transition:none;}
    @keyframes cartFlyAnim{0%{opacity:1;transform:scale(1);}80%{opacity:1;}100%{opacity:0;transform:scale(0.3);}}

    /* ══ WISHLIST BUTTON ══ */
    .card-wish-btn{position:absolute;top:8px;right:8px;width:28px;height:28px;border-radius:50%;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.15);display:flex;align-items:center;justify-content:center;font-size:14px;cursor:pointer;z-index:6;transition:all 0.2s;}
    .card-wish-btn:active{transform:scale(0.85);}
    .card-wish-btn.active{background:rgba(255,77,109,0.3);border-color:rgba(255,77,109,0.6);}
    .tab-icon-wish{font-size:20px;line-height:1;}

    /* ══ WISHLIST PAGE ══ */
    .wishlist-header{padding:28px 14px 0;max-width:600px;margin:0 auto;}
    .wishlist-title{font-family:'Orbitron',sans-serif;font-size:18px;font-weight:900;color:var(--red);letter-spacing:3px;margin-bottom:4px;text-shadow:0 0 20px rgba(255,77,109,0.4);}
    .wishlist-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.28);letter-spacing:1px;margin-bottom:20px;}
    .wishlist-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 14px;max-width:700px;margin:14px auto 20px;}
    @media(min-width:768px){.wishlist-grid{grid-template-columns:repeat(3,1fr);padding:0 32px;}}
    .wishlist-empty{text-align:center;padding:60px 20px;color:rgba(255,77,109,0.3);font-family:'Share Tech Mono',monospace;font-size:13px;letter-spacing:2px;line-height:2.2;}

    /* ══ PRODUK PREVIEW POPUP ══ */
    #produkPreviewPopup{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.92);backdrop-filter:blur(16px);z-index:700;justify-content:center;align-items:flex-end;}
    .preview-box{background:rgba(7,21,32,0.99);border:1px solid rgba(0,255,225,0.2);border-radius:24px 24px 0 0;padding:0 0 36px;width:100%;max-width:480px;animation:slideUp 0.4s cubic-bezier(0.22,1,0.36,1);max-height:90vh;overflow-y:auto;}
    .preview-img-wrap{position:relative;width:100%;aspect-ratio:16/10;overflow:hidden;border-radius:24px 24px 0 0;}
    .preview-img-wrap img{width:100%;height:100%;object-fit:cover;}
    .preview-img-placeholder{width:100%;aspect-ratio:16/10;background:rgba(0,255,225,0.04);display:flex;align-items:center;justify-content:center;font-size:64px;border-radius:24px 24px 0 0;}
    .preview-close{position:absolute;top:14px;right:14px;width:36px;height:36px;border-radius:50%;background:rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.15);color:#fff;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10;}
    .preview-body{padding:20px 20px 0;}
    .preview-name{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:900;color:#fff;letter-spacing:1px;margin-bottom:6px;text-transform:uppercase;}
    .preview-price-row{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
    .preview-price{font-family:'Orbitron',sans-serif;font-size:22px;font-weight:700;color:var(--neon);text-shadow:var(--neon-glow);}
    .preview-price-ori{font-family:'Share Tech Mono',monospace;font-size:13px;color:rgba(255,255,255,0.3);text-decoration:line-through;}
    .preview-badge{background:linear-gradient(135deg,#ff4d6d,#ff8c00);color:#fff;font-family:'Orbitron',sans-serif;font-size:9px;font-weight:700;padding:3px 8px;border-radius:5px;}
    .preview-desc{font-size:14px;color:rgba(255,255,255,0.55);line-height:1.7;margin-bottom:14px;font-family:'Rajdhani',sans-serif;}
    .preview-meta{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:18px;}
    .preview-meta-chip{padding:5px 12px;border-radius:20px;font-family:'Share Tech Mono',monospace;font-size:10px;letter-spacing:1px;}
    .preview-meta-chip.stok{background:rgba(105,219,124,0.1);color:var(--green);border:1px solid rgba(105,219,124,0.25);}
    .preview-meta-chip.sold{background:rgba(0,255,225,0.08);color:rgba(0,255,225,0.7);border:1px solid rgba(0,255,225,0.18);}
    .preview-actions{display:flex;gap:10px;padding:0 20px;}
    .btn-preview-beli{flex:2;padding:15px;background:linear-gradient(135deg,#00ffe1,#00b0a2);border:none;border-radius:12px;font-family:'Orbitron',sans-serif;font-weight:700;font-size:12px;letter-spacing:2px;color:#040c12;cursor:pointer;text-transform:uppercase;}
    .btn-preview-cart{flex:1;padding:15px;background:rgba(0,255,225,0.08);border:1px solid rgba(0,255,225,0.3);border-radius:12px;font-family:'Orbitron',sans-serif;font-size:11px;color:var(--neon);cursor:pointer;text-transform:uppercase;letter-spacing:1px;}

    /* ══ VOUCHER ══ */
    .voucher-row{display:flex;gap:8px;margin-bottom:12px;}
    .voucher-input{flex:1;background:rgba(0,0,0,0.3);border:1px solid rgba(255,215,0,0.25);border-radius:10px;padding:12px 14px;font-size:14px;font-family:'Share Tech Mono',monospace;color:#fff;outline:none;transition:border-color 0.3s;text-transform:uppercase;letter-spacing:2px;}
    .voucher-input:focus{border-color:rgba(255,215,0,0.6);}
    .voucher-input::placeholder{text-transform:none;letter-spacing:0;font-size:13px;color:rgba(255,255,255,0.25);}
    .btn-voucher{padding:12px 14px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:10px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;color:var(--yellow);cursor:pointer;white-space:nowrap;text-transform:uppercase;}
    .voucher-badge{display:none;align-items:center;gap:8px;background:rgba(105,219,124,0.1);border:1px solid rgba(105,219,124,0.3);border-radius:10px;padding:10px 14px;margin-bottom:12px;font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--green);}
    .voucher-badge.visible{display:flex;}
    .btn-voucher-remove{background:transparent;border:none;color:rgba(255,255,255,0.3);cursor:pointer;font-size:16px;margin-left:auto;}
    .voucher-settings-card .voucher-list{margin-top:12px;display:flex;flex-direction:column;gap:8px;}
    .voucher-item{display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,0.2);border:1px solid rgba(255,215,0,0.15);border-radius:10px;padding:10px 14px;}
    .voucher-item-code{font-family:'Orbitron',sans-serif;font-size:12px;color:var(--yellow);letter-spacing:2px;}
    .voucher-item-info{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.4);}
    .btn-del-voucher{background:transparent;border:none;color:var(--red);cursor:pointer;font-size:14px;}
    .voucher-add-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
    .voucher-add-row input{flex:1;min-width:80px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,215,0,0.2);border-radius:8px;padding:9px 12px;font-size:12px;font-family:'Share Tech Mono',monospace;color:#fff;outline:none;text-transform:uppercase;}
    .voucher-add-row input::placeholder{text-transform:none;color:rgba(255,255,255,0.2);}
    .btn-add-voucher{padding:9px 14px;background:rgba(255,215,0,0.12);border:1px solid rgba(255,215,0,0.3);border-radius:8px;font-family:'Orbitron',sans-serif;font-size:9px;color:var(--yellow);cursor:pointer;white-space:nowrap;text-transform:uppercase;}

    /* ══ VOUCHER HINT (untuk pembeli) ══ */
    .voucher-hint-toggle{display:flex;align-items:center;gap:6px;margin-bottom:8px;cursor:pointer;width:fit-content;}
    .voucher-hint-toggle span{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,215,0,0.55);letter-spacing:1px;text-decoration:underline dotted;transition:color 0.2s;}
    .voucher-hint-toggle:hover span{color:rgba(255,215,0,0.9);}
    .voucher-hint-box{display:none;background:rgba(255,215,0,0.05);border:1px solid rgba(255,215,0,0.2);border-radius:12px;padding:12px 14px;margin-bottom:12px;animation:fadeUp 0.25s ease;}
    .voucher-hint-box.visible{display:block;}
    .voucher-hint-title{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:2px;color:rgba(255,215,0,0.4);text-transform:uppercase;margin-bottom:8px;}
    .voucher-hint-list{display:flex;flex-direction:column;gap:6px;}
    .voucher-hint-item{display:flex;align-items:center;justify-content:space-between;gap:8px;background:rgba(0,0,0,0.2);border-radius:8px;padding:8px 12px;cursor:pointer;transition:background 0.2s;}
    .voucher-hint-item:active{background:rgba(255,215,0,0.1);}
    .voucher-hint-code{font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700;color:var(--yellow);letter-spacing:2px;}
    .voucher-hint-info{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.4);}
    .voucher-hint-tap{font-family:'Share Tech Mono',monospace;font-size:9px;color:rgba(0,255,225,0.4);white-space:nowrap;}
    .voucher-hint-empty{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.25);text-align:center;padding:8px 0;letter-spacing:1px;}

    /* ══ ADMIN DATE FILTER ══ */
    .date-filter-wrap{display:flex;gap:8px;align-items:center;padding:8px 14px 4px;max-width:700px;margin:0 auto;flex-wrap:wrap;}
    .date-filter-input{background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,225,0.16);border-radius:8px;padding:7px 12px;font-family:'Share Tech Mono',monospace;font-size:12px;color:#fff;outline:none;cursor:pointer;color-scheme:dark;}
    .btn-clear-date{padding:7px 12px;background:transparent;border:1px solid rgba(255,77,109,0.25);border-radius:8px;font-family:'Orbitron',sans-serif;font-size:8px;color:var(--red);cursor:pointer;text-transform:uppercase;white-space:nowrap;}
    @media(min-width:768px){.date-filter-wrap{padding:8px 32px 4px;max-width:900px;}}
  </style>
</head>
<body>

<div id="splashScreen">
  <div class="splash-logo">NEOSTORE⚡</div>
  <div class="splash-sub">Premium Digital Marketplace</div>
  <div class="splash-bar-wrap"><div class="splash-bar" id="splashBar"></div></div>
  <div class="splash-pct" id="splashPct">0%</div>
</div>

<div id="konfeti"></div>
<canvas id="matrixCanvas"></canvas>
<canvas id="particleCanvas"></canvas>
<div class="bg-overlay"></div>

<nav class="top-nav">
  <div class="nav-logo" id="navLogo" onclick="handleLogoTap()">
    NEOSTORE⚡
    <div class="tap-dots" id="tapDots">
      <div class="tap-dot" id="td0"></div><div class="tap-dot" id="td1"></div>
      <div class="tap-dot" id="td2"></div><div class="tap-dot" id="td3"></div>
      <div class="tap-dot" id="td4"></div>
    </div>
  </div>
  <div class="nav-right">
    <div class="nav-cart-btn" onclick="openCart()">🛒<div class="nav-cart-count" id="cartCount" style="display:none">0</div></div>
    <div class="fb-status"><div class="fb-dot" id="fbDot"></div><span id="fbStatusText" style="color:rgba(255,255,255,0.3)">connecting</span></div>
  </div>
</nav>

<!-- ═══ STORE PAGE ═══ -->
<div class="page active" id="page-store">
  <header>
    <div class="logo-wrap"><h1>NEOSTORE⚡</h1></div>
    <div class="tagline">Premium Digital Marketplace</div>
    <div class="header-line"></div>
  </header>

  <div class="notif-banner" id="notifBanner">
    <div class="notif-box">
      <span style="font-size:20px">🔔</span>
      <span class="notif-text">Aktifkan notifikasi untuk update status order kamu!</span>
      <button class="btn-allow-notif" onclick="requestNotifPermission()">Aktifkan</button>
    </div>
  </div>

  <div class="promo-banner" id="promoBanner" style="margin-top:14px">
    <div class="promo-box">
      <div class="promo-left">
        <div class="promo-emoji">🔥</div>
        <div>
          <div class="promo-text-label" id="promoTextLabel">Flash Sale!</div>
          <div class="promo-text-sub">Promo berakhir dalam</div>
        </div>
      </div>
      <div class="countdown-wrap">
        <div class="cd-unit"><span class="cd-num" id="cdH">00</span><span class="cd-lbl">JAM</span></div>
        <div class="cd-sep">:</div>
        <div class="cd-unit"><span class="cd-num" id="cdM">00</span><span class="cd-lbl">MENIT</span></div>
        <div class="cd-sep">:</div>
        <div class="cd-unit"><span class="cd-num" id="cdS">00</span><span class="cd-lbl">DETIK</span></div>
      </div>
    </div>
  </div>

  <div class="search-filter-wrap">
    <input type="text" class="search-input" id="searchInput" placeholder="Cari produk..." oninput="filterProduk()">
    <select class="filter-sort" id="sortSelect" onchange="filterProduk()">
      <option value="default">Urutan</option>
      <option value="price-asc">Harga ↑</option>
      <option value="price-desc">Harga ↓</option>
      <option value="sold">Terlaris</option>
      <option value="promo">🔥 Promo</option>
    </select>
  </div>

  <div id="produkSectionsWrap">
    <!-- Flash Sale & Regular sections rendered by JS -->
  </div>
  <section class="card-container" id="produkGrid" style="display:none">
    <div style="grid-column:1/-1;text-align:center;padding:30px"><div class="spinner"></div></div>
  </section>

  <section class="order-section">
    <div class="form-card">
      <div class="form-title">⚡ Form Order</div>
      <div class="cart-summary-banner" id="cartSummaryBanner">
        <div class="csb-title">🛒 Keranjang Belanja</div>
        <div id="cartSummaryItems"></div>
        <div class="csb-total"><span>TOTAL</span><span id="cartSummaryTotal">Rp0</span></div>
      </div>
      <div class="selected-product-banner" id="selectedBanner">
        <span id="selectedName">—</span>
        <span id="selectedPriceTag" style="font-size:12px;opacity:0.65;"></span>
      </div>
      <div class="input-row"><label class="input-label">Username Fishit</label><input type="text" class="input-field" id="username" placeholder="Masukkan username..."></div>

      <div class="voucher-row">
        <input type="text" class="voucher-input" id="voucherInput" placeholder="Punya kode voucher? (opsional)">
        <button class="btn-voucher" onclick="applyVoucher()">🎟 Pakai</button>
      </div>
      <div id="voucherHintWrap">
        <div class="voucher-hint-toggle" onclick="toggleVoucherHint()">
          <span>🏷 Lihat voucher tersedia</span>
          <span id="voucherHintArrow" style="font-size:10px;color:rgba(255,215,0,0.4);transition:transform 0.25s;display:inline-block">▼</span>
        </div>
        <div class="voucher-hint-box" id="voucherHintBox">
          <div class="voucher-hint-title">🎟 Voucher Aktif — Tap untuk pakai</div>
          <div class="voucher-hint-list" id="voucherHintList"></div>
        </div>
      </div>
      <div class="voucher-badge" id="voucherBadge">
        <span>🎟</span><span id="voucherBadgeText">—</span>
        <button class="btn-voucher-remove" onclick="removeVoucher()">✕</button>
      </div>
      <div class="input-row">
        <label class="input-label">Metode Pembayaran</label>
        <select class="input-field" id="metode">
          <option value="">Pilih metode...</option>
          <option>DANA</option><option>OVO</option><option>GOPAY</option><option>QRIS</option>
        </select>
      </div>
      <div class="payment-card dana" id="pm-DANA">
        <div class="pm-header"><div class="pm-logo">💙</div><div class="pm-name">DANA</div></div>
        <div class="pm-divider"></div>
        <div class="pm-label">Nomor DANA</div>
        <div class="pm-number">0813-2894-1033</div>
        <div class="pm-name-rek">a.n. m.yanis Zahiruddin</div>
        <button class="btn-copy" onclick="copyNomor('0813-2894-1033',this)">📋 Salin Nomor</button>
      </div>
      <div class="payment-card ovo" id="pm-OVO">
        <div class="pm-header"><div class="pm-logo">💜</div><div class="pm-name">OVO</div></div>
        <div class="pm-divider"></div>
        <div class="pm-label">Nomor OVO</div>
        <div class="pm-number">0813-2894-1033</div>
        <div class="pm-name-rek">a.n. m.yanis Zahiruddin</div>
        <button class="btn-copy" onclick="copyNomor('0813-2894-1033',this)">📋 Salin Nomor</button>
      </div>
      <div class="payment-card gopay" id="pm-GOPAY">
        <div class="pm-header"><div class="pm-logo">💚</div><div class="pm-name">GOPAY</div></div>
        <div class="pm-divider"></div>
        <div class="pm-label">Nomor GoPay</div>
        <div class="pm-number">0813-2894-1033</div>
        <div class="pm-name-rek">a.n. m.yanis Zahiruddin</div>
        <button class="btn-copy" onclick="copyNomor('0813-2894-1033',this)">📋 Salin Nomor</button>
      </div>
      <div class="payment-card qris" id="pm-QRIS">
        <div class="pm-header"><div class="pm-logo">⚡</div><div class="pm-name">QRIS</div></div>
        <div class="pm-divider"></div>
        <div class="pm-label" style="font-size:14px;color:#00ffe1;font-weight:600;">QR Code tampil setelah klik Order</div>
      </div>
      <div class="input-row"><label class="input-label">Jumlah Pembelian</label><input type="number" class="input-field" id="jumlah" min="1" value="1" oninput="updateTotal()"></div>
      <div class="total-display"><span class="total-label">Total Bayar</span><span class="total-amount" id="totalBox">Rp0</span></div>
      <div class="summary-box" id="summaryBox"></div>
      <div class="id-box" id="idPembayaranBox">🔑 ID: —</div>
      <button class="btn-order" id="btnOrder" onclick="submitOrder()">ORDER SEKARANG</button>
      <div class="divider">CEK STATUS</div>
      <div class="input-row"><label class="input-label">ID Pembayaran</label><input type="text" class="input-field" id="cekId" placeholder="NEO-XXXXX-XXX"></div>
      <button class="btn-cek" onclick="cekStatus()">🔍 Cek Status</button>
      <div class="hasil-cek" id="hasilCek"></div>
    </div>
  </section>

  <section class="upload-section" id="uploadSection" style="display:none">
    <p class="section-title" style="margin-top:0">— Upload Bukti Bayar —</p>
    <div class="upload-card">
      <div class="upload-title">📎 Bukti Transfer</div>
      <div class="upload-sub">Selesaikan pembayaran lalu upload bukti di bawah</div>
      <div class="upload-steps">
        <span>1️⃣</span> Bayar ke nomor / QRIS yang tertera<br>
        <span>2️⃣</span> Screenshot bukti bayar<br>
        <span>3️⃣</span> Upload foto → klik <span>Kirim Bukti</span><br>
        <span>4️⃣</span> Diarahkan ke WhatsApp otomatis ✓
      </div>
      <div class="upload-id-row">
        <input type="text" class="upload-id-input" id="uploadOrderId" placeholder="ID Order (NEO-XXXXX-XXX)" readonly>
        <button class="btn-autofill" onclick="autofillOrderId()">⚡ ID Terakhir</button>
      </div>
      <label for="buktiFile" class="drop-zone" id="dropZone">
        <div class="drop-icon">📸</div>
        <div class="drop-text">Tap untuk pilih foto bukti</div>
        <div class="drop-sub">JPG, PNG — maks 5MB</div>
      </label>
      <input type="file" id="buktiFile" accept="image/*" onchange="handleFileSelect(event)" style="position:absolute;left:-9999px;opacity:0;width:1px;height:1px;">
      <div class="bukti-preview" id="buktiPreview">
        <img id="buktiPreviewImg" src="" alt="Preview">
        <div class="bukti-preview-overlay"><span class="bukti-preview-label">📎 Bukti Transfer</span></div>
        <button class="bukti-remove" onclick="removeBukti()">✕</button>
      </div>
      <div class="upload-progress" id="uploadProgress">
        <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressFill"></div></div>
        <div class="progress-label" id="progressLabel">Mengkompres foto...</div>
      </div>
      <button class="btn-upload-submit" id="btnUpload" onclick="submitBukti()">📤 KIRIM BUKTI → LANJUT KE WHATSAPP</button>
    </div>
  </section>
</div>

<!-- ═══ TESTIMONI PAGE ═══ -->
<div class="page" id="page-testi">
  <div class="testi-page-wrap">
    <div class="testi-page-title">💬 Testimoni</div>
    <div class="testi-page-sub">// ulasan dari pembeli setia</div>
    <div class="testi-form-card">
      <div class="testi-form-title">✍ Tulis Ulasan</div>
      <div class="input-row"><label class="input-label">Username</label><input type="text" class="input-field" id="testiUser" placeholder="Username kamu..."></div>
      <div class="input-row">
        <label class="input-label">Produk</label>
        <select class="input-field" id="testiProduk"><option value="">Pilih produk...</option></select>
      </div>
      <div class="input-row">
        <label class="input-label">Rating</label>
        <div class="stars-input" id="starsInput">
          <button class="star-btn" data-val="1" onclick="setRating(1)">⭐</button>
          <button class="star-btn" data-val="2" onclick="setRating(2)">⭐</button>
          <button class="star-btn" data-val="3" onclick="setRating(3)">⭐</button>
          <button class="star-btn" data-val="4" onclick="setRating(4)">⭐</button>
          <button class="star-btn" data-val="5" onclick="setRating(5)">⭐</button>
        </div>
      </div>
      <div class="input-row"><label class="input-label">Ulasan</label><textarea class="input-field" id="testiText" placeholder="Bagikan pengalaman kamu..." style="resize:none;height:80px;line-height:1.5"></textarea></div>
      <button class="btn-testi-submit" onclick="submitTesti()">🚀 KIRIM ULASAN</button>
    </div>
    <div class="testi-grid" id="testiList">
      <div style="grid-column:1/-1;text-align:center;padding:30px"><div class="spinner"></div></div>
    </div>
  </div>
</div>

<!-- ═══ RIWAYAT PAGE ═══ -->
<div class="page" id="page-riwayat">
  <div class="riwayat-header">
    <div class="riwayat-title">📋 Riwayat Order</div>
    <div class="riwayat-sub">// tersimpan di perangkat ini</div>
    <div class="riwayat-stats">
      <div class="rw-stat s-total"><div class="rw-stat-label">Total</div><div class="rw-stat-val" id="rwTotal">0</div></div>
      <div class="rw-stat s-berhasil"><div class="rw-stat-label">Berhasil</div><div class="rw-stat-val" id="rwBerhasil">0</div></div>
      <div class="rw-stat s-pending"><div class="rw-stat-label">Pending</div><div class="rw-stat-val" id="rwPending">0</div></div>
    </div>
    <div class="riwayat-toolbar">
      <div class="rw-filter-tabs">
        <button class="rw-tab active" onclick="setRwFilter('semua',this)">Semua</button>
        <button class="rw-tab" onclick="setRwFilter('PENDING',this)">⏳ Pending</button>
        <button class="rw-tab" onclick="setRwFilter('BERHASIL',this)">✓ Berhasil</button>
        <button class="rw-tab" onclick="setRwFilter('GAGAL',this)">✕ Gagal</button>
      </div>
      <div class="rw-actions">
        <button class="btn-export-rw" onclick="exportRiwayat()">📊 Export</button>
        <button class="btn-clear-riwayat" onclick="clearRiwayat()">🗑 Hapus</button>
      </div>
    </div>
    <div class="riwayat-list" id="riwayatList"></div>
  </div>
</div>

<!-- ═══ ADMIN PAGE ═══ -->
<div class="page" id="page-admin">
  <div class="admin-header-bar">
    <div class="admin-title">⚙ Admin Panel</div>
    <button class="btn-logout" onclick="logout()">⏏ Keluar</button>
  </div>
  <div class="admin-tab-bar">
    <button class="admin-tab-btn active" id="atOrders" onclick="switchAdminTab('orders')">🛒 Orders</button>
    <button class="admin-tab-btn" id="atProduk" onclick="switchAdminTab('produk')">📦 Produk</button>
    <button class="admin-tab-btn" id="atSettings" onclick="switchAdminTab('settings')">⚙ Settings</button>
  </div>
  <div class="admin-section active" id="as-orders">
    <div class="admin-stats">
      <div class="stat-card total"><div class="stat-label">Total</div><div class="stat-value total-v" id="statTotal">—</div></div>
      <div class="stat-card berhasil"><div class="stat-label">Berhasil</div><div class="stat-value berhasil-v" id="statBerhasil">—</div></div>
      <div class="stat-card pending"><div class="stat-label">Pending</div><div class="stat-value pending-v" id="statPending">—</div></div>
    </div>
    <div class="omzet-bar">
      <div class="omzet-card">
        <div>
          <div class="omzet-label">Total Omzet</div>
          <div class="omzet-val" id="omzetTotal">Rp0</div>
          <div class="omzet-sub" id="omzetSub">dari 0 transaksi berhasil</div>
        </div>
        <div style="text-align:right">
          <div class="omzet-label">Bulan Ini</div>
          <div class="omzet-val" id="omzetBulan" style="font-size:16px">Rp0</div>
          <div class="omzet-sub" id="omzetBulanSub">0 transaksi</div>
        </div>
      </div>
    </div>
    <div class="chart-wrap">
      <div class="chart-card">
        <div class="chart-title">📊 Penjualan 7 Hari Terakhir</div>
        <div class="chart-bars" id="chartBars"></div>
      </div>
    </div>
    <div class="filter-tabs">
      <button class="filter-tab active" onclick="setFilter('semua',this)">Semua</button>
      <button class="filter-tab" onclick="setFilter('PENDING',this)">⏳ Pending</button>
      <button class="filter-tab" onclick="setFilter('BERHASIL',this)">✓ Berhasil</button>
      <button class="filter-tab" onclick="setFilter('GAGAL',this)">✕ Gagal</button>
    </div>
    <div class="date-filter-wrap">
      <span style="font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:rgba(0,255,225,0.4);">📅 DARI</span>
      <input type="date" class="date-filter-input" id="dateFrom" onchange="renderOrders()">
      <span style="font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:rgba(0,255,225,0.4);">S/D</span>
      <input type="date" class="date-filter-input" id="dateTo" onchange="renderOrders()">
      <button class="btn-clear-date" onclick="clearDateFilter()">✕ Reset</button>
    </div>
    <div class="admin-toolbar">
      <div class="live-badge" id="liveBadge" style="display:none"><div class="live-dot"></div> LIVE</div>
      <div class="admin-action-btns">
        <button class="btn-export" onclick="exportExcel()">📊 Export Excel</button>
        <button class="btn-clear" onclick="clearAllOrders()">🗑 Hapus Semua</button>
      </div>
    </div>
    <div class="orders-list" id="ordersList"><div class="loading-state"><div class="spinner"></div></div></div>
  </div>
  <div class="admin-section" id="as-produk">
    <button class="btn-add-produk" onclick="openProdukModal()">＋ TAMBAH PRODUK BARU</button>
    <div class="produk-admin-grid" id="produkAdminGrid"><div class="loading-state" style="grid-column:1/-1"><div class="spinner"></div></div></div>
  </div>
  <div class="admin-section" id="as-settings">
    <div class="settings-section">
      <div class="settings-card">
        <div class="settings-title">🔥 Promo & Countdown</div>
        <div class="promo-toggle-row">
          <span class="toggle-label">Tampilkan promo banner</span>
          <label class="toggle-switch"><input type="checkbox" id="promoToggle" checked onchange="savePromoSettings()"><span class="toggle-slider"></span></label>
        </div>
        <div class="input-row"><label class="input-label">Durasi Countdown</label><div style="display:flex;gap:8px;"><input type="number" class="input-field" id="promoDuration" value="24" min="1" style="flex:1" onchange="savePromoSettings()"><select class="input-field" id="promoDurationUnit" style="width:100px" onchange="savePromoSettings()"><option value="menit">Menit</option><option value="jam" selected>Jam</option><option value="hari">Hari</option></select></div></div>
        <div class="input-row"><label class="input-label">Label Promo</label><input type="text" class="input-field" id="promoLabel" value="Flash Sale!" placeholder="Flash Sale! / Promo Spesial..." onchange="savePromoSettings()"></div>
      </div>
      <div class="settings-card voucher-settings-card">
        <div class="settings-title">🎟 Kelola Voucher Diskon</div>
        <div class="tpl-hint">Buat kode voucher untuk pembeli. Diskon dihitung dari total belanja.</div>
        <div class="promo-toggle-row" style="margin-bottom:12px;">
          <span class="toggle-label" style="font-size:12px;">Tampilkan daftar voucher ke pembeli</span>
          <label class="toggle-switch"><input type="checkbox" id="voucherVisibleToggle" checked onchange="saveVoucherVisibility()"><span class="toggle-slider"></span></label>
        </div>
        <div class="voucher-add-row">
          <input type="text" id="vcCode" placeholder="Kode (misal: HEMAT10)" maxlength="20">
          <input type="number" id="vcDiskon" placeholder="Diskon %" min="1" max="99" style="max-width:90px">
          <input type="number" id="vcMin" placeholder="Min. belanja" style="max-width:110px">
          <button class="btn-add-voucher" onclick="addVoucher()">✚ Tambah</button>
        </div>
        <div class="voucher-list" id="voucherAdminList"></div>
      </div>
        <div class="tpl-hint">Variabel yang tersedia:<br>{ID} = ID Order · {USER} = Username<br>{PRODUK} = Nama Produk · {JML} = Jumlah<br>{TOTAL} = Total Bayar · {METODE} = Metode Bayar</div>
        <textarea class="wa-tpl-input" id="waTplInput">Halo Admin, saya mau beli:

🔑 ID: {ID}
👤 Username: {USER}
📦 Produk: {PRODUK}
🔢 Jumlah: {JML}
💰 Total: {TOTAL}
💳 Metode: {METODE}

Terimakasih sudah order di NEOSTORE ⚡</textarea>
        <button class="btn-save-settings" onclick="saveWaTpl()">💾 Simpan Template</button>
      </div>
    </div>
  </div>
</div>

<!-- PRODUK MODAL -->
<div id="produkModal">
  <div class="produk-modal-box">
    <div class="modal-handle"></div>
    <div class="modal-title" id="modalTitle">✚ Tambah Produk</div>
    <div class="input-row">
      <label class="input-label">Foto Produk</label>
      <label for="modalImgFile" class="img-upload-zone" id="modalImgZone">
        <div class="upload-hint" style="display:flex;flex-direction:column;align-items:center"><span style="font-size:28px;margin-bottom:8px">🖼</span>Tap untuk pilih foto produk</div>
      </label>
      <input type="file" id="modalImgFile" accept="image/*" onchange="handleModalImg(event)" style="position:absolute;left:-9999px;opacity:0;width:1px;height:1px;">
    </div>
    <div class="input-row"><label class="input-label">Nama Produk</label><input type="text" class="input-field" id="modalNama" placeholder="Contoh: Megalodon..."></div>
    <div class="input-row"><label class="input-label">Harga (Rp)</label><input type="number" class="input-field" id="modalHarga" placeholder="Contoh: 10000" min="0"></div>
    <div class="input-row"><label class="input-label">Stok (-1 = tidak terbatas)</label><input type="number" class="input-field" id="modalStok" placeholder="-1" value="-1"></div>
    <div class="input-row"><label class="input-label">Deskripsi (opsional)</label><input type="text" class="input-field" id="modalDeskripsi" placeholder="Contoh: Item langka S-tier..."></div>

    <!-- ✅ FLASH SALE FIELDS -->
    <div class="input-row">
      <div class="promo-toggle-row" style="margin-bottom:0">
        <span class="toggle-label" style="color:var(--red);">🔥 Produk Flash Sale</span>
        <label class="toggle-switch toggle-sale">
          <input type="checkbox" id="modalIsPromo" onchange="toggleDiskonField()">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    <div class="input-row" id="diskonRow" style="display:none">
      <label class="input-label" style="color:rgba(255,77,109,0.6)">Diskon (%)</label>
      <input type="number" class="input-field" id="modalDiskon"
        placeholder="Contoh: 20 (artinya diskon 20%)" min="1" max="99" value="10"
        style="border-color:rgba(255,77,109,0.3);">
      <div style="margin-top:6px;font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,77,109,0.4);letter-spacing:1px;" id="diskonPreview"></div>
    </div>

    <div class="modal-btns">
      <button class="btn-modal-cancel" onclick="closeProdukModal()">Batal</button>
      <button class="btn-modal-save" id="btnModalSave" onclick="saveProduk()">💾 SIMPAN</button>
    </div>
  </div>
</div>

<!-- CART POPUP -->
<div id="cartPopup">
  <div class="cart-box">
    <div class="cart-handle"></div>
    <div class="cart-title">🛒 Keranjang<button class="btn-cart-close" onclick="closeCart()">✕</button></div>
    <div id="cartItemsWrap"></div>
    <div class="cart-total-row"><span class="cart-total-label">Total</span><span class="cart-total-val" id="cartTotalVal">Rp0</span></div>
    <button class="btn-checkout" onclick="checkoutFromCart()">⚡ CHECKOUT SEKARANG</button>
  </div>
</div>

<!-- SHARE POPUP -->
<div id="sharePopup">
  <div class="share-box">
    <div class="share-handle"></div>
    <div class="share-title">📤 Bagikan Produk</div>
    <div class="share-btns">
      <button class="share-btn wa" onclick="shareWA()"><span>💬</span>WhatsApp</button>
      <button class="share-btn ig" onclick="shareIG()"><span>📸</span>Instagram</button>
      <button class="share-btn copy" onclick="shareCopyLink()"><span>🔗</span>Salin Link</button>
      <button class="share-btn close" onclick="closeShare()"><span>✕</span>Tutup</button>
    </div>
  </div>
</div>

<!-- ═══ WISHLIST PAGE ═══ -->
<div class="page" id="page-wishlist">
  <div class="wishlist-header">
    <div class="wishlist-title">❤️ Wishlist</div>
    <div class="wishlist-sub">// produk favorit kamu</div>
  </div>
  <div class="wishlist-grid" id="wishlistGrid">
    <div style="grid-column:1/-1" class="wishlist-empty">❤️<br>Belum ada produk favorit.<br><span style="font-size:11px">Tap 🤍 di kartu produk untuk menyimpan.</span></div>
  </div>
</div>

<!-- PRODUK PREVIEW POPUP -->
<div id="produkPreviewPopup">
  <div class="preview-box">
    <div class="preview-img-wrap" id="previewImgWrap">
      <button class="preview-close" onclick="closePreview()">✕</button>
    </div>
    <div class="preview-body">
      <div class="preview-name" id="previewName">—</div>
      <div class="preview-price-row">
        <div class="preview-price" id="previewPrice">Rp0</div>
        <div class="preview-price-ori" id="previewPriceOri" style="display:none"></div>
        <div class="preview-badge" id="previewBadge" style="display:none"></div>
      </div>
      <div class="preview-meta">
        <div class="preview-meta-chip stok" id="previewStok"></div>
        <div class="preview-meta-chip sold" id="previewSold" style="display:none"></div>
      </div>
      <div class="preview-desc" id="previewDesc"></div>
    </div>
    <div class="preview-actions">
      <button class="btn-preview-cart" id="btnPreviewCart" onclick="previewAddCart()">🛒 Keranjang</button>
      <button class="btn-preview-beli" id="btnPreviewBeli" onclick="previewBeli()">⚡ BELI SEKARANG</button>
    </div>
  </div>
</div>
<nav class="bottom-nav">
  <button class="bottom-tab active" id="tabStore" onclick="showPage('store')"><div class="tab-icon">🛒</div><div class="tab-label">Store</div></button>
  <button class="bottom-tab" id="tabWishlist" onclick="showPage('wishlist')"><div class="tab-icon">❤️</div><div class="tab-label">Wishlist</div><div class="tab-badge" id="wlBadge" style="display:none">0</div></button>
  <button class="bottom-tab" id="tabTesti" onclick="showPage('testi')"><div class="tab-icon">💬</div><div class="tab-label">Ulasan</div></button>
  <button class="bottom-tab" id="tabRiwayat" onclick="showPage('riwayat')" style="position:relative"><div class="tab-icon">📋</div><div class="tab-label">Riwayat</div><div class="tab-badge" id="rwBadge" style="display:none">0</div></button>
</nav>

<!-- LIGHTBOX -->
<div id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">✕</button>
  <img id="lightboxImg" src="" alt="Bukti">
  <div class="lightbox-label" id="lightboxLabel"></div>
</div>

<!-- PIN POPUP -->
<div id="pwPopup">
  <div class="pw-box">
    <div class="pw-icon">🔐</div>
    <div class="pw-title">Admin Access</div>
    <div class="pw-sub">masukkan PIN untuk melanjutkan</div>
    <div class="pin-dots" id="pinDots">
      <div class="pin-dot" id="pd0"></div><div class="pin-dot" id="pd1"></div>
      <div class="pin-dot" id="pd2"></div><div class="pin-dot" id="pd3"></div>
    </div>
    <div class="numpad">
      <button class="num-btn" onclick="pinInput('1')">1</button><button class="num-btn" onclick="pinInput('2')">2</button><button class="num-btn" onclick="pinInput('3')">3</button>
      <button class="num-btn" onclick="pinInput('4')">4</button><button class="num-btn" onclick="pinInput('5')">5</button><button class="num-btn" onclick="pinInput('6')">6</button>
      <button class="num-btn" onclick="pinInput('7')">7</button><button class="num-btn" onclick="pinInput('8')">8</button><button class="num-btn" onclick="pinInput('9')">9</button>
      <button class="num-btn empty"></button><button class="num-btn" onclick="pinInput('0')">0</button><button class="num-btn del" onclick="pinDelete()">⌫</button>
    </div>
    <button class="pw-cancel" onclick="closePwPopup()">batal</button>
  </div>
</div>

<!-- QRIS POPUP -->
<div id="qrisPopup">
  <div class="qrisContent">
    <div class="qris-handle"></div>
    <h3>Scan QRIS</h3>
    <img src="img/qris.jpg" alt="QRIS">
    <div class="qris-amount" id="qrisAmount">Rp0</div>
    <div style="font-size:11px;color:rgba(255,255,255,0.3);letter-spacing:1px;font-family:'Share Tech Mono',monospace;">scan QR lalu upload bukti bayar</div>
    <div class="qris-btns">
      <button class="btn-sudah" onclick="sudahBayar()">✓ Sudah Bayar</button>
      <button class="btn-tutup" onclick="tutupQR()">✕ Tutup</button>
    </div>
  </div>
</div>

<script>
(function(){const c=document.getElementById('matrixCanvas'),ctx=c.getContext('2d');let cols,drops;const chars='アイウエオ0123456789ABCDEF'.split('');function resize(){c.width=window.innerWidth;c.height=window.innerHeight;cols=Math.floor(c.width/20);drops=Array(cols).fill(1);}function draw(){ctx.fillStyle='rgba(4,12,18,0.05)';ctx.fillRect(0,0,c.width,c.height);drops.forEach((y,i)=>{ctx.fillStyle=Math.random()>.95?'#fff':(Math.random()>.5?'rgba(0,255,225,0.85)':'rgba(0,180,200,0.4)');ctx.font='13px Share Tech Mono,monospace';ctx.fillText(chars[Math.floor(Math.random()*chars.length)],i*20,y*20);if(y*20>c.height&&Math.random()>.975)drops[i]=0;drops[i]++;});}resize();window.addEventListener('resize',resize);setInterval(draw,60);})();
(function(){const c=document.getElementById('particleCanvas'),ctx=c.getContext('2d');let p=[],mouse={x:-999,y:-999};function resize(){c.width=window.innerWidth;c.height=window.innerHeight;}resize();window.addEventListener('resize',resize);window.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY;});class P{constructor(){this.reset();}reset(){this.x=Math.random()*c.width;this.y=Math.random()*c.height;this.size=Math.random()*1.4+0.3;this.bx=this.x;this.by=this.y;this.vx=(Math.random()-.5)*.25;this.vy=(Math.random()-.5)*.25;this.op=Math.random()*.4+.08;this.col=Math.random()>.5?'0,255,225':'0,180,255';}update(){const dx=mouse.x-this.x,dy=mouse.y-this.y,d=Math.sqrt(dx*dx+dy*dy);if(d<80){const f=(80-d)/80;this.vx-=(dx/d)*f*.4;this.vy-=(dy/d)*f*.4;}this.vx+=(this.bx-this.x)*.002;this.vy+=(this.by-this.y)*.002;this.vx*=.96;this.vy*=.96;this.x+=this.vx;this.y+=this.vy;}draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle=`rgba(${this.col},${this.op})`;ctx.fill();}}for(let i=0;i<80;i++)p.push(new P());function animate(){ctx.clearRect(0,0,c.width,c.height);for(let i=0;i<p.length;i++)for(let j=i+1;j<p.length;j++){const dx=p[i].x-p[j].x,dy=p[i].y-p[j].y,d=Math.sqrt(dx*dx+dy*dy);if(d<85){ctx.beginPath();ctx.strokeStyle=`rgba(0,255,225,${.05*(1-d/85)})`;ctx.lineWidth=.5;ctx.moveTo(p[i].x,p[i].y);ctx.lineTo(p[j].x,p[j].y);ctx.stroke();}}p.forEach(pt=>{pt.update();pt.draw();});requestAnimationFrame(animate);}animate();})();
</script>

<script>
const ADMIN_PIN = '1212';
let dataOrder={}, allOrders=[], currentFilter='semua', rwFilter='semua';
let fbReady=false, isAdminLoggedIn=false;
let allProduks=[], editingProdukId=null, modalImgBase64=null, selectedProduk=null;
let cart=[], currentShareProduk=null, currentRating=0;
let waTemplate='';
let countdownTarget=null, countdownInterval=null;
const RW_KEY='neo_riwayat';

// ════ SPLASH ════
(function(){
  let pct=0;
  const bar=document.getElementById('splashBar'),txt=document.getElementById('splashPct');
  const intv=setInterval(()=>{
    pct+=Math.random()*12+3;
    if(pct>=100){pct=100;clearInterval(intv);}
    bar.style.width=pct+'%';txt.textContent=Math.round(pct)+'%';
    if(pct>=100){setTimeout(()=>{const s=document.getElementById('splashScreen');s.style.opacity='0';setTimeout(()=>s.remove(),600);},400);}
  },120);
})();

// ════ KONFETI ════
function launchKonfeti(){
  const container=document.getElementById('konfeti');
  const colors=['#00ffe1','#00b0ff','#ff4d6d','#ffa94d','#69db7c','#ffd43b','#c084fc'];
  for(let i=0;i<80;i++){
    const el=document.createElement('div');el.className='konfeti-piece';
    el.style.left=Math.random()*100+'vw';el.style.background=colors[Math.floor(Math.random()*colors.length)];
    el.style.width=Math.random()*10+6+'px';el.style.height=Math.random()*10+6+'px';
    el.style.borderRadius=Math.random()>.5?'50%':'2px';
    el.style.animationDuration=Math.random()*2+2+'s';el.style.animationDelay=Math.random()*1.5+'s';
    container.appendChild(el);setTimeout(()=>el.remove(),(Math.random()*2+2)*1000+1500+i*20);
  }
}

// ════ COUNTDOWN ════
async function resetFlashSaleProduks(){
  if(!fbReady||!window._fb)return;
  const{db,doc,updateDoc}=window._fb;
  const promoList=allProduks.filter(p=>p.isPromo);
  for(const p of promoList){
    await updateDoc(doc(db,'produks',p.docId),{isPromo:false,diskon:0});
  }
  if(promoList.length>0)showToast('⏰ Flash Sale berakhir! Harga produk kembali normal.');
}

function startCountdown(forceNew){
  if(countdownInterval) clearInterval(countdownInterval);
  const saved=localStorage.getItem('neo_countdown_end');
  if(!forceNew && saved && Date.now()<parseInt(saved)){
    // Lanjutkan timer yang sudah ada (setelah refresh)
    countdownTarget=parseInt(saved);
    document.getElementById('promoBanner').style.display='block';
  } else if(forceNew){
    // Admin set timer baru
    const durVal=parseInt(document.getElementById('promoDuration')?.value)||24;
    const durUnit=document.getElementById('promoDurationUnit')?.value||'jam';
    const multiplier=durUnit==='menit'?60000:durUnit==='hari'?86400000:3600000;
    const dur=durVal*multiplier;
    countdownTarget=Date.now()+dur;
    localStorage.setItem('neo_countdown_end',countdownTarget);
    document.getElementById('promoBanner').style.display='block';
  } else {
    // Tidak ada timer tersimpan dan bukan dari admin — sembunyikan banner
    document.getElementById('promoBanner').style.display='none';
    return;
  }
  countdownInterval=setInterval(()=>{
    const diff=countdownTarget-Date.now();
    if(diff<=0){
      clearInterval(countdownInterval);
      localStorage.removeItem('neo_countdown_end');
      document.getElementById('promoBanner').style.display='none';
      resetFlashSaleProduks();
      return;
    }
    const h=Math.floor(diff/3600000),m=Math.floor((diff%3600000)/60000),s=Math.floor((diff%60000)/1000);
    document.getElementById('cdH').textContent=String(h).padStart(2,'0');
    document.getElementById('cdM').textContent=String(m).padStart(2,'0');
    document.getElementById('cdS').textContent=String(s).padStart(2,'0');
  },1000);
}
startCountdown(false); // Saat load: lanjutkan timer lama kalau ada

// ════ FIREBASE ════
window.addEventListener('firebase-ready',()=>{
  fbReady=true;setFbStatus('connected','online');
  startPublicSync();startProdukListener();startTestiListener();loadSettings();
});
function setFbStatus(t,txt){
  const dot=document.getElementById('fbDot'),lbl=document.getElementById('fbStatusText');
  dot.className='fb-dot '+(t==='connected'?'connected':t==='error'?'error':'');
  lbl.textContent=txt;lbl.style.color=t==='connected'?'var(--green)':t==='error'?'var(--red)':'rgba(255,255,255,0.3)';
}
function startPublicSync(){
  if(!window._fb)return;
  const{ordersRef,onSnapshot,query,orderBy}=window._fb;
  const q=query(ordersRef,orderBy('timestamp','desc'));
  onSnapshot(q,snap=>{
    const prev=allOrders.map(o=>o.id);
    allOrders=snap.docs.map(d=>({docId:d.id,...d.data()}));
    if(isAdminLoggedIn){allOrders.forEach(o=>{if(!prev.includes(o.id)&&o.status==='PENDING'){playNotifSound();sendBrowserNotif('🔔 Order Baru!',`${o.username} - ${o.produk}`);}});}
    syncRiwayatStatus(allOrders);
    if(isAdminLoggedIn){updateStats();renderOrders();renderChart();updateOmzet();document.getElementById('liveBadge').style.display='inline-flex';}
  });
}
async function loadSettings(){
  if(!window._fb)return;
  const{getDocs,settingsRef}=window._fb;
  try{
    const snap=await getDocs(settingsRef);
    snap.forEach(d=>{
      const data=d.data();
      if(d.id==='wa_template'&&data.template){waTemplate=data.template;const el=document.getElementById('waTplInput');if(el)el.value=data.template;}
      if(d.id==='promo'&&data.label){
        const el=document.getElementById('promoLabel');if(el)el.value=data.label;
        const lbl=document.getElementById('promoTextLabel');if(lbl)lbl.textContent=data.label;
      }
    });
  }catch(e){}
}
async function saveWaTpl(){
  const tpl=document.getElementById('waTplInput').value;waTemplate=tpl;
  if(!window._fb){showToast('✓ Template disimpan lokal!');return;}
  const{addDoc,settingsRef}=window._fb;
  try{await addDoc(settingsRef,{id:'wa_template',template:tpl});showToast('✓ Template WA disimpan!');}
  catch(e){showToast('✓ Template disimpan!');}
}
function savePromoSettings(){
  const show=document.getElementById('promoToggle')?.checked;
  const lbl=document.getElementById('promoLabel')?.value||'Flash Sale!';
  const lblEl=document.getElementById('promoTextLabel');if(lblEl)lblEl.textContent=lbl;
  if(show){
    // Admin aktifkan flash sale — buat timer baru
    localStorage.removeItem('neo_countdown_end');
    startCountdown(true);
  } else {
    // Admin matikan flash sale
    if(countdownInterval) clearInterval(countdownInterval);
    localStorage.removeItem('neo_countdown_end');
    document.getElementById('promoBanner').style.display='none';
  }
}

// ════ NOTIFIKASI ════
function checkNotifPermission(){if('Notification' in window&&Notification.permission==='default')document.getElementById('notifBanner').classList.add('visible');}
function requestNotifPermission(){if(!('Notification' in window))return;Notification.requestPermission().then(p=>{document.getElementById('notifBanner').classList.remove('visible');if(p==='granted')showToast('✓ Notifikasi diaktifkan!');});}
function sendBrowserNotif(title,body){if('Notification' in window&&Notification.permission==='granted')new Notification(title,{body,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">⚡</text></svg>'});}
function notifStatusBerubah(id,status){if(status==='BERHASIL')sendBrowserNotif('✓ Order Dikonfirmasi!',`Order ${id} sudah dikonfirmasi admin.`);if(status==='GAGAL')sendBrowserNotif('✕ Order Ditolak',`Order ${id} ditolak admin.`);}
function playNotifSound(){
  try{
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    const osc=ctx.createOscillator(),gain=ctx.createGain();
    osc.connect(gain);gain.connect(ctx.destination);
    osc.frequency.setValueAtTime(880,ctx.currentTime);osc.frequency.setValueAtTime(1100,ctx.currentTime+0.1);osc.frequency.setValueAtTime(880,ctx.currentTime+0.2);
    gain.gain.setValueAtTime(0.3,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.4);
    osc.start(ctx.currentTime);osc.stop(ctx.currentTime+0.4);
  }catch(e){}
}

// ════ KERANJANG ════
function addToCart(idx){
  const p=allProduks[idx];if(!p)return;
  // gunakan harga diskon jika produk promo
  const isPromo=!!p.isPromo,diskon=p.diskon||0;
  const hargaPakai=isPromo&&diskon>0?Math.round(p.harga*(1-diskon/100)):p.harga;
  const existing=cart.find(c=>c.docId===p.docId);
  if(existing)existing.qty++;else cart.push({...p,hargaPakai,qty:1});
  updateCartUI();showToast(`✓ ${p.nama} ditambah ke keranjang!`);
  const btn=document.querySelector('.nav-cart-btn');btn.style.transform='scale(1.3)';setTimeout(()=>btn.style.transform='',200);
}
function updateCartUI(){
  const total=cart.reduce((s,i)=>s+i.qty,0);
  const cc=document.getElementById('cartCount');cc.textContent=total;cc.style.display=total>0?'flex':'none';
  renderCartItems();updateCartSummary();
}
function renderCartItems(){
  const wrap=document.getElementById('cartItemsWrap');
  if(!cart.length){wrap.innerHTML='<div class="cart-empty">🛒 Keranjang kosong</div>';document.getElementById('cartTotalVal').textContent='Rp0';return;}
  wrap.innerHTML=cart.map((item,i)=>`
    <div class="cart-item">
      <div class="cart-item-img" style="${item.gambar?'background-image:url('+item.gambar+')':''}"></div>
      <div class="cart-item-info">
        <div class="cart-item-name">${item.nama}${item.isPromo?` 🔥-${item.diskon}%`:''}</div>
        <div class="cart-item-price">Rp${((item.hargaPakai||item.harga)*item.qty).toLocaleString('id-ID')}</div>
      </div>
      <div class="cart-qty-wrap">
        <button class="cart-qty-btn" onclick="cartQty(${i},-1)">−</button>
        <span class="cart-qty-num">${item.qty}</span>
        <button class="cart-qty-btn" onclick="cartQty(${i},1)">+</button>
        <button class="cart-remove" onclick="cartRemove(${i})">✕</button>
      </div>
    </div>`).join('');
  const total=cart.reduce((s,i)=>s+(i.hargaPakai||i.harga)*i.qty,0);
  document.getElementById('cartTotalVal').textContent='Rp'+total.toLocaleString('id-ID');
}
function cartQty(idx,d){cart[idx].qty+=d;if(cart[idx].qty<=0)cart.splice(idx,1);updateCartUI();}
function cartRemove(idx){cart.splice(idx,1);updateCartUI();}
function openCart(){document.getElementById('cartPopup').style.display='flex';renderCartItems();}
function closeCart(){document.getElementById('cartPopup').style.display='none';}
function updateCartSummary(){
  const banner=document.getElementById('cartSummaryBanner'),itemsEl=document.getElementById('cartSummaryItems'),totalEl=document.getElementById('cartSummaryTotal');
  if(!cart.length){banner.classList.remove('visible');return;}
  banner.classList.add('visible');
  itemsEl.innerHTML=cart.map(i=>`<div class="csb-item"><span>${i.nama} x${i.qty}</span><span>Rp${((i.hargaPakai||i.harga)*i.qty).toLocaleString('id-ID')}</span></div>`).join('');
  totalEl.textContent='Rp'+cart.reduce((s,i)=>s+(i.hargaPakai||i.harga)*i.qty,0).toLocaleString('id-ID');
}
function checkoutFromCart(){
  if(!cart.length){showToast('⚠ Keranjang kosong!');return;}
  closeCart();
  dataOrder.id=generateId();
  dataOrder.produk=cart.map(i=>`${i.nama}(x${i.qty})`).join(', ');
  dataOrder.harga=cart.reduce((s,i)=>s+(i.hargaPakai||i.harga)*i.qty,0);
  dataOrder.jumlah=cart.reduce((s,i)=>s+i.qty,0);
  dataOrder.total=dataOrder.harga;dataOrder.isCart=true;dataOrder.cartItems=JSON.parse(JSON.stringify(cart));
  document.getElementById('selectedBanner').classList.add('visible');
  document.getElementById('selectedName').textContent=`Keranjang (${dataOrder.jumlah} item)`;
  document.getElementById('selectedPriceTag').textContent='Rp'+dataOrder.total.toLocaleString('id-ID');
  document.getElementById('totalBox').textContent='Rp'+dataOrder.total.toLocaleString('id-ID');
  updateCartSummary();document.querySelector('.order-section').scrollIntoView({behavior:'smooth',block:'start'});
  showToast('✓ Checkout dari keranjang!');
}

// ════ SHARE ════
function openShare(idx){currentShareProduk=allProduks[idx];document.getElementById('sharePopup').style.display='flex';}
function closeShare(){document.getElementById('sharePopup').style.display='none';}
function shareWA(){if(!currentShareProduk)return;const txt=`⚡ *${currentShareProduk.nama}* — Rp${currentShareProduk.harga.toLocaleString('id-ID')}\n\n${currentShareProduk.deskripsi||''}\n\nBeli sekarang di NEOSTORE ⚡\n${window.location.href}`;window.open('https://wa.me/?text='+encodeURIComponent(txt),'_blank');closeShare();}
function shareIG(){navigator.clipboard.writeText(window.location.href).then(()=>{showToast('✓ Link disalin! Paste di Instagram story');});closeShare();}
function shareCopyLink(){const txt=`⚡ ${currentShareProduk?.nama||'NEOSTORE'} - ${window.location.href}`;navigator.clipboard.writeText(txt).then(()=>showToast('✓ Link berhasil disalin!'));closeShare();}

// ════ SEARCH & FILTER ════
function filterProduk(){
  const q=document.getElementById('searchInput').value.toLowerCase();
  const sort=document.getElementById('sortSelect').value;
  let list=[...allProduks];
  if(q)list=list.filter(p=>(p.nama||'').toLowerCase().includes(q));
  if(sort==='price-asc')list.sort((a,b)=>a.harga-b.harga);
  else if(sort==='price-desc')list.sort((a,b)=>b.harga-a.harga);
  else if(sort==='sold')list.sort((a,b)=>(b.sold||0)-(a.sold||0));
  else if(sort==='promo')list.sort((a,b)=>(b.isPromo?1:0)-(a.isPromo?1:0));
  renderProdukStoreList(list);
}

// ════ TESTIMONI ════
let currentRatingVal=0;
function setRating(v){
  currentRatingVal=v;
  document.querySelectorAll('.star-btn').forEach((btn,i)=>btn.classList.toggle('active',i<v));
}
function startTestiListener(){
  if(!window._fb)return;
  const{testiRef,onSnapshot,query,orderBy}=window._fb;
  const q=query(testiRef,orderBy('timestamp','desc'));
  onSnapshot(q,snap=>{const testis=snap.docs.map(d=>({id:d.id,...d.data()}));renderTestiList(testis);updateTestitProdukOptions();});
}
function renderTestiList(list){
  const el=document.getElementById('testiList');
  if(!list.length){el.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:40px;color:rgba(0,255,225,0.2);font-family:Share Tech Mono,monospace;font-size:12px;letter-spacing:2px">[ BELUM ADA ULASAN ]</div>';return;}
  el.innerHTML=list.map((t,i)=>`
    <div class="testi-card" style="animation-delay:${i*0.06}s">
      <div class="testi-header">
        <div class="testi-avatar">${(t.username||'?')[0].toUpperCase()}</div>
        <div><div class="testi-name">${t.username||'Anonymous'}</div><div class="testi-produk">📦 ${t.produk||'—'}</div></div>
        <div class="testi-stars">${'⭐'.repeat(t.rating||5)}</div>
      </div>
      <div class="testi-text">${t.teks||''}</div>
      <div class="testi-time">${t.waktu||'—'}</div>
    </div>`).join('');
}
async function submitTesti(){
  const user=document.getElementById('testiUser').value.trim(),produk=document.getElementById('testiProduk').value,teks=document.getElementById('testiText').value.trim();
  if(!user){showToast('⚠ Masukkan username!');return;}
  if(!teks){showToast('⚠ Tulis ulasan dulu!');return;}
  if(!currentRatingVal){showToast('⚠ Pilih rating dulu!');return;}
  if(!window._fb){showToast('⚠ Tidak ada koneksi!');return;}
  const{testiRef,addDoc}=window._fb;
  await addDoc(testiRef,{username:user,produk,rating:currentRatingVal,teks,waktu:new Date().toLocaleString('id-ID'),timestamp:Date.now()});
  document.getElementById('testiUser').value='';document.getElementById('testiText').value='';document.getElementById('testiProduk').value='';setRating(0);
  showToast('✓ Ulasan berhasil dikirim! Terima kasih 🙏');
}

// ════ RIWAYAT ════
function getRiwayat(){try{return JSON.parse(localStorage.getItem(RW_KEY)||'[]');}catch{return [];}}
function saveToRiwayat(order){
  const list=getRiwayat();const idx=list.findIndex(o=>o.id===order.id);
  if(idx>=0)list[idx]=order;else list.unshift(order);
  if(list.length>50)list.splice(50);
  localStorage.setItem(RW_KEY,JSON.stringify(list));updateRwBadge();
}
function updateRwBadge(){
  const list=getRiwayat(),pending=list.filter(o=>o.status==='PENDING').length;
  const badge=document.getElementById('rwBadge');
  if(pending>0){badge.style.display='flex';badge.textContent=pending;}else{badge.style.display='none';}
}
function syncRiwayatStatus(fbOrders){
  const list=getRiwayat();let changed=false;
  list.forEach(local=>{const fb=fbOrders.find(o=>o.id===local.id);if(fb&&fb.status!==local.status){notifStatusBerubah(local.id,fb.status);local.status=fb.status;changed=true;}});
  if(changed){localStorage.setItem(RW_KEY,JSON.stringify(list));updateRwBadge();if(document.getElementById('page-riwayat').classList.contains('active'))renderRiwayat();}
}
function setRwFilter(f,el){rwFilter=f;document.querySelectorAll('.rw-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');renderRiwayat();}
function buildTimeline(o){
  const st=o.status||'PENDING';
  const hasBukti=!!o.buktiTransfer;
  const isBerhasil=st==='BERHASIL';
  const isGagal=st==='GAGAL';

  // 4 steps: ORDER MASUK → BUKTI TERKIRIM → DIPROSES ADMIN → SELESAI
  const steps=[
    {icon:'📋',label:'Order\nMasuk',   done:true, active:false, fail:false, time:o.waktu?o.waktu.split(',')[0]:'' },
    {icon:'📤',label:'Bukti\nTerkirim',done:hasBukti||isBerhasil||isGagal, active:!hasBukti&&st==='PENDING'&&false, fail:false, time:o.buktiWaktu||'' },
    {icon:'🔍',label:'Dicek\nAdmin',   done:isBerhasil||isGagal, active:hasBukti&&st==='PENDING', fail:false, time:'' },
    {icon:isBerhasil?'✅':isGagal?'❌':'⏳', label:isBerhasil?'Selesai':isGagal?'Ditolak':'Menunggu',
     done:isBerhasil, active:!isBerhasil&&!isGagal, fail:isGagal, time:'' }
  ];

  return`<div class="order-timeline">${steps.map(s=>{
    const cls=s.fail?'fail':s.done?'done':s.active?'active':'';
    return`<div class="otl-step ${cls}">
      <div class="otl-dot">${s.icon}</div>
      <div class="otl-label">${s.label.replace('\n','<br>')}</div>
      ${s.time?`<div class="otl-time">${s.time}</div>`:''}
    </div>`;
  }).join('')}</div>`;
}

function renderRiwayat(){
  const list=getRiwayat(),filtered=rwFilter==='semua'?list:list.filter(o=>o.status===rwFilter);
  document.getElementById('rwTotal').textContent=list.length;
  document.getElementById('rwBerhasil').textContent=list.filter(o=>o.status==='BERHASIL').length;
  document.getElementById('rwPending').textContent=list.filter(o=>o.status==='PENDING').length;
  const container=document.getElementById('riwayatList');
  if(!filtered.length){container.innerHTML=`<div class="riwayat-empty"><div style="font-size:48px;margin-bottom:16px;opacity:0.3">📭</div>${list.length===0?'Belum ada order.<br><span style="font-size:11px">Yuk beli sesuatu!</span>':'Tidak ada order dengan filter ini.'}</div>`;return;}
  const icons={BERHASIL:'✓',PENDING:'⏳',GAGAL:'✕'};
  container.innerHTML=filtered.map((o,i)=>{
    const sc=(o.status||'PENDING').toLowerCase();
    return`<div class="hc ${sc}" style="animation-delay:${i*0.06}s">
      <div class="hc-top"><span class="hc-id">${o.id||'—'}</span><span class="hc-time">${(o.waktu||'—').split(',')[0]}</span></div>
      <div class="hc-body">
        <div class="hc-icon" style="${o.gambar?'background-image:url('+o.gambar+')':''}"></div>
        <div class="hc-info"><div class="hc-produk">${o.produk||'—'}</div><div class="hc-detail">${o.jumlah||1}x · ${o.metode||'—'}</div></div>
        <div class="hc-right"><div class="hc-total">Rp${(o.total||0).toLocaleString('id-ID')}</div><div><span class="hc-badge ${sc}">${icons[o.status]||'?'} ${o.status||'PENDING'}</span></div></div>
      </div>
      <div class="hc-toggle" id="toggle-${i}" onclick="toggleExpand(${i})"><span style="font-size:10px;letter-spacing:1px">DETAIL</span><span class="hc-toggle-arrow">▼</span></div>
      <div class="hc-expand" id="expand-${i}">
        ${buildTimeline(o)}
        <div style="height:12px"></div>
        <div class="hc-expand-grid">
          <div><div class="hce-field-label">Username</div><div class="hce-field-val">${o.username||'—'}</div></div>
          <div><div class="hce-field-label">Status</div><div class="hce-field-val" style="color:${sc==='berhasil'?'var(--green)':sc==='gagal'?'var(--red)':'var(--orange)'}">${o.status||'PENDING'}</div></div>
          <div><div class="hce-field-label">Total</div><div class="hce-field-val" style="color:var(--neon)">Rp${(o.total||0).toLocaleString('id-ID')}</div></div>
          <div><div class="hce-field-label">Metode</div><div class="hce-field-val">${o.metode||'—'}</div></div>
        </div>
        <div class="hce-field-label" style="margin-bottom:4px">Waktu Order</div>
        <div class="hce-field-val" style="font-size:11px;margin-bottom:10px">${o.waktu||'—'}</div>
        ${o.status==='PENDING'?`<button class="btn-recheck" onclick="recheckStatus('${o.id}')">🔄 Cek Status Terbaru</button>`:''}
      </div>
    </div>`;
  }).join('');
}
function toggleExpand(i){document.getElementById('expand-'+i).classList.toggle('open');document.getElementById('toggle-'+i).classList.toggle('open');}
async function recheckStatus(id){
  showToast('🔄 Mengecek...');const found=allOrders.find(o=>o.id===id);
  if(found){const list=getRiwayat();const idx=list.findIndex(o=>o.id===id);if(idx>=0&&list[idx].status!==found.status){list[idx].status=found.status;localStorage.setItem(RW_KEY,JSON.stringify(list));renderRiwayat();showToast(`✓ Status: ${found.status}`);}else showToast(`Status: ${list[idx]?.status||'PENDING'}`);}
  else showToast('ID tidak ditemukan');
}
function clearRiwayat(){if(!confirm('Hapus semua riwayat di HP ini?'))return;localStorage.removeItem(RW_KEY);renderRiwayat();updateRwBadge();showToast('🗑 Riwayat dihapus.');}
function exportRiwayat(){const list=getRiwayat();if(!list.length){showToast('⚠ Tidak ada data!');return;}exportToExcel(list,'Riwayat_Order');}

// ════ ADMIN ════
function setFilter(f,el){currentFilter=f;document.querySelectorAll('.filter-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');renderOrders();}
function updateStats(){document.getElementById('statTotal').textContent=allOrders.length;document.getElementById('statBerhasil').textContent=allOrders.filter(o=>o.status==='BERHASIL').length;document.getElementById('statPending').textContent=allOrders.filter(o=>o.status==='PENDING').length;}
function updateOmzet(){
  const berhasil=allOrders.filter(o=>o.status==='BERHASIL');
  const total=berhasil.reduce((s,o)=>s+(o.total||0),0);
  const now=new Date();
  const bulanIni=berhasil.filter(o=>{if(!o.timestamp)return false;const d=new Date(o.timestamp);return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();});
  const totalBulan=bulanIni.reduce((s,o)=>s+(o.total||0),0);
  document.getElementById('omzetTotal').textContent='Rp'+total.toLocaleString('id-ID');
  document.getElementById('omzetSub').textContent=`dari ${berhasil.length} transaksi berhasil`;
  document.getElementById('omzetBulan').textContent='Rp'+totalBulan.toLocaleString('id-ID');
  document.getElementById('omzetBulanSub').textContent=`${bulanIni.length} transaksi`;
}
function renderChart(){
  const container=document.getElementById('chartBars');if(!container)return;
  const days=7,data=[];
  for(let i=days-1;i>=0;i--){
    const d=new Date();d.setDate(d.getDate()-i);
    const label=['Min','Sen','Sel','Rab','Kam','Jum','Sab'][d.getDay()];
    const count=allOrders.filter(o=>{if(!o.timestamp)return false;const od=new Date(o.timestamp);return od.toDateString()===d.toDateString()&&o.status==='BERHASIL';}).length;
    data.push({label,count});
  }
  const max=Math.max(...data.map(d=>d.count),1);
  container.innerHTML=data.map(d=>`<div class="chart-bar-wrap"><div class="chart-bar-val">${d.count||''}</div><div class="chart-bar" style="height:${(d.count/max)*80+2}px"></div><div class="chart-bar-lbl">${d.label}</div></div>`).join('');
}
function clearDateFilter(){document.getElementById('dateFrom').value='';document.getElementById('dateTo').value='';renderOrders();}
function renderOrders(){
  const list=document.getElementById('ordersList');
  let orders=currentFilter==='semua'?allOrders:allOrders.filter(o=>o.status===currentFilter);
  const fromVal=document.getElementById('dateFrom')?.value;
  const toVal=document.getElementById('dateTo')?.value;
  if(fromVal){const from=new Date(fromVal);orders=orders.filter(o=>{if(!o.timestamp)return true;return new Date(o.timestamp)>=from;});}
  if(toVal){const to=new Date(toVal);to.setHours(23,59,59,999);orders=orders.filter(o=>{if(!o.timestamp)return true;return new Date(o.timestamp)<=to;});}
  if(!orders.length){list.innerHTML=`<div class="empty-state">[ BELUM ADA ORDER ]</div>`;return;}
  const icons={BERHASIL:'✓',PENDING:'⏳',GAGAL:'✕'};
  list.innerHTML=orders.map((o,i)=>{
    const sc=(o.status||'PENDING').toLowerCase();
    const act=o.status==='BERHASIL'?`<div class="oc-done">selesai ✓</div>`:o.status==='GAGAL'?`<div class="oc-done">ditolak ✕</div>`:`<div class="oc-actions"><button class="oc-btn confirm" onclick="adminConfirm('${o.docId}')">✓ KONFIRMASI</button><button class="oc-btn reject" onclick="adminReject('${o.docId}')">✕ TOLAK</button></div>`;
    return`<div class="order-card ${sc}" style="animation-delay:${i*.05}s">
      <div class="oc-header">
        <span class="oc-id">${o.id||'—'}</span>
        <div style="display:flex;align-items:center;gap:8px">
          ${o.buktiTransfer?`<img src="${o.buktiTransfer}" class="bukti-thumb" onclick="openLightbox(this.src,'Bukti Transfer')">`:'<div class="no-bukti">📷</div>'}
          <span class="oc-time">${o.waktu?o.waktu.split(' ')[1]||o.waktu:'—'}</span>
        </div>
      </div>
      <div class="oc-body">
        <div class="oc-user">👤 ${o.username||'—'}</div>
        <div class="oc-grid">
          <div><div class="oc-field-label">Produk</div><div class="oc-field-value">${o.produk||'—'}</div></div>
          <div><div class="oc-field-label">Jumlah</div><div class="oc-field-value">${o.jumlah||1} pcs</div></div>
          <div><div class="oc-field-label">Metode</div><div class="oc-field-value">${o.metode||'—'}</div></div>
          <div><div class="oc-field-label">Status</div><div><span class="status-badge ${sc}">${icons[o.status]||'?'} ${o.status||'PENDING'}</span></div></div>
        </div>
        <div><div class="oc-field-label">Total</div><div class="oc-total">Rp${(o.total||0).toLocaleString('id-ID')}</div></div>
      </div>
      ${act}
      <button class="btn-balas" onclick="toggleBalas('balas-${i}','${o.username||''}','${o.id||''}')">💬 Balas ke Pembeli</button>
      <div class="balas-form" id="balas-${i}">
        <div class="balas-template-row">
          <button class="balas-tpl" onclick="setBalasTemplate('balas-input-${i}','✓ Pesanan kamu sudah dikonfirmasi!')">✓ Konfirmasi</button>
          <button class="balas-tpl" onclick="setBalasTemplate('balas-input-${i}','Mohon upload bukti pembayaran dulu ya!')">📎 Minta Bukti</button>
          <button class="balas-tpl" onclick="setBalasTemplate('balas-input-${i}','Pesanan sedang diproses, harap tunggu.')">⏳ Proses</button>
        </div>
        <textarea class="balas-input" id="balas-input-${i}" placeholder="Ketik pesan..."></textarea>
        <button class="btn-kirim-balas" onclick="kirimBalas('balas-input-${i}','${o.username||''}','${o.id||''}')">📨 Kirim via WA</button>
      </div>
    </div>`;
  }).join('');
}
function toggleBalas(id){document.getElementById(id)?.classList.toggle('open');}
function setBalasTemplate(inputId,tpl){const el=document.getElementById(inputId);if(el)el.value=tpl;}
function kirimBalas(inputId,user,orderId){
  const el=document.getElementById(inputId);if(!el||!el.value.trim()){showToast('⚠ Ketik pesan dulu!');return;}
  window.open('https://wa.me/62?text='+encodeURIComponent(`Halo ${user}!\n\nPesan dari Admin NEOSTORE:\n${el.value}\n\nID Order: ${orderId}`),'_blank');
}
async function updateStatusFB(docId,status){const{db,doc,updateDoc}=window._fb;await updateDoc(doc(db,'orders',docId),{status});}
async function deleteOrderFB(docId){const{db,doc,deleteDoc}=window._fb;await deleteDoc(doc(db,'orders',docId));}
async function adminConfirm(docId){
  const o=allOrders.find(x=>x.docId===docId);
  if(!o)return;
  const{db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'orders',docId),{status:'BERHASIL'});
  // ✅ Update sold saat dikonfirmasi
  const produkItems=o.cartItems||[{docId:allProduks.find(p=>p.nama===o.produk)?.docId,qty:o.jumlah||1,nama:o.produk}];
  for(const item of produkItems){
    const p=allProduks.find(x=>x.docId===item.docId||x.nama===item.nama);
    if(p){await updateDoc(doc(db,'produks',p.docId),{sold:(p.sold||0)+(item.qty||1)});}
  }
  showToast('✓ Order dikonfirmasi!');launchKonfeti();
}
async function adminReject(docId){
  const o=allOrders.find(x=>x.docId===docId);
  if(!o)return;
  const{db,doc,updateDoc}=window._fb;
  await updateDoc(doc(db,'orders',docId),{status:'GAGAL'});
  // ✅ Kembalikan stok saat order ditolak
  const produkItems=o.cartItems||[{docId:allProduks.find(p=>p.nama===o.produk)?.docId,qty:o.jumlah||1,nama:o.produk}];
  for(const item of produkItems){
    const p=allProduks.find(x=>x.docId===item.docId||x.nama===item.nama);
    if(p&&p.stok!==-1&&p.stok!==undefined){
      await updateDoc(doc(db,'produks',p.docId),{stok:p.stok+(item.qty||1)});
    }
  }
  showToast('✕ Order ditolak. Stok dikembalikan.');
  // Notif WA ke pembeli
  if(o.nomorHP){
    const msg=`Halo ${o.username}.\n\nMaaf, order kamu *DITOLAK* oleh Admin NEOSTORE ❌\n\n🔑 ID: ${o.id}\n📦 Produk: ${o.produk}\n\nSilakan hubungi admin untuk informasi lebih lanjut.`;
    setTimeout(()=>window.open('https://wa.me/'+o.nomorHP.replace(/\D/g,'')+'?text='+encodeURIComponent(msg),'_blank'),500);
  }
}
async function clearAllOrders(){if(!confirm('Hapus semua order?'))return;for(const o of allOrders)await deleteOrderFB(o.docId);showToast('🗑 Semua order dihapus.');}
function exportToExcel(data,filename){
  try{
    const rows=data.map(o=>({'ID':o.id||'','Username':o.username||'','Nomor HP':o.nomorHP||'','Produk':o.produk||'','Jumlah':o.jumlah||1,'Total':o.total||0,'Voucher':o.voucherKode||'','Diskon Voucher':o.voucherDiskon||0,'Metode':o.metode||'','Status':o.status||'','Waktu':o.waktu||''}));
    const ws=XLSX.utils.json_to_sheet(rows),wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,'Orders');
    // Sheet terlaris per produk
    const produkMap={};
    data.filter(o=>o.status==='BERHASIL').forEach(o=>{
      const nama=o.produk||'Unknown';
      if(!produkMap[nama])produkMap[nama]={produk:nama,totalTerjual:0,totalOmzet:0,jumlahOrder:0};
      produkMap[nama].totalTerjual+=(o.jumlah||1);
      produkMap[nama].totalOmzet+=(o.total||0);
      produkMap[nama].jumlahOrder++;
    });
    const totalOmzet=Object.values(produkMap).reduce((s,p)=>s+p.totalOmzet,0);
    const terlarisList=Object.values(produkMap).sort((a,b)=>b.totalTerjual-a.totalTerjual).map(p=>({
      'Produk':p.produk,'Total Terjual (pcs)':p.totalTerjual,'Total Omzet':p.totalOmzet,
      'Jumlah Order':p.jumlahOrder,'% dari Total Omzet':totalOmzet?Math.round(p.totalOmzet/totalOmzet*100)+'%':'0%'
    }));
    if(terlarisList.length){const wsTerlaris=XLSX.utils.json_to_sheet(terlarisList);XLSX.utils.book_append_sheet(wb,wsTerlaris,'Terlaris per Produk');}
    XLSX.writeFile(wb,`${filename}_${new Date().toLocaleDateString('id-ID').replace(/\//g,'-')}.xlsx`);
    showToast('✓ File Excel berhasil diunduh!');
  }catch(e){showToast('⚠ Gagal export: '+e.message);}
}
function exportExcel(){exportToExcel(allOrders,'NeoStore_Orders');}

// ════ PRODUK MANAGEMENT ════
function startProdukListener(){
  if(!window._fb)return;
  const{produksRef,onSnapshot}=window._fb;
  onSnapshot(produksRef,snap=>{
    allProduks=snap.docs.map(d=>({docId:d.id,...d.data()}));
    allProduks.sort((a,b)=>(a.urutan||a.createdAt||0)-(b.urutan||b.createdAt||0));
    renderProdukStore();renderProdukAdmin();updateTestitProdukOptions();
  });
}
function renderProdukStore(){filterProduk();}

// ════ FLASH SALE: Toggle diskon field ════
function toggleDiskonField(){
  const isPromo=document.getElementById('modalIsPromo').checked;
  document.getElementById('diskonRow').style.display=isPromo?'block':'none';
  if(isPromo) updateDiskonPreview();
}
function updateDiskonPreview(){
  const harga=parseInt(document.getElementById('modalHarga').value)||0;
  const diskon=parseInt(document.getElementById('modalDiskon').value)||0;
  const preview=document.getElementById('diskonPreview');
  if(harga&&diskon&&preview){
    const hargaDiskon=Math.round(harga*(1-diskon/100));
    preview.textContent=`Harga asli Rp${harga.toLocaleString('id-ID')} → Harga promo Rp${hargaDiskon.toLocaleString('id-ID')}`;
  }
}
// update preview saat harga atau diskon berubah
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('modalHarga')?.addEventListener('input',()=>{if(document.getElementById('modalIsPromo')?.checked)updateDiskonPreview();});
  document.getElementById('modalDiskon')?.addEventListener('input',updateDiskonPreview);
});

// ════ RENDER PRODUK STORE (Flash Sale terpisah) ════
function buildCardHTML(p, realIdx){
  const stok=p.stok===-1||p.stok===undefined?null:p.stok;
  const isEmpty=stok===0,isLow=stok!==null&&stok>0&&stok<=5,isOk=stok!==null&&stok>5;
  const soldTxt=p.sold?`${p.sold} terjual`:'';
  const isPromo=!!p.isPromo,diskon=p.diskon||0;
  const hargaDiskon=isPromo&&diskon>0?Math.round(p.harga*(1-diskon/100)):p.harga;
  const stokBadge=isEmpty
    ?`<span class="card-stok-badge stok-empty">HABIS</span>`
    :isLow?`<span class="card-stok-badge stok-low">SISA ${stok}</span>`
    :isOk?`<span class="card-stok-badge stok-ok">STOK ${stok}</span>`:'';
  const saleBadge=isPromo?`<span class="card-sale-badge">🔥 SALE ${diskon}%</span>`:stokBadge;
  const hargaHtml=isPromo&&diskon>0
    ?`<span class="card-price-ori">Rp${p.harga.toLocaleString('id-ID')}</span>
      <div class="card-price sale" id="cprice-${realIdx}">Rp${hargaDiskon.toLocaleString('id-ID')}</div>`
    :`<div class="card-price" id="cprice-${realIdx}">Rp${p.harga.toLocaleString('id-ID')}</div>`;
  return`<div class="card${selectedProduk&&selectedProduk.docId===p.docId?' selected':''}${isEmpty?' out-of-stock':''}" id="pcard-${realIdx}" onclick="selectProdukDynamic(${realIdx})">
    ${p.gambar?`<div class="card-img" style="background-image:url('${p.gambar}')"></div>`:`<div class="card-img" style="background:rgba(0,255,225,0.05);display:flex;align-items:center;justify-content:center;font-size:40px">📦</div>`}
    <div class="card-overlay"></div>
    <span class="card-select-badge">✓</span>
    ${saleBadge}
    ${isPromo?stokBadge:''}
    <button class="card-wish-btn${isInWishlist(p.docId)?' active':''}" onclick="event.stopPropagation();toggleWishlist(${realIdx},this)" title="Wishlist">${isInWishlist(p.docId)?'❤️':'🤍'}</button>
    <button class="card-cart-btn" onclick="event.stopPropagation();flyCartAnim(this);addToCart(${realIdx})" title="Tambah ke keranjang">🛒</button>
    <div class="card-content" onclick="event.stopPropagation();openPreview(${realIdx})" style="cursor:pointer">
      <div class="card-name">${p.nama||'—'}</div>
      ${hargaHtml}
      ${soldTxt?`<div class="card-sold">👥 ${soldTxt}</div>`:''}
    </div>
  </div>`;
}

function renderProdukStoreList(list){
  const wrap=document.getElementById('produkSectionsWrap');
  if(!list.length){
    wrap.innerHTML='<div style="text-align:center;padding:40px;color:rgba(0,255,225,0.25);font-family:Share Tech Mono,monospace;font-size:12px;letter-spacing:2px">[ TIDAK ADA PRODUK ]</div>';
    return;
  }
  const flashList=list.filter(p=>!!p.isPromo);
  const regularList=list.filter(p=>!p.isPromo);
  let html='';

  if(flashList.length){
    html+=`<div class="flash-section-wrap">
      <div class="flash-section-title">🔥 Flash Sale &nbsp;·&nbsp; ${flashList.length} produk</div>
      <div class="flash-grid">
        ${flashList.map(p=>buildCardHTML(p,allProduks.findIndex(x=>x.docId===p.docId))).join('')}
      </div>
    </div>`;
  }
  if(regularList.length){
    html+=`<div class="regular-section-wrap">
      <div class="regular-section-title">⚡ Semua Produk &nbsp;·&nbsp; ${regularList.length} item</div>
      <div class="regular-grid">
        ${regularList.map(p=>buildCardHTML(p,allProduks.findIndex(x=>x.docId===p.docId))).join('')}
      </div>
    </div>`;
  }
  wrap.innerHTML=html;
}

// ════ SELECT PRODUK — pakai harga diskon ════
function selectProdukDynamic(idx){
  const p=allProduks[idx];if(!p)return;
  const priceEl=document.getElementById('cprice-'+idx);if(priceEl){priceEl.classList.add('animating');setTimeout(()=>priceEl.classList.remove('animating'),400);}
  selectedProduk=p;cart=[];updateCartUI();
  document.querySelectorAll('.card').forEach(c=>c.classList.remove('selected'));
  document.getElementById('pcard-'+idx)?.classList.add('selected');

  // ✅ Hitung harga diskon
  const isPromo=!!p.isPromo;
  const diskon=p.diskon||0;
  const hargaPakai=isPromo&&diskon>0?Math.round(p.harga*(1-diskon/100)):p.harga;

  dataOrder={
    id:generateId(),
    produk:p.nama,
    harga:hargaPakai,
    hargaOri:p.harga,
    isPromo,diskon,
    gambar:p.gambar||'',
    isCart:false
  };
  document.getElementById('selectedBanner').classList.add('visible');
  document.getElementById('selectedName').textContent=p.nama+(isPromo?` 🔥-${diskon}%`:'');
  document.getElementById('selectedPriceTag').textContent='Rp'+hargaPakai.toLocaleString('id-ID')+(isPromo&&diskon?` (hemat Rp${(p.harga-hargaPakai).toLocaleString('id-ID')})`:'');
  const totalEl=document.getElementById('totalBox');totalEl.classList.add('pop');setTimeout(()=>totalEl.classList.remove('pop'),400);
  document.getElementById('cartSummaryBanner').classList.remove('visible');
  updateTotal();document.querySelector('.order-section').scrollIntoView({behavior:'smooth',block:'start'});
}

// ════ RENDER ADMIN PRODUK — tampilkan tag PROMO ════
function renderProdukAdmin(){
  const grid=document.getElementById('produkAdminGrid');
  if(!allProduks.length){grid.innerHTML='<div class="produk-empty-state">[ BELUM ADA PRODUK ]<br><span style="font-size:11px;opacity:0.5">Klik + Tambah Produk Baru</span></div>';return;}
  grid.innerHTML=allProduks.map((p,i)=>`
    <div class="produk-admin-card" style="animation-delay:${i*0.06}s">
      ${p.gambar?`<img class="pac-img" src="${p.gambar}" alt="${p.nama}">`:`<div class="pac-img-placeholder">📦</div>`}
      <div class="pac-body">
        ${p.isPromo?`<div class="pac-promo-tag">🔥 SALE ${p.diskon||0}%</div>`:''}
        <div class="pac-name">${p.nama||'—'}</div>
        <div class="pac-price">Rp${(p.harga||0).toLocaleString('id-ID')}${p.isPromo&&p.diskon?`<span style="font-size:11px;color:var(--red);margin-left:6px">(-${p.diskon}%) → Rp${Math.round(p.harga*(1-p.diskon/100)).toLocaleString('id-ID')}</span>`:''}
        </div>
        <div class="pac-stok">Stok: ${p.stok===-1||p.stok===undefined?'∞ Tidak terbatas':p.stok}</div>
        <div class="pac-actions">
          <button class="pac-btn edit" onclick="editProduk('${p.docId}')">✏ Edit</button>
          <button class="pac-btn del" onclick="deleteProduk('${p.docId}','${p.nama}')">🗑 Hapus</button>
        </div>
      </div>
    </div>`).join('');
}

function updateTestitProdukOptions(){
  const sel=document.getElementById('testiProduk');if(!sel)return;
  const current=sel.value;sel.innerHTML='<option value="">Pilih produk...</option>';
  allProduks.forEach(p=>{const opt=document.createElement('option');opt.value=p.nama;opt.textContent=p.nama;if(p.nama===current)opt.selected=true;sel.appendChild(opt);});
}

// ════ MODAL PRODUK — dengan Flash Sale fields ════
function openProdukModal(docId){
  editingProdukId=docId||null;modalImgBase64=null;
  document.getElementById('modalNama').value='';
  document.getElementById('modalHarga').value='';
  document.getElementById('modalDeskripsi').value='';
  document.getElementById('modalStok').value='-1';
  document.getElementById('modalImgFile').value='';
  document.getElementById('modalIsPromo').checked=false;
  document.getElementById('modalDiskon').value='10';
  document.getElementById('diskonRow').style.display='none';
  if(document.getElementById('diskonPreview'))document.getElementById('diskonPreview').textContent='';
  const zone=document.getElementById('modalImgZone');const ex=zone.querySelector('img.preview-img');if(ex)ex.remove();zone.querySelector('.upload-hint').style.display='flex';
  if(docId){
    const p=allProduks.find(x=>x.docId===docId);
    if(p){
      document.getElementById('modalTitle').textContent='✏ Edit Produk';
      document.getElementById('modalNama').value=p.nama||'';
      document.getElementById('modalHarga').value=p.harga||'';
      document.getElementById('modalDeskripsi').value=p.deskripsi||'';
      document.getElementById('modalStok').value=p.stok!==undefined?p.stok:-1;
      document.getElementById('modalIsPromo').checked=!!p.isPromo;
      document.getElementById('modalDiskon').value=p.diskon||10;
      document.getElementById('diskonRow').style.display=p.isPromo?'block':'none';
      if(p.isPromo)updateDiskonPreview();
      if(p.gambar){modalImgBase64=p.gambar;showModalImgPreview(p.gambar);}
    }
  }else{document.getElementById('modalTitle').textContent='✚ Tambah Produk';}
  document.getElementById('produkModal').style.display='flex';
}
function closeProdukModal(){document.getElementById('produkModal').style.display='none';editingProdukId=null;modalImgBase64=null;}
function handleModalImg(e){const f=e.target.files[0];if(!f)return;compressImage(f,b64=>{modalImgBase64=b64;showModalImgPreview(b64);});}
function showModalImgPreview(src){
  const zone=document.getElementById('modalImgZone'),hint=zone.querySelector('.upload-hint');if(hint)hint.style.display='none';
  let img=zone.querySelector('img.preview-img');
  if(!img){img=document.createElement('img');img.className='preview-img';zone.insertBefore(img,hint);}
  img.src=src;
}

// ════ SAVE PRODUK — simpan isPromo & diskon ════
async function saveProduk(){
  const nama=document.getElementById('modalNama').value.trim();
  const harga=parseInt(document.getElementById('modalHarga').value)||0;
  const deskripsi=document.getElementById('modalDeskripsi').value.trim();
  const stok=parseInt(document.getElementById('modalStok').value);
  const isPromo=document.getElementById('modalIsPromo').checked;
  const diskon=isPromo?parseInt(document.getElementById('modalDiskon').value)||0:0;
  if(!nama){showToast('⚠ Nama produk wajib!');return;}
  if(!harga){showToast('⚠ Harga wajib!');return;}
  if(isPromo&&(diskon<1||diskon>99)){showToast('⚠ Diskon harus 1–99%!');return;}
  const btn=document.getElementById('btnModalSave');btn.disabled=true;btn.textContent='MENYIMPAN...';
  const data={
    nama,harga,deskripsi,
    stok:isNaN(stok)?-1:stok,
    gambar:modalImgBase64||'',
    isPromo,diskon,
    urutan:editingProdukId?(allProduks.find(p=>p.docId===editingProdukId)?.urutan||Date.now()):Date.now(),
    updatedAt:Date.now()
  };
  try{
    const{db,doc,updateDoc,addDoc,produksRef}=window._fb;
    if(editingProdukId){await updateDoc(doc(db,'produks',editingProdukId),data);showToast('✓ Produk diperbarui!');}
    else{await addDoc(produksRef,{...data,createdAt:Date.now(),sold:0});showToast('✓ Produk ditambahkan!');}
    closeProdukModal();
  }catch(e){showToast('⚠ Gagal: '+e.message);}
  btn.disabled=false;btn.textContent='💾 SIMPAN';
}
function editProduk(docId){openProdukModal(docId);}
async function deleteProduk(docId,nama){
  if(!confirm('Hapus produk "'+nama+'"?'))return;
  const{db,doc,deleteDoc}=window._fb;await deleteDoc(doc(db,'produks',docId));showToast('🗑 Produk dihapus.');
}

// ════ STORE FORM ORDER ════
function updateTotal(){
  const j=parseInt(document.getElementById('jumlah').value)||1;
  if(dataOrder.isCart)return;
  const h=dataOrder.harga||0;let t=j*h;
  let voucherInfo='';
  if(activeVoucher){const disc=Math.round(t*activeVoucher.diskon/100);t=t-disc;voucherInfo=`\nVoucher : <span style="color:var(--yellow)">-${activeVoucher.diskon}% (hemat Rp${disc.toLocaleString('id-ID')})</span>`;}
  dataOrder.total=t;dataOrder.jumlah=j;
  document.getElementById('totalBox').textContent='Rp'+t.toLocaleString('id-ID');
  if(dataOrder.produk){
    const sb=document.getElementById('summaryBox');sb.classList.add('visible');
    const diskonInfo=dataOrder.isPromo&&dataOrder.diskon?`\nHarga Asli : <span style="text-decoration:line-through;opacity:0.5">Rp${(dataOrder.hargaOri||0).toLocaleString('id-ID')}</span> <span style="color:var(--red)">(-${dataOrder.diskon}%)</span>`:'';
    sb.innerHTML=`<strong style="color:var(--neon);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px">RINGKASAN</strong><br><br>Produk : <strong style="color:#fff">${dataOrder.produk}${dataOrder.isPromo?' 🔥':''}</strong><br>${diskonInfo?diskonInfo+'<br>':''}Harga &nbsp;: Rp${h.toLocaleString('id-ID')}<br>Jumlah : ${j} pcs${voucherInfo}<br>Total &nbsp;: <strong style="color:var(--neon)">Rp${t.toLocaleString('id-ID')}</strong>`;
    document.getElementById('idPembayaranBox').textContent='🔑 '+dataOrder.id;
  }
}
function generateId(){return 'NEO-'+Date.now().toString(36).toUpperCase()+'-'+Math.random().toString(36).slice(2,5).toUpperCase();}

async function submitOrder(){
  if(!dataOrder.produk&&!dataOrder.isCart){showToast('⚠ Pilih produk dulu!');return;}
  const metode=document.getElementById('metode').value;if(!metode){showToast('⚠ Pilih metode pembayaran!');return;}
  const username=document.getElementById('username').value.trim();if(!username){showToast('⚠ Masukkan username!');return;}
  if(!dataOrder.id)dataOrder.id=generateId();
  dataOrder.username=username;
  if(!dataOrder.isCart){dataOrder.jumlah=parseInt(document.getElementById('jumlah').value)||1;dataOrder.total=dataOrder.jumlah*dataOrder.harga;}
  // Terapkan voucher ke total
  if(activeVoucher){
    const disc=Math.round(dataOrder.total*activeVoucher.diskon/100);
    dataOrder.voucherKode=activeVoucher.kode;dataOrder.voucherDiskon=disc;
    dataOrder.total=dataOrder.total-disc;
  }
  dataOrder.metode=metode;dataOrder.status='PENDING';dataOrder.waktu=new Date().toLocaleString('id-ID');
  const btn=document.getElementById('btnOrder');btn.disabled=true;btn.textContent='MENYIMPAN...';
  try{
    if(fbReady&&window._fb){
      const{ordersRef,addDoc,db,doc,updateDoc}=window._fb;
      await addDoc(ordersRef,{...dataOrder,timestamp:Date.now()});
      // ✅ Kurangi stok saat order masuk (PENDING) — cegah oversell
      const produkItems=dataOrder.isCart?dataOrder.cartItems:[{docId:allProduks.find(p=>p.nama===dataOrder.produk)?.docId,qty:dataOrder.jumlah,nama:dataOrder.produk}];
      for(const item of produkItems||[]){
        const p=allProduks.find(x=>x.docId===item.docId||x.nama===item.nama);
        if(p&&p.stok!==-1&&p.stok!==undefined&&p.stok>0){
          await updateDoc(doc(db,'produks',p.docId),{stok:Math.max(0,p.stok-(item.qty||1))});
        }
      }
      saveToRiwayat({...dataOrder});showToast('✓ Order berhasil! Upload bukti bayar 📎');
    }else{saveToRiwayat({...dataOrder});showToast('✓ Order tersimpan! Upload bukti bayar.');}
  }catch(e){showToast('⚠ '+e.message);}
  btn.disabled=false;btn.textContent='ORDER SEKARANG';
  if(metode==='QRIS'){document.getElementById('qrisAmount').textContent='Rp'+dataOrder.total.toLocaleString('id-ID');document.getElementById('qrisPopup').style.display='flex';}
  else{showUploadSection(dataOrder.id);}
}
function sudahBayar(){tutupQR();showToast('✓ Silakan upload bukti pembayaran QRIS!');showUploadSection(dataOrder.id);}
function tutupQR(){document.getElementById('qrisPopup').style.display='none';}
function kirimWA(m){
  const tpl=waTemplate||`Halo Admin, saya mau beli:\n\n🔑 ID: {ID}\n👤 Username: {USER}\n📦 Produk: {PRODUK}\n🔢 Jumlah: {JML}\n💰 Total: {TOTAL}\n💳 Metode: {METODE}\n\nTerimakasih sudah order di NEOSTORE ⚡`;
  const msg=tpl.replace('{ID}',dataOrder.id||'').replace('{USER}',dataOrder.username||'').replace('{PRODUK}',dataOrder.produk||'').replace('{JML}',dataOrder.jumlah||1).replace('{TOTAL}','Rp'+(dataOrder.total||0).toLocaleString('id-ID')).replace('{METODE}',m);
  window.open('https://wa.me/6281328941033?text='+encodeURIComponent(msg),'_blank');
}
function cekStatus(){
  const id=document.getElementById('cekId').value.trim(),hasil=document.getElementById('hasilCek');
  if(!id){hasil.innerHTML='<span style="color:rgba(255,255,255,0.3)">Masukkan ID.</span>';return;}
  const local=getRiwayat().find(o=>o.id===id);
  if(local){
    const colors={BERHASIL:'var(--green)',PENDING:'var(--orange)',GAGAL:'var(--red)'};
    const icons={BERHASIL:'✓',PENDING:'⏳',GAGAL:'✕'};
    hasil.innerHTML=`<span style="color:${colors[local.status]}">${icons[local.status]} ${id} — <strong>${local.status}</strong></span><br><span style="font-size:11px;color:rgba(255,255,255,0.4)">${local.produk} x${local.jumlah} · Rp${local.total.toLocaleString('id-ID')}</span>`;
  }else{hasil.innerHTML=`<span style="color:var(--red)">✕ ID tidak ditemukan</span>`;}
}

// ════ UPLOAD BUKTI ════
let buktiBase64=null;
function showUploadSection(orderId){
  const sec=document.getElementById('uploadSection');sec.style.display='block';
  document.getElementById('uploadOrderId').value=orderId||'';sec.scrollIntoView({behavior:'smooth',block:'start'});
}
function autofillOrderId(){if(dataOrder.id){document.getElementById('uploadOrderId').value=dataOrder.id;showToast('✓ ID terisi!');}else showToast('⚠ Belum ada order aktif');}
function handleFileSelect(e){
  const f=e.target.files[0];if(!f)return;
  if(f.size>5*1024*1024){showToast('⚠ Foto terlalu besar! Maks 5MB');return;}
  compressImage(f,compressed=>{buktiBase64=compressed;document.getElementById('buktiPreview').classList.add('visible');document.getElementById('buktiPreviewImg').src=compressed;document.getElementById('dropZone').style.display='none';});
}
function removeBukti(){buktiBase64=null;document.getElementById('buktiPreview').classList.remove('visible');document.getElementById('buktiPreviewImg').src='';document.getElementById('dropZone').style.display='block';document.getElementById('buktiFile').value='';}
function compressImage(file,callback){
  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      const canvas=document.createElement('canvas');const MAX=600;let w=img.width,h=img.height;
      if(w>MAX){h=Math.round(h*MAX/w);w=MAX;}
      canvas.width=w;canvas.height=h;canvas.getContext('2d').drawImage(img,0,0,w,h);
      callback(canvas.toDataURL('image/jpeg',0.65));
    };img.src=e.target.result;
  };reader.readAsDataURL(file);
}
async function submitBukti(){
  const orderId=document.getElementById('uploadOrderId').value.trim();
  if(!orderId){showToast('⚠ Masukkan ID Order!');return;}
  if(!buktiBase64){showToast('⚠ Pilih foto bukti dulu!');return;}
  if(!window._fb){showToast('⚠ Tidak ada koneksi!');return;}
  const btn=document.getElementById('btnUpload');btn.disabled=true;btn.textContent='MENGIRIM...';
  const prog=document.getElementById('uploadProgress'),fill=document.getElementById('progressFill'),label=document.getElementById('progressLabel');
  prog.classList.add('visible');fill.style.width='30%';label.textContent='Mengkompres foto...';
  await new Promise(r=>setTimeout(r,400));fill.style.width='60%';label.textContent='Mengunggah ke server...';
  try{
    const order=allOrders.find(o=>o.id===orderId);
    if(!order){showToast('⚠ ID tidak ditemukan!');prog.classList.remove('visible');btn.disabled=false;btn.textContent='📤 KIRIM BUKTI → LANJUT KE WHATSAPP';return;}
    const{db,doc,updateDoc}=window._fb;
    await updateDoc(doc(db,'orders',order.docId),{buktiTransfer:buktiBase64,buktiWaktu:new Date().toLocaleString('id-ID')});
    fill.style.width='100%';label.textContent='Berhasil dikirim! ✓';
    await new Promise(r=>setTimeout(r,800));
    const rwList=getRiwayat();const rwIdx=rwList.findIndex(o=>o.id===orderId);
    if(rwIdx>=0){rwList[rwIdx].buktiTransfer=buktiBase64;localStorage.setItem(RW_KEY,JSON.stringify(rwList));}
    prog.classList.remove('visible');fill.style.width='0%';removeBukti();
    document.getElementById('uploadSection').style.display='none';
    showToast('✓ Bukti terkirim! Membuka WhatsApp...');
    setTimeout(()=>kirimWA(dataOrder.metode),800);
  }catch(e){showToast('⚠ Gagal: '+e.message);prog.classList.remove('visible');}
  btn.disabled=false;btn.textContent='📤 KIRIM BUKTI → LANJUT KE WHATSAPP';
}

// ════ PIN & LOGO ════
let tapCount=0,tapTimer=null;
function handleLogoTap(){
  tapCount++;for(let i=0;i<5;i++)document.getElementById('td'+i).classList.toggle('active',i<tapCount);
  clearTimeout(tapTimer);tapTimer=setTimeout(()=>{tapCount=0;for(let i=0;i<5;i++)document.getElementById('td'+i).classList.remove('active');},2000);
  if(tapCount>=5){tapCount=0;clearTimeout(tapTimer);for(let i=0;i<5;i++)document.getElementById('td'+i).classList.remove('active');openPwPopup();}
}
let pinValue='';
function openPwPopup(){pinValue='';updatePinDots();document.getElementById('pwPopup').style.display='flex';}
function closePwPopup(){pinValue='';updatePinDots();document.getElementById('pwPopup').style.display='none';}
function pinInput(n){if(pinValue.length>=4)return;pinValue+=n;updatePinDots();if(pinValue.length===4)setTimeout(checkPin,200);}
function pinDelete(){pinValue=pinValue.slice(0,-1);updatePinDots();}
function updatePinDots(){for(let i=0;i<4;i++){const d=document.getElementById('pd'+i);d.classList.remove('filled','error');if(i<pinValue.length)d.classList.add('filled');}}
function checkPin(){
  if(pinValue===ADMIN_PIN){closePwPopup();isAdminLoggedIn=true;showPage('admin');showToast('✓ Selamat datang, Admin!');updateStats();renderOrders();renderProdukAdmin();renderChart();updateOmzet();document.getElementById('liveBadge').style.display='inline-flex';}
  else{for(let i=0;i<4;i++){const d=document.getElementById('pd'+i);d.classList.remove('filled');d.classList.add('error');}setTimeout(()=>{pinValue='';updatePinDots();},800);}
}
function logout(){isAdminLoggedIn=false;showPage('store');showToast('⏏ Logout berhasil');}

// ════ PAGES ════
function showPage(page){
  if(page==='admin'&&!isAdminLoggedIn){openPwPopup();return;}
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  document.getElementById('tabStore').classList.toggle('active',page==='store');
  document.getElementById('tabWishlist').classList.toggle('active',page==='wishlist');
  document.getElementById('tabTesti').classList.toggle('active',page==='testi');
  document.getElementById('tabRiwayat').classList.toggle('active',page==='riwayat');
  if(page==='riwayat')renderRiwayat();
  if(page==='wishlist')renderWishlist();
}
function switchAdminTab(tab){
  document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.admin-tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('as-'+tab).classList.add('active');
  const map={orders:'atOrders',produk:'atProduk',settings:'atSettings'};
  document.getElementById(map[tab]).classList.add('active');
}

// ════ MISC ════
function openLightbox(src,label){document.getElementById('lightboxImg').src=src;document.getElementById('lightboxLabel').textContent=label||'';document.getElementById('lightbox').style.display='flex';document.body.style.overflow='hidden';}
function closeLightbox(){document.getElementById('lightbox').style.display='none';document.body.style.overflow='';}
document.getElementById('metode').addEventListener('change',function(){
  document.querySelectorAll('.payment-card').forEach(c=>c.classList.remove('visible'));
  if(this.value){const card=document.getElementById('pm-'+this.value);if(card)card.classList.add('visible');}
});
function copyNomor(nomor,btn){
  const clean=nomor.replace(/-/g,'');
  navigator.clipboard.writeText(clean).then(()=>{const orig=btn.textContent;btn.textContent='✓ Tersalin!';setTimeout(()=>btn.textContent=orig,2000);}).catch(()=>{
    const el=document.createElement('textarea');el.value=clean;document.body.appendChild(el);el.select();document.execCommand('copy');document.body.removeChild(el);
    btn.textContent='✓ Tersalin!';setTimeout(()=>btn.textContent='📋 Salin Nomor',2000);
  });
}
const dz=document.getElementById('dropZone');
if(dz){
  dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('dragover');});
  dz.addEventListener('dragleave',()=>dz.classList.remove('dragover'));
  dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('dragover');const f=e.dataTransfer.files[0];if(f&&f.type.startsWith('image/'))handleFileSelect({target:{files:[f]}});});
}
function showToast(msg){document.querySelectorAll('.toast').forEach(t=>t.remove());const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>{t.style.transition='opacity 0.4s';t.style.opacity='0';setTimeout(()=>t.remove(),400);},3500);}

// ════════════════════════════════════════════════
// ✅ FITUR BARU
// ════════════════════════════════════════════════

// ── 1. FLYING CART ANIMATION ──
function flyCartAnim(btn){
  const btnRect=btn.getBoundingClientRect();
  const cartBtn=document.querySelector('.nav-cart-btn');
  if(!cartBtn)return;
  const cartRect=cartBtn.getBoundingClientRect();
  const dot=document.createElement('div');dot.className='cart-fly-dot';
  dot.style.cssText=`left:${btnRect.left+btnRect.width/2}px;top:${btnRect.top+btnRect.height/2}px;`;
  document.body.appendChild(dot);
  const startX=btnRect.left+btnRect.width/2,startY=btnRect.top+btnRect.height/2;
  const endX=cartRect.left+cartRect.width/2,endY=cartRect.top+cartRect.height/2;
  const duration=600;const start=performance.now();
  function step(now){
    const t=Math.min((now-start)/duration,1);
    const ease=1-Math.pow(1-t,3);
    const x=startX+(endX-startX)*ease;
    const y=startY+(endY-startY)*ease-Math.sin(t*Math.PI)*80;
    const scale=1-t*0.5;
    dot.style.left=x+'px';dot.style.top=y+'px';
    dot.style.transform=`translate(-50%,-50%) scale(${scale})`;
    dot.style.opacity=t>0.8?(1-(t-0.8)*5):1;
    if(t<1)requestAnimationFrame(step);
    else{dot.remove();cartBtn.style.transform='scale(1.4)';setTimeout(()=>cartBtn.style.transform='',200);}
  }
  requestAnimationFrame(step);
}

// ── 2. WISHLIST ──
const WL_KEY='neo_wishlist';
function getWishlist(){try{return JSON.parse(localStorage.getItem(WL_KEY)||'[]');}catch{return[];}}
function saveWishlist(list){localStorage.setItem(WL_KEY,JSON.stringify(list));updateWlBadge();}
function isInWishlist(docId){return getWishlist().includes(docId);}
function toggleWishlist(idx,btn){
  const p=allProduks[idx];if(!p)return;
  let list=getWishlist();
  if(list.includes(p.docId)){list=list.filter(id=>id!==p.docId);showToast('💔 Dihapus dari wishlist');btn.textContent='🤍';btn.classList.remove('active');}
  else{list.push(p.docId);showToast('❤️ Ditambah ke wishlist!');btn.textContent='❤️';btn.classList.add('active');}
  saveWishlist(list);
}
function updateWlBadge(){
  const count=getWishlist().length;const badge=document.getElementById('wlBadge');
  badge.style.display=count>0?'flex':'none';badge.textContent=count;
}
function renderWishlist(){
  const list=getWishlist();const grid=document.getElementById('wishlistGrid');
  const items=allProduks.filter(p=>list.includes(p.docId));
  if(!items.length){grid.innerHTML='<div style="grid-column:1/-1" class="wishlist-empty">❤️<br>Belum ada produk favorit.<br><span style="font-size:11px">Tap 🤍 di kartu produk untuk menyimpan.</span></div>';return;}
  grid.innerHTML=items.map(p=>{
    const realIdx=allProduks.findIndex(x=>x.docId===p.docId);
    const isPromo=!!p.isPromo,diskon=p.diskon||0;
    const harga=isPromo&&diskon>0?Math.round(p.harga*(1-diskon/100)):p.harga;
    return`<div class="card" onclick="showPage('store');setTimeout(()=>selectProdukDynamic(${realIdx}),200);" style="cursor:pointer">
      ${p.gambar?`<div class="card-img" style="background-image:url('${p.gambar}')"></div>`:'<div class="card-img" style="background:rgba(255,77,109,0.05);display:flex;align-items:center;justify-content:center;font-size:40px">📦</div>'}
      <div class="card-overlay"></div>
      <button class="card-wish-btn active" onclick="event.stopPropagation();toggleWishlistByDocId('${p.docId}',this)">❤️</button>
      <div class="card-content">
        <div class="card-name">${p.nama}</div>
        <div class="card-price">${isPromo?`<span class="card-price-ori">Rp${p.harga.toLocaleString('id-ID')}</span><div class="card-price sale">Rp${harga.toLocaleString('id-ID')}</div>`:`Rp${harga.toLocaleString('id-ID')}`}</div>
      </div>
    </div>`;
  }).join('');
}
function toggleWishlistByDocId(docId,btn){
  let list=getWishlist();list=list.filter(id=>id!==docId);saveWishlist(list);
  showToast('💔 Dihapus dari wishlist');renderWishlist();
}

// ── 3. PREVIEW PRODUK ──
let previewIdx=null;
function openPreview(idx){
  const p=allProduks[idx];if(!p)return;previewIdx=idx;
  const wrap=document.getElementById('previewImgWrap');
  // Hapus img/placeholder lama
  wrap.querySelectorAll('img,div.preview-img-placeholder').forEach(el=>el.remove());
  if(p.gambar){const img=document.createElement('img');img.src=p.gambar;img.alt=p.nama;wrap.insertBefore(img,wrap.firstChild);}
  else{const ph=document.createElement('div');ph.className='preview-img-placeholder';ph.textContent='📦';wrap.insertBefore(ph,wrap.firstChild);}
  document.getElementById('previewName').textContent=p.nama||'—';
  const isPromo=!!p.isPromo,diskon=p.diskon||0;
  const hargaDiskon=isPromo&&diskon>0?Math.round(p.harga*(1-diskon/100)):p.harga;
  document.getElementById('previewPrice').textContent='Rp'+hargaDiskon.toLocaleString('id-ID');
  const oriEl=document.getElementById('previewPriceOri'),badgeEl=document.getElementById('previewBadge');
  if(isPromo&&diskon>0){oriEl.textContent='Rp'+p.harga.toLocaleString('id-ID');oriEl.style.display='';badgeEl.textContent=`-${diskon}%`;badgeEl.style.display='';}
  else{oriEl.style.display='none';badgeEl.style.display='none';}
  const stok=p.stok===-1||p.stok===undefined?'∞ Tidak terbatas':p.stok===0?'Habis':p.stok+' tersisa';
  document.getElementById('previewStok').textContent='📦 Stok: '+stok;
  const soldEl=document.getElementById('previewSold');
  if(p.sold){soldEl.textContent='👥 '+p.sold+' terjual';soldEl.style.display='';}else soldEl.style.display='none';
  document.getElementById('previewDesc').textContent=p.deskripsi||'Tidak ada deskripsi.';
  document.getElementById('produkPreviewPopup').style.display='flex';
}
function closePreview(){document.getElementById('produkPreviewPopup').style.display='none';previewIdx=null;}
function previewBeli(){if(previewIdx===null)return;closePreview();selectProdukDynamic(previewIdx);}
function previewAddCart(){if(previewIdx===null)return;addToCart(previewIdx);closePreview();}

// ── 4. VOUCHER ──
const VOUCHER_KEY='neo_vouchers';
let activeVoucher=null;
function getVouchers(){try{return JSON.parse(localStorage.getItem(VOUCHER_KEY)||'[]');}catch{return[];}}
function saveVouchers(list){localStorage.setItem(VOUCHER_KEY,JSON.stringify(list));renderVoucherAdmin();}
function applyVoucher(){
  const kode=document.getElementById('voucherInput').value.trim().toUpperCase();
  if(!kode){showToast('⚠ Masukkan kode voucher!');return;}
  const vouchers=getVouchers();const v=vouchers.find(x=>x.kode===kode);
  if(!v){showToast('✕ Kode voucher tidak valid!');return;}
  const total=dataOrder.total||0;
  if(v.minBelanja&&total<v.minBelanja){showToast(`⚠ Min. belanja Rp${v.minBelanja.toLocaleString('id-ID')} untuk voucher ini!`);return;}
  activeVoucher=v;
  const disc=Math.round(total*(v.diskon/100));
  document.getElementById('voucherBadge').classList.add('visible');
  document.getElementById('voucherBadgeText').textContent=`${v.kode} — diskon ${v.diskon}% (hemat Rp${disc.toLocaleString('id-ID')})`;
  updateTotal();showToast(`✓ Voucher ${v.kode} aktif! Diskon ${v.diskon}%`);
}
function removeVoucher(){activeVoucher=null;document.getElementById('voucherBadge').classList.remove('visible');document.getElementById('voucherInput').value='';updateTotal();showToast('Voucher dihapus.');}
function addVoucher(){
  const kode=document.getElementById('vcCode').value.trim().toUpperCase();
  const diskon=parseInt(document.getElementById('vcDiskon').value)||0;
  const minBelanja=parseInt(document.getElementById('vcMin').value)||0;
  if(!kode){showToast('⚠ Masukkan kode voucher!');return;}
  if(!diskon||diskon<1||diskon>99){showToast('⚠ Diskon harus 1–99%!');return;}
  const list=getVouchers();if(list.find(v=>v.kode===kode)){showToast('⚠ Kode sudah ada!');return;}
  list.push({kode,diskon,minBelanja});saveVouchers(list);
  document.getElementById('vcCode').value='';document.getElementById('vcDiskon').value='';document.getElementById('vcMin').value='';
  showToast(`✓ Voucher ${kode} ditambahkan!`);
}
function deleteVoucher(kode){let list=getVouchers();list=list.filter(v=>v.kode!==kode);saveVouchers(list);showToast(`🗑 Voucher ${kode} dihapus.`);}
function renderVoucherAdmin(){
  const el=document.getElementById('voucherAdminList');if(!el)return;
  const list=getVouchers();
  if(!list.length){el.innerHTML='<div style="font-family:Share Tech Mono,monospace;font-size:11px;color:rgba(255,255,255,0.2);padding:10px 0;letter-spacing:1px">Belum ada voucher. Tambah di atas.</div>';return;}
  el.innerHTML=list.map(v=>`<div class="voucher-item">
    <div><div class="voucher-item-code">${v.kode}</div><div class="voucher-item-info">Diskon ${v.diskon}%${v.minBelanja?' · Min Rp'+v.minBelanja.toLocaleString('id-ID'):''}</div></div>
    <button class="btn-del-voucher" onclick="deleteVoucher('${v.kode}')">🗑</button>
  </div>`).join('');
}

// ── 5. VOUCHER HINT UNTUK PEMBELI ──
const VOUCHER_VISIBLE_KEY='neo_voucher_visible';
function saveVoucherVisibility(){
  const show=document.getElementById('voucherVisibleToggle')?.checked;
  localStorage.setItem(VOUCHER_VISIBLE_KEY, show?'1':'0');
  updateVoucherHintWrap();
}
function updateVoucherHintWrap(){
  const show=localStorage.getItem(VOUCHER_VISIBLE_KEY)!=='0';
  const wrap=document.getElementById('voucherHintWrap');
  if(wrap)wrap.style.display=show?'':'none';
  const toggle=document.getElementById('voucherVisibleToggle');
  if(toggle)toggle.checked=show;
}
function toggleVoucherHint(){
  const box=document.getElementById('voucherHintBox');
  const arrow=document.getElementById('voucherHintArrow');
  const visible=box.classList.toggle('visible');
  arrow.style.transform=visible?'rotate(180deg)':'';
  if(visible)renderVoucherHint();
}
function renderVoucherHint(){
  const list=document.getElementById('voucherHintList');if(!list)return;
  const vouchers=getVouchers();
  if(!vouchers.length){list.innerHTML='<div class="voucher-hint-empty">Belum ada voucher tersedia.</div>';return;}
  list.innerHTML=vouchers.map(v=>`
    <div class="voucher-hint-item" onclick="pasteVoucher('${v.kode}')">
      <div>
        <div class="voucher-hint-code">${v.kode}</div>
        <div class="voucher-hint-info">Diskon ${v.diskon}%${v.minBelanja?' · Min Rp'+v.minBelanja.toLocaleString('id-ID'):''}</div>
      </div>
      <div class="voucher-hint-tap">⬆ Pakai</div>
    </div>`).join('');
}
function pasteVoucher(kode){
  const input=document.getElementById('voucherInput');
  if(input){input.value=kode;input.focus();}
  // tutup hint box
  document.getElementById('voucherHintBox').classList.remove('visible');
  document.getElementById('voucherHintArrow').style.transform='';
  applyVoucher();
}

// Init
updateWlBadge();
renderVoucherAdmin();
updateVoucherHintWrap();
document.getElementById('jumlah').addEventListener('input',updateTotal);
updateRwBadge();checkNotifPermission();
</script>
</body>
</html>
