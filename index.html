<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>NeoStore Premium</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ╔══════════════════════════════════════╗
    // ║   GANTI DENGAN CONFIG FIREBASE LO   ║
    // ╚══════════════════════════════════════╝
    const firebaseConfig = {
      apiKey: "AIzaSyACbPIgufXB1kUR2gSnHLqkhHggc_UVHb8",
      authDomain: "neostore-770c6.firebaseapp.com",
      projectId: "neostore-770c6",
      storageBucket: "neostore-770c6.firebasestorage.app",
      messagingSenderId: "1025091375713",
      appId: "1:1025091375713:web:a010e86c6f8c0527159020"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window._fb = {
      db,
      ordersRef: collection(db, "orders"),
      testiRef: collection(db, "testimoni"),
      produksRef: collection(db, "produks"),
      addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy
    };
    window.dispatchEvent(new Event('firebase-ready'));
  </script>

  <style>
    :root {
      --neon: #00ffe1;
      --neon-glow: 0 0 20px rgba(0,255,225,0.6), 0 0 60px rgba(0,255,225,0.2);
      --bg1: #040c12;
      --border: rgba(0,255,225,0.16);
      --text: #cde8f0;
      --red: #ff4d6d;
      --orange: #ffa94d;
      --green: #69db7c;
      --card-bg: rgba(7,21,32,0.85);
      --nav-h: 60px;
      --bottom-h: 70px;
    }

    * { box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent; }
    html { scroll-behavior:smooth; }
    body { font-family:'Rajdhani',sans-serif;background:var(--bg1);color:var(--text);overflow-x:hidden;min-height:100vh;padding-bottom:var(--bottom-h); }

    #matrixCanvas { position:fixed;inset:0;z-index:0;pointer-events:none;opacity:0.1; }
    #particleCanvas { position:fixed;inset:0;z-index:1;pointer-events:none; }
    .bg-overlay { position:fixed;inset:0;background:radial-gradient(ellipse at 20% 50%,rgba(0,255,225,0.06) 0%,transparent 60%),radial-gradient(ellipse at 80% 30%,rgba(0,150,255,0.04) 0%,transparent 60%);z-index:1;pointer-events:none; }

    /* ── TOP NAV ── */
    .top-nav { position:fixed;top:0;left:0;right:0;height:var(--nav-h);background:rgba(4,12,18,0.95);backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,255,225,0.1);display:flex;align-items:center;justify-content:space-between;padding:0 18px;z-index:100; }
    .nav-logo { font-family:'Orbitron',sans-serif;font-size:16px;font-weight:900;color:var(--neon);letter-spacing:3px;text-shadow:var(--neon-glow);cursor:pointer;user-select:none;position:relative;padding:10px 4px;z-index:102; }
    .tap-dots { display:flex;gap:4px;position:absolute;bottom:-2px;left:50%;transform:translateX(-50%); }
    .tap-dot { width:4px;height:4px;border-radius:50%;background:rgba(0,255,225,0.25);transition:all 0.2s; }
    .tap-dot.active { background:var(--neon);transform:scale(1.3);box-shadow:0 0 6px var(--neon); }
    .fb-status { display:flex;align-items:center;gap:6px;font-family:'Share Tech Mono',monospace;font-size:10px;letter-spacing:1px; }
    .fb-dot { width:8px;height:8px;border-radius:50%;background:var(--orange);box-shadow:0 0 8px var(--orange);animation:blink 1.2s ease infinite; }
    .fb-dot.connected { background:var(--green);box-shadow:0 0 8px var(--green);animation:none; }
    .fb-dot.error { background:var(--red);box-shadow:0 0 8px var(--red);animation:none; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

    /* ── BOTTOM NAV ── */
    .bottom-nav { position:fixed;bottom:0;left:0;right:0;height:var(--bottom-h);background:rgba(4,12,18,0.97);backdrop-filter:blur(20px);border-top:1px solid rgba(0,255,225,0.1);display:flex;z-index:100; }
    .bottom-tab { flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;transition:all 0.2s;border:none;background:transparent;color:rgba(255,255,255,0.3);padding-bottom:env(safe-area-inset-bottom);position:relative; }
    .bottom-tab.active { color:var(--neon); }
    .tab-icon { font-size:20px;line-height:1; }
    .tab-label { font-family:'Orbitron',sans-serif;font-size:7px;letter-spacing:2px;text-transform:uppercase; }
    .tab-badge { position:absolute;top:8px;right:calc(50% - 18px);background:var(--red);color:#fff;font-family:'Orbitron',sans-serif;font-size:8px;font-weight:700;min-width:16px;height:16px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0 4px; }

    /* ── PAGES ── */
    .page { position:relative;z-index:5;padding-top:var(--nav-h);display:none; }
    .page.active { display:block; }

    /* ── STORE ── */
    header { padding:36px 20px 16px;text-align:center;animation:slideDown 0.8s cubic-bezier(0.22,1,0.36,1) forwards; }
    .logo-wrap { display:inline-block;position:relative; }
    .logo-wrap::before { content:'NEOSTORE⚡';position:absolute;inset:0;color:var(--neon);filter:blur(20px);opacity:0.5;pointer-events:none; }
    header h1 { font-family:'Orbitron',sans-serif;font-size:clamp(26px,7vw,52px);font-weight:900;color:var(--neon);letter-spacing:5px;text-shadow:var(--neon-glow); }
    .tagline { font-size:11px;letter-spacing:4px;color:rgba(0,255,225,0.4);margin-top:6px;font-family:'Share Tech Mono',monospace; }
    .header-line { width:100px;height:2px;background:linear-gradient(90deg,transparent,var(--neon),transparent);margin:14px auto 0; }
    .section-title { font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:4px;color:rgba(0,255,225,0.4);text-align:center;margin:28px 0 14px;text-transform:uppercase; }

    .card-container { display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:0 14px;max-width:700px;margin:0 auto; }
    @media(max-width:500px){ .card-container{grid-template-columns:1fr 1fr;} }
    .card { position:relative;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:14px;overflow:hidden;aspect-ratio:1/1.15;cursor:pointer;transition:transform 0.3s,box-shadow 0.3s,border-color 0.3s;animation:fadeUp 0.5s ease both; }
    .card:nth-child(1){animation-delay:.1s}.card:nth-child(2){animation-delay:.18s}.card:nth-child(3){animation-delay:.26s}.card:nth-child(4){animation-delay:.34s}.card:nth-child(5){animation-delay:.42s}
    .card:active{transform:scale(0.96);}
    .card.selected{border-color:var(--neon);box-shadow:0 0 0 2px var(--neon),0 10px 40px rgba(0,255,225,0.25);}
    .card-img{position:absolute;inset:0;background-size:cover;background-position:center;transition:transform 0.4s;}
    .card.selected .card-img{transform:scale(1.05);}
    .card-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(4,12,18,0.95) 0%,rgba(4,12,18,0.15) 55%,transparent 100%);}
    .card-content{position:absolute;bottom:0;left:0;right:0;padding:10px 12px;}
    .card-name{font-family:'Orbitron',sans-serif;font-size:12px;font-weight:700;letter-spacing:1px;color:rgba(255,255,255,0.55);text-transform:uppercase;margin-bottom:3px;}
    .card-price{font-family:'Rajdhani',sans-serif;font-size:17px;font-weight:700;color:var(--neon);text-shadow:0 0 10px rgba(0,255,225,0.5);}
    .card-select-badge{position:absolute;top:8px;right:8px;background:var(--neon);color:#040c12;font-family:'Orbitron',sans-serif;font-size:7px;font-weight:700;padding:3px 7px;border-radius:5px;opacity:0;transform:scale(0.7);transition:all 0.2s;}
    .card.selected .card-select-badge{opacity:1;transform:scale(1);}

    .order-section{max-width:480px;margin:20px auto;padding:0 14px 20px;}
    .form-card{background:var(--card-bg);border:1px solid var(--border);border-radius:18px;padding:22px 18px;backdrop-filter:blur(20px);box-shadow:0 30px 60px rgba(0,0,0,0.4),inset 0 1px 0 rgba(0,255,225,0.06);}
    .form-title{font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:3px;color:var(--neon);margin-bottom:18px;padding-bottom:12px;border-bottom:1px solid var(--border);text-transform:uppercase;}
    .selected-product-banner{display:none;background:rgba(0,255,225,0.06);border:1px solid rgba(0,255,225,0.18);border-radius:10px;padding:11px 14px;margin-bottom:16px;font-size:14px;color:var(--neon);font-weight:600;justify-content:space-between;align-items:center;}
    .selected-product-banner.visible{display:flex;}
    .input-row{margin-bottom:12px;}
    .input-label{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:rgba(0,255,225,0.38);margin-bottom:5px;display:block;font-family:'Orbitron',sans-serif;}
    .input-field{width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,225,0.16);border-radius:10px;padding:13px 14px;font-size:16px;font-family:'Rajdhani',sans-serif;font-weight:500;color:#fff;outline:none;transition:border-color 0.3s;-webkit-appearance:none;}
    .input-field:focus{border-color:rgba(0,255,225,0.5);}
    .input-field option{background:#071520;}
    .total-display{background:rgba(0,255,225,0.04);border:1px solid rgba(0,255,225,0.13);border-radius:12px;padding:14px 16px;margin:14px 0 12px;display:flex;justify-content:space-between;align-items:center;}
    .total-label{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:rgba(0,255,225,0.42);text-transform:uppercase;}
    .total-amount{font-family:'Orbitron',sans-serif;font-size:22px;font-weight:700;color:var(--neon);text-shadow:var(--neon-glow);}
    .summary-box{display:none;background:rgba(0,0,0,0.25);border-left:3px solid var(--neon);border-radius:0 10px 10px 0;padding:11px 13px;margin-bottom:12px;font-size:13px;line-height:1.85;color:rgba(255,255,255,0.68);}
    .summary-box.visible{display:block;}
    .id-box{display:flex;align-items:center;gap:8px;background:rgba(0,0,0,0.2);border:1px dashed rgba(0,255,225,0.2);border-radius:10px;padding:9px 13px;margin-bottom:16px;font-size:11px;color:rgba(0,255,225,0.6);font-family:'Share Tech Mono',monospace;}
    .btn-order{width:100%;padding:17px;background:linear-gradient(135deg,#00ffe1,#00b0a2);border:none;border-radius:12px;font-family:'Orbitron',sans-serif;font-weight:700;font-size:13px;letter-spacing:2px;color:#040c12;cursor:pointer;transition:all 0.25s;text-transform:uppercase;}
    .btn-order:active{transform:scale(0.97);}
    .btn-order:disabled{opacity:0.5;}
    .divider{display:flex;align-items:center;gap:12px;margin:22px 0 18px;color:rgba(0,255,225,0.2);font-size:9px;font-family:'Orbitron',sans-serif;letter-spacing:3px;}
    .divider::before,.divider::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent,rgba(0,255,225,0.15),transparent);}
    .btn-cek{width:100%;padding:13px;background:transparent;border:1px solid rgba(0,255,225,0.28);border-radius:12px;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;color:var(--neon);cursor:pointer;margin-top:10px;transition:all 0.2s;text-transform:uppercase;}
    .btn-cek:active{background:rgba(0,255,225,0.06);}
    .hasil-cek{margin-top:10px;padding:12px 13px;border-radius:10px;font-size:13px;background:rgba(0,0,0,0.25);border:1px solid rgba(0,255,225,0.07);min-height:42px;font-family:'Share Tech Mono',monospace;}

    /* ══════════════════════════════
       RIWAYAT ORDER PAGE
    ══════════════════════════════ */
    .riwayat-header {
      padding: 28px 14px 0;
      max-width: 600px; margin: 0 auto;
    }

    .riwayat-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 18px; font-weight: 900;
      color: var(--neon); letter-spacing: 3px;
      text-shadow: var(--neon-glow);
      margin-bottom: 4px;
    }

    .riwayat-sub {
      font-family: 'Share Tech Mono', monospace;
      font-size: 11px; color: rgba(255,255,255,0.28);
      letter-spacing: 1px; margin-bottom: 20px;
    }

    /* Stat bar */
    .riwayat-stats {
      display: grid; grid-template-columns: repeat(3,1fr);
      gap: 8px; margin-bottom: 20px;
    }

    .rw-stat {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px; padding: 14px 10px;
      text-align: center; backdrop-filter: blur(10px);
      position: relative; overflow: hidden;
    }

    .rw-stat::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    }
    .rw-stat.s-total::before { background: linear-gradient(90deg,transparent,var(--neon),transparent); }
    .rw-stat.s-berhasil::before { background: linear-gradient(90deg,transparent,var(--green),transparent); }
    .rw-stat.s-pending::before { background: linear-gradient(90deg,transparent,var(--orange),transparent); }

    .rw-stat-label {
      font-family: 'Orbitron', sans-serif;
      font-size: 7px; letter-spacing: 2px;
      color: rgba(0,255,225,0.35); text-transform: uppercase; margin-bottom: 5px;
    }

    .rw-stat-val {
      font-family: 'Orbitron', sans-serif;
      font-size: 22px; font-weight: 700;
    }
    .s-total .rw-stat-val { color:var(--neon);text-shadow:var(--neon-glow); }
    .s-berhasil .rw-stat-val { color:var(--green);text-shadow:0 0 15px rgba(105,219,124,0.5); }
    .s-pending .rw-stat-val { color:var(--orange);text-shadow:0 0 15px rgba(255,169,77,0.5); }

    /* Toolbar */
    .riwayat-toolbar {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 14px; flex-wrap: wrap; gap: 10px;
    }

    .rw-filter-tabs { display: flex; gap: 6px; overflow-x: auto; scrollbar-width: none; }
    .rw-filter-tabs::-webkit-scrollbar { display: none; }

    .rw-tab {
      flex-shrink: 0; padding: 7px 14px; border-radius: 20px;
      font-family: 'Orbitron', sans-serif; font-size: 8px;
      letter-spacing: 1.5px; border: 1px solid rgba(0,255,225,0.18);
      background: transparent; color: rgba(255,255,255,0.35);
      cursor: pointer; transition: all 0.2s; text-transform: uppercase;
      white-space: nowrap;
    }
    .rw-tab.active { background:rgba(0,255,225,0.1);border-color:rgba(0,255,225,0.45);color:var(--neon); }

    .btn-clear-riwayat {
      padding: 7px 12px; border-radius: 8px;
      border: 1px solid rgba(255,77,109,0.25);
      background: transparent; color: var(--red);
      font-family: 'Orbitron', sans-serif;
      font-size: 8px; letter-spacing: 1px;
      cursor: pointer; transition: all 0.2s;
      text-transform: uppercase; white-space: nowrap;
    }
    .btn-clear-riwayat:active { background: rgba(255,77,109,0.1); }

    /* Order history list */
    .riwayat-list {
      display: flex; flex-direction: column; gap: 10px;
      padding-bottom: 20px;
    }

    /* History card */
    .hc {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 14px; overflow: hidden;
      backdrop-filter: blur(10px);
      animation: fadeUp 0.3s ease both;
      transition: border-color 0.3s;
      position: relative;
    }

    .hc.pending { border-left: 3px solid var(--orange); }
    .hc.berhasil { border-left: 3px solid var(--green); }
    .hc.gagal { border-left: 3px solid var(--red); }

    /* Timeline dot */
    .hc::before {
      content: '';
      position: absolute; left: -1px; top: 50%;
      transform: translateY(-50%);
      width: 3px; height: 30px;
      border-radius: 2px;
    }

    .hc-top {
      display: flex; justify-content: space-between;
      align-items: center; padding: 12px 16px 8px;
      border-bottom: 1px solid rgba(0,255,225,0.05);
    }

    .hc-id {
      font-family: 'Share Tech Mono', monospace;
      font-size: 10px; color: rgba(0,255,225,0.5);
      letter-spacing: 0.5px;
    }

    .hc-time {
      font-family: 'Share Tech Mono', monospace;
      font-size: 10px; color: rgba(255,255,255,0.25);
    }

    .hc-body {
      padding: 12px 16px;
      display: flex; align-items: center; gap: 14px;
    }

    /* Product icon */
    .hc-icon {
      width: 52px; height: 52px; border-radius: 10px;
      border: 1px solid rgba(0,255,225,0.2);
      flex-shrink: 0;
      background-size: cover; background-position: center;
      background-color: rgba(0,255,225,0.05);
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
    }

    .hc-info { flex: 1; min-width: 0; }

    .hc-produk {
      font-family: 'Orbitron', sans-serif;
      font-size: 12px; font-weight: 700;
      color: #fff; margin-bottom: 4px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    .hc-detail {
      font-size: 12px; color: rgba(255,255,255,0.45);
      font-family: 'Share Tech Mono', monospace;
      letter-spacing: 0.5px;
    }

    .hc-right { text-align: right; flex-shrink: 0; }

    .hc-total {
      font-family: 'Orbitron', sans-serif;
      font-size: 16px; font-weight: 700;
      color: var(--neon); text-shadow: 0 0 10px rgba(0,255,225,0.4);
      margin-bottom: 4px;
    }

    .hc-badge {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 4px 10px; border-radius: 20px;
      font-family: 'Orbitron', sans-serif;
      font-size: 8px; letter-spacing: 1px; font-weight: 700;
      text-transform: uppercase;
    }
    .hc-badge.pending { background:rgba(255,169,77,0.12);color:var(--orange);border:1px solid rgba(255,169,77,0.28); }
    .hc-badge.berhasil { background:rgba(105,219,124,0.1);color:var(--green);border:1px solid rgba(105,219,124,0.25); }
    .hc-badge.gagal { background:rgba(255,77,109,0.1);color:var(--red);border:1px solid rgba(255,77,109,0.22); }

    /* Expand detail */
    .hc-expand {
      padding: 0 16px 12px;
      display: none;
      border-top: 1px solid rgba(0,255,225,0.05);
    }
    .hc-expand.open { display: block; padding-top: 12px; }

    .hc-expand-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 8px; margin-bottom: 10px;
    }

    .hce-field-label {
      font-family: 'Orbitron', sans-serif;
      font-size: 8px; letter-spacing: 1.5px;
      color: rgba(0,255,225,0.3); text-transform: uppercase; margin-bottom: 2px;
    }
    .hce-field-val {
      font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.8);
      font-family: 'Share Tech Mono', monospace;
    }

    /* Cek status ulang button */
    .btn-recheck {
      width: 100%; padding: 10px;
      background: transparent;
      border: 1px solid rgba(0,255,225,0.2);
      border-radius: 8px;
      font-family: 'Orbitron', sans-serif;
      font-size: 9px; letter-spacing: 2px;
      color: rgba(0,255,225,0.6);
      cursor: pointer; transition: all 0.2s;
      text-transform: uppercase; margin-top: 6px;
    }
    .btn-recheck:active { background: rgba(0,255,225,0.06); }

    /* Toggle expand */
    .hc-toggle {
      display: flex; justify-content: center; align-items: center;
      padding: 8px; border-top: 1px solid rgba(0,255,225,0.05);
      cursor: pointer; color: rgba(0,255,225,0.3);
      font-family: 'Share Tech Mono', monospace; font-size: 11px;
      gap: 6px; transition: color 0.2s;
    }
    .hc-toggle:hover { color: rgba(0,255,225,0.6); }
    .hc-toggle-arrow { transition: transform 0.3s; display: inline-block; }
    .hc-toggle.open .hc-toggle-arrow { transform: rotate(180deg); }

    /* Empty riwayat */
    .riwayat-empty {
      text-align: center; padding: 60px 20px;
      color: rgba(0,255,225,0.2);
      font-family: 'Share Tech Mono', monospace;
      font-size: 13px; letter-spacing: 2px; line-height: 2.2;
    }

    .riwayat-empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.3; }

    /* ── QRIS ── */
    #qrisPopup{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(12px);justify-content:center;align-items:flex-end;z-index:999;}
    .qrisContent{background:rgba(7,21,32,0.98);border:1px solid rgba(0,255,225,0.25);border-radius:24px 24px 0 0;padding:28px 24px 36px;text-align:center;width:100%;max-width:440px;animation:slideUp 0.4s cubic-bezier(0.22,1,0.36,1);}
    @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
    .qris-handle{width:40px;height:4px;background:rgba(255,255,255,0.15);border-radius:2px;margin:0 auto 22px;}
    .qrisContent h3{font-family:'Orbitron',sans-serif;font-size:13px;letter-spacing:2px;color:var(--neon);margin-bottom:18px;text-transform:uppercase;}
    .qrisContent img{width:200px;border-radius:14px;border:2px solid rgba(0,255,225,0.2);}
    .qris-amount{font-family:'Orbitron',sans-serif;font-size:20px;color:var(--neon);text-shadow:var(--neon-glow);margin:14px 0 6px;}
    .qris-btns{display:flex;gap:10px;margin-top:18px;}
    .qris-btns button{flex:1;padding:15px;border:none;border-radius:12px;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:1px;font-weight:700;cursor:pointer;text-transform:uppercase;}
    .btn-sudah{background:linear-gradient(135deg,#00ffe1,#00b0a2);color:#040c12;}
    .btn-tutup{background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.1)!important;color:rgba(255,255,255,0.45);}

    /* ── ADMIN ── */
    .admin-header-bar{display:flex;justify-content:space-between;align-items:center;padding:20px 14px 10px;max-width:700px;margin:0 auto;}
    .admin-title{font-family:'Orbitron',sans-serif;font-size:16px;letter-spacing:3px;color:var(--neon);text-shadow:var(--neon-glow);text-transform:uppercase;}
    .btn-logout{padding:8px 14px;border-radius:8px;border:1px solid rgba(255,77,109,0.3);background:transparent;color:var(--red);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;}
    .btn-logout:active{background:rgba(255,77,109,0.1);}
    .admin-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:0 14px 10px;max-width:700px;margin:0 auto;}
    .stat-card{background:var(--card-bg);border:1px solid var(--border);border-radius:14px;padding:16px 10px;text-align:center;backdrop-filter:blur(10px);position:relative;overflow:hidden;}
    .stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
    .stat-card.total::before{background:linear-gradient(90deg,transparent,var(--neon),transparent);}
    .stat-card.berhasil::before{background:linear-gradient(90deg,transparent,var(--green),transparent);}
    .stat-card.pending::before{background:linear-gradient(90deg,transparent,var(--orange),transparent);}
    .stat-label{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:2px;color:rgba(0,255,225,0.38);text-transform:uppercase;margin-bottom:6px;}
    .stat-value{font-family:'Orbitron',sans-serif;font-size:26px;font-weight:700;}
    .stat-value.total-v{color:var(--neon);text-shadow:var(--neon-glow);}
    .stat-value.berhasil-v{color:var(--green);}
    .stat-value.pending-v{color:var(--orange);}
    .filter-tabs{display:flex;gap:8px;padding:10px 14px;overflow-x:auto;scrollbar-width:none;max-width:700px;margin:0 auto;}
    .filter-tabs::-webkit-scrollbar{display:none;}
    .filter-tab{flex-shrink:0;padding:8px 16px;border-radius:20px;cursor:pointer;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1.5px;border:1px solid rgba(0,255,225,0.18);background:transparent;color:rgba(255,255,255,0.4);transition:all 0.2s;text-transform:uppercase;white-space:nowrap;}
    .filter-tab.active{background:rgba(0,255,225,0.1);border-color:rgba(0,255,225,0.45);color:var(--neon);}
    .admin-toolbar{display:flex;align-items:center;justify-content:space-between;padding:4px 14px 10px;max-width:700px;margin:0 auto;flex-wrap:wrap;gap:8px;}
    .live-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(105,219,124,0.1);border:1px solid rgba(105,219,124,0.25);border-radius:20px;padding:5px 12px;font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--green);letter-spacing:1px;}
    .live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);animation:blink 1.5s ease infinite;}
    .btn-clear{padding:7px 14px;border-radius:8px;border:1px solid rgba(255,77,109,0.28);background:transparent;color:var(--red);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;}
    .btn-clear:active{background:rgba(255,77,109,0.1);}
    .orders-list{padding:0 14px 20px;max-width:700px;margin:0 auto;display:flex;flex-direction:column;gap:12px;}
    .order-card{background:var(--card-bg);border:1px solid var(--border);border-radius:16px;overflow:hidden;backdrop-filter:blur(10px);animation:fadeUp 0.35s ease both;}
    .order-card.pending{border-left:3px solid var(--orange);}
    .order-card.berhasil{border-left:3px solid var(--green);}
    .order-card.gagal{border-left:3px solid var(--red);}
    .oc-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px 10px;border-bottom:1px solid rgba(0,255,225,0.06);}
    .oc-id{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(0,255,225,0.55);}
    .oc-time{font-family:'Share Tech Mono',monospace;font-size:10px;color:rgba(255,255,255,0.28);}
    .oc-body{padding:12px 16px;}
    .oc-user{font-family:'Orbitron',sans-serif;font-size:15px;font-weight:700;color:#fff;margin-bottom:10px;}
    .oc-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;}
    .oc-field-label{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1.5px;color:rgba(0,255,225,0.35);text-transform:uppercase;margin-bottom:3px;}
    .oc-field-value{font-size:14px;font-weight:600;color:rgba(255,255,255,0.85);}
    .oc-total{font-family:'Orbitron',sans-serif;font-size:20px;font-weight:700;color:var(--neon);}
    .status-badge{display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:20px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;font-weight:700;text-transform:uppercase;}
    .status-badge.pending{background:rgba(255,169,77,0.12);color:var(--orange);border:1px solid rgba(255,169,77,0.28);}
    .status-badge.berhasil{background:rgba(105,219,124,0.1);color:var(--green);border:1px solid rgba(105,219,124,0.25);}
    .status-badge.gagal{background:rgba(255,77,109,0.1);color:var(--red);border:1px solid rgba(255,77,109,0.22);}
    .oc-actions{display:grid;grid-template-columns:1fr 1fr;gap:0;border-top:1px solid rgba(0,255,225,0.07);}
    .oc-btn{padding:15px 10px;border:none;background:transparent;font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;letter-spacing:1.5px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;display:flex;align-items:center;justify-content:center;gap:6px;}
    .oc-btn:first-child{border-right:1px solid rgba(0,255,225,0.07);border-radius:0 0 0 13px;}
    .oc-btn:last-child{border-radius:0 0 13px 0;}
    .oc-btn.confirm{color:var(--green);}
    .oc-btn.reject{color:var(--red);}
    .oc-btn.confirm:active{background:rgba(105,219,124,0.1);}
    .oc-btn.reject:active{background:rgba(255,77,109,0.08);}
    .oc-btn:only-child{grid-column:1/-1;border-right:none;border-radius:0 0 13px 13px;}
    .oc-done{padding:13px;text-align:center;font-family:'Share Tech Mono',monospace;font-size:11px;letter-spacing:1px;color:rgba(255,255,255,0.2);border-top:1px solid rgba(0,255,225,0.06);}
    .empty-state{text-align:center;padding:50px 20px;color:rgba(0,255,225,0.25);font-family:'Share Tech Mono',monospace;font-size:13px;letter-spacing:2px;line-height:2;}
    .loading-state{text-align:center;padding:50px;}
    .spinner{display:inline-block;width:32px;height:32px;border:3px solid rgba(0,255,225,0.12);border-top-color:var(--neon);border-radius:50%;animation:spin 0.8s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ── PIN POPUP ── */
    #pwPopup{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.92);backdrop-filter:blur(16px);justify-content:center;align-items:center;z-index:9000;}
    .pw-box{background:rgba(7,21,32,0.98);border:1px solid rgba(0,255,225,0.25);border-radius:24px;padding:36px 28px;width:90%;max-width:340px;text-align:center;box-shadow:0 0 80px rgba(0,255,225,0.15);animation:popIn 0.4s cubic-bezier(0.22,1,0.36,1);}
    .pw-icon{font-size:40px;margin-bottom:16px;}
    .pw-title{font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:3px;color:var(--neon);margin-bottom:6px;text-transform:uppercase;}
    .pw-sub{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.3);letter-spacing:1px;margin-bottom:28px;}
    .pin-dots{display:flex;justify-content:center;gap:14px;margin-bottom:24px;}
    .pin-dot{width:16px;height:16px;border-radius:50%;border:2px solid rgba(0,255,225,0.3);background:transparent;transition:all 0.2s;}
    .pin-dot.filled{background:var(--neon);border-color:var(--neon);box-shadow:0 0 12px rgba(0,255,225,0.6);transform:scale(1.1);}
    .pin-dot.error{background:var(--red);border-color:var(--red);animation:shake 0.4s ease;}
    @keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
    .numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;}
    .num-btn{padding:18px 10px;background:rgba(0,255,225,0.05);border:1px solid rgba(0,255,225,0.12);border-radius:12px;font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700;color:var(--text);cursor:pointer;transition:all 0.15s;user-select:none;}
    .num-btn:active{background:rgba(0,255,225,0.15);border-color:rgba(0,255,225,0.4);transform:scale(0.94);}
    .num-btn.del{font-size:20px;color:rgba(255,255,255,0.4);}
    .num-btn.empty{background:transparent;border:none;cursor:default;}
    .pw-cancel{font-family:'Share Tech Mono',monospace;font-size:11px;color:rgba(255,255,255,0.25);background:transparent;border:none;cursor:pointer;letter-spacing:1px;padding:8px;}

    .toast{position:fixed;bottom:calc(var(--bottom-h) + 14px);left:50%;transform:translateX(-50%);background:rgba(7,21,32,0.97);border:1px solid rgba(0,255,225,0.3);color:var(--neon);padding:13px 22px;border-radius:12px;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:1.5px;backdrop-filter:blur(15px);z-index:9999;box-shadow:0 0 30px rgba(0,255,225,0.15);white-space:nowrap;animation:toastIn 0.3s ease;}
    @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(16px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
    @keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes popIn{from{opacity:0;transform:scale(0.85) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}

    /* ══════════════════════════════
       UPLOAD BUKTI TRANSFER
    ══════════════════════════════ */

    /* Upload section after order */
    .upload-section {
      max-width: 480px; margin: 0 auto;
      padding: 0 14px 30px;
    }

    .upload-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 18px; padding: 22px 18px;
      backdrop-filter: blur(20px);
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    }

    .upload-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 12px; letter-spacing: 3px;
      color: var(--neon); margin-bottom: 6px;
      text-transform: uppercase;
    }

    .upload-sub {
      font-family: 'Share Tech Mono', monospace;
      font-size: 11px; color: rgba(255,255,255,0.3);
      letter-spacing: 1px; margin-bottom: 18px;
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
    }

    /* Order ID selector for upload */
    .upload-id-row {
      display: flex; gap: 8px; margin-bottom: 14px;
    }

    .upload-id-input {
      flex: 1;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(0,255,225,0.16);
      border-radius: 10px; padding: 12px 14px;
      font-size: 14px; font-family: 'Share Tech Mono', monospace;
      color: #fff; outline: none;
      transition: border-color 0.3s;
    }
    .upload-id-input:focus { border-color: rgba(0,255,225,0.5); }
    .upload-id-input::placeholder { color: rgba(255,255,255,0.2); font-size: 12px; }

    .btn-autofill {
      padding: 12px 14px;
      background: rgba(0,255,225,0.08);
      border: 1px solid rgba(0,255,225,0.25);
      border-radius: 10px;
      font-family: 'Orbitron', sans-serif;
      font-size: 9px; letter-spacing: 1px;
      color: var(--neon); cursor: pointer;
      transition: all 0.2s; white-space: nowrap;
      text-transform: uppercase;
    }
    .btn-autofill:active { background: rgba(0,255,225,0.15); }

    /* Drop zone */
    .drop-zone {
      border: 2px dashed rgba(0,255,225,0.25);
      border-radius: 14px;
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      background: rgba(0,255,225,0.02);
      margin-bottom: 14px;
    }

    .drop-zone:hover, .drop-zone.dragover {
      border-color: rgba(0,255,225,0.6);
      background: rgba(0,255,225,0.05);
    }

    .drop-zone input[type="file"] {
      position: absolute; inset: 0;
      opacity: 0; cursor: pointer; width: 100%; height: 100%;
    }

    .drop-icon { font-size: 36px; margin-bottom: 10px; }

    .drop-text {
      font-family: 'Orbitron', sans-serif;
      font-size: 11px; letter-spacing: 2px;
      color: rgba(0,255,225,0.5); text-transform: uppercase;
    }

    .drop-sub {
      font-family: 'Share Tech Mono', monospace;
      font-size: 10px; color: rgba(255,255,255,0.25);
      margin-top: 6px; letter-spacing: 1px;
    }

    /* Preview */
    .bukti-preview {
      display: none;
      position: relative; margin-bottom: 14px;
    }

    .bukti-preview.visible { display: block; }

    .bukti-preview img {
      width: 100%; border-radius: 12px;
      border: 1px solid rgba(0,255,225,0.2);
      max-height: 220px; object-fit: cover;
    }

    .bukti-preview-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(to top, rgba(4,12,18,0.7) 0%, transparent 50%);
      border-radius: 12px;
      display: flex; align-items: flex-end;
      padding: 12px;
    }

    .bukti-preview-label {
      font-family: 'Orbitron', sans-serif;
      font-size: 9px; letter-spacing: 2px;
      color: var(--neon); text-transform: uppercase;
    }

    .bukti-remove {
      position: absolute; top: 8px; right: 8px;
      width: 28px; height: 28px; border-radius: 50%;
      background: rgba(255,77,109,0.8);
      border: none; color: #fff; font-size: 14px;
      cursor: pointer; display: flex;
      align-items: center; justify-content: center;
      transition: all 0.2s;
    }

    .btn-upload-submit {
      width: 100%; padding: 16px;
      background: linear-gradient(135deg, rgba(0,255,225,0.15), rgba(0,180,255,0.1));
      border: 1px solid rgba(0,255,225,0.35);
      border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700; font-size: 12px;
      letter-spacing: 2px; color: var(--neon);
      cursor: pointer; transition: all 0.25s;
      text-transform: uppercase;
    }
    .btn-upload-submit:active { transform: scale(0.97); }
    .btn-upload-submit:disabled { opacity: 0.4; }

    /* Progress bar */
    .upload-progress {
      display: none; margin-top: 10px;
    }
    .upload-progress.visible { display: block; }
    .progress-bar-wrap {
      background: rgba(0,0,0,0.3);
      border-radius: 6px; height: 6px;
      overflow: hidden; margin-bottom: 6px;
    }
    .progress-bar-fill {
      height: 100%; width: 0%;
      background: linear-gradient(90deg, var(--neon), #00b0ff);
      border-radius: 6px;
      transition: width 0.3s ease;
      box-shadow: 0 0 8px rgba(0,255,225,0.5);
    }
    .progress-label {
      font-family: 'Share Tech Mono', monospace;
      font-size: 10px; color: rgba(0,255,225,0.5);
      letter-spacing: 1px; text-align: center;
    }

    /* ── Admin bukti viewer ── */
    .bukti-thumb {
      width: 52px; height: 52px; border-radius: 8px;
      object-fit: cover;
      border: 1px solid rgba(0,255,225,0.25);
      cursor: pointer; transition: all 0.2s;
      flex-shrink: 0;
    }
    .bukti-thumb:hover { border-color: var(--neon); transform: scale(1.05); }

    .no-bukti {
      width: 52px; height: 52px; border-radius: 8px;
      border: 1px dashed rgba(255,255,255,0.1);
      display: flex; align-items: center; justify-content: center;
      font-size: 20px; flex-shrink: 0;
      color: rgba(255,255,255,0.15);
    }

    /* Lightbox */
    #lightbox {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.95);
      backdrop-filter: blur(20px);
      z-index: 9998;
      justify-content: center; align-items: center;
      padding: 20px;
    }

    #lightbox img {
      max-width: 100%; max-height: 90vh;
      border-radius: 16px;
      border: 1px solid rgba(0,255,225,0.2);
      box-shadow: 0 0 60px rgba(0,255,225,0.15);
    }

    .lightbox-close {
      position: absolute; top: 16px; right: 16px;
      width: 40px; height: 40px; border-radius: 50%;
      background: rgba(255,77,109,0.8);
      border: none; color: #fff; font-size: 20px;
      cursor: pointer; display: flex;
      align-items: center; justify-content: center;
      z-index: 9999;
    }

    .lightbox-label {
      position: absolute; bottom: 20px; left: 50%;
      transform: translateX(-50%);
      font-family: 'Share Tech Mono', monospace;
      font-size: 11px; color: rgba(0,255,225,0.5);
      letter-spacing: 2px; white-space: nowrap;
    }


    /* ══════════════════════════════
       PAYMENT METHOD CARD
    ══════════════════════════════ */
    .payment-card {
      display: none;
      border-radius: 14px; padding: 16px 18px;
      margin-bottom: 12px;
      animation: fadeUp 0.3s ease;
      position: relative; overflow: hidden;
    }
    .payment-card.visible { display: block; }

    .payment-card.dana  { background: linear-gradient(135deg, rgba(0,100,255,0.12), rgba(0,60,200,0.06)); border: 1px solid rgba(0,120,255,0.3); }
    .payment-card.ovo   { background: linear-gradient(135deg, rgba(120,0,200,0.12), rgba(80,0,160,0.06)); border: 1px solid rgba(130,0,220,0.3); }
    .payment-card.gopay { background: linear-gradient(135deg, rgba(0,180,80,0.12), rgba(0,140,60,0.06)); border: 1px solid rgba(0,200,80,0.3); }
    .payment-card.qris  { background: linear-gradient(135deg, rgba(0,255,225,0.08), rgba(0,180,200,0.04)); border: 1px solid rgba(0,255,225,0.25); }

    .pm-header {
      display: flex; align-items: center; gap: 10px;
      margin-bottom: 12px;
    }

    .pm-logo {
      width: 36px; height: 36px; border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; flex-shrink: 0;
    }
    .dana  .pm-logo { background: rgba(0,100,255,0.2); }
    .ovo   .pm-logo { background: rgba(120,0,200,0.2); }
    .gopay .pm-logo { background: rgba(0,180,80,0.2); }
    .qris  .pm-logo { background: rgba(0,255,225,0.12); }

    .pm-name {
      font-family: 'Orbitron', sans-serif;
      font-size: 13px; font-weight: 700; letter-spacing: 2px;
    }
    .dana  .pm-name { color: #4d9fff; }
    .ovo   .pm-name { color: #c084fc; }
    .gopay .pm-name { color: #4ade80; }
    .qris  .pm-name { color: var(--neon); }

    .pm-divider {
      height: 1px; margin-bottom: 12px;
    }
    .dana  .pm-divider { background: rgba(0,100,255,0.15); }
    .ovo   .pm-divider { background: rgba(120,0,200,0.15); }
    .gopay .pm-divider { background: rgba(0,180,80,0.15); }
    .qris  .pm-divider { background: rgba(0,255,225,0.1); }

    .pm-label {
      font-family: 'Orbitron', sans-serif;
      font-size: 8px; letter-spacing: 2px;
      color: rgba(255,255,255,0.3); text-transform: uppercase;
      margin-bottom: 4px;
    }

    .pm-number {
      font-family: 'Share Tech Mono', monospace;
      font-size: 20px; font-weight: 700;
      color: #fff; letter-spacing: 2px;
      margin-bottom: 4px;
    }

    .pm-name-rek {
      font-size: 13px; color: rgba(255,255,255,0.5);
      font-family: 'Rajdhani', sans-serif;
      font-weight: 500; margin-bottom: 14px;
    }

    .btn-copy {
      width: 100%; padding: 11px;
      border-radius: 10px; cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-size: 10px; letter-spacing: 2px;
      font-weight: 700; transition: all 0.2s;
      text-transform: uppercase; border: none;
    }
    .dana  .btn-copy { background: rgba(0,100,255,0.2); color: #4d9fff; border: 1px solid rgba(0,100,255,0.3); }
    .ovo   .btn-copy { background: rgba(120,0,200,0.2); color: #c084fc; border: 1px solid rgba(120,0,200,0.3); }
    .gopay .btn-copy { background: rgba(0,180,80,0.18); color: #4ade80; border: 1px solid rgba(0,180,80,0.3); }
    .qris  .btn-copy { background: rgba(0,255,225,0.08); color: var(--neon); border: 1px solid rgba(0,255,225,0.25); }
    .btn-copy:active { opacity: 0.7; transform: scale(0.97); }
    .btn-copy.copied { opacity: 0.7; }


    /* ══════════════════════════════
       DESKTOP RESPONSIVE (>768px)
    ══════════════════════════════ */
    @media (min-width: 768px) {

      /* Bottom nav jadi side nav di desktop */
      .bottom-nav {
        position: fixed;
        left: 0; top: 0; bottom: 0;
        width: 80px; height: 100vh;
        flex-direction: column;
        border-top: none;
        border-right: 1px solid rgba(0,255,225,0.1);
        padding: 80px 0 20px;
        z-index: 98;
      }

      .bottom-tab {
        padding: 16px 0;
        flex: none;
        width: 100%;
      }

      .tab-badge {
        top: 8px;
        right: 14px;
      }

      /* Geser semua page konten ke kanan */
      .page {
        padding-left: 80px;
      }

      /* Produk grid 4 kolom di desktop */
      .card-container {
        grid-template-columns: repeat(4, 1fr);
        max-width: 900px;
        gap: 14px;
        padding: 0 32px;
      }

      /* Form order lebih lebar + tengah */
      .order-section {
        max-width: 600px;
        padding: 0 32px 30px;
      }

      .upload-section {
        max-width: 600px;
        padding: 0 32px 30px;
      }

      /* Header lebih besar */
      header {
        padding: 48px 32px 20px;
      }

      header h1 {
        font-size: 56px;
      }

      .section-title {
        margin: 36px 0 18px;
      }

      /* Riwayat */
      .riwayat-header {
        padding: 32px 32px 0;
        max-width: 800px;
      }

      .riwayat-stats {
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
      }

      .rw-stat-val {
        font-size: 28px;
      }

      /* Admin panel */
      .admin-header-bar {
        padding: 28px 32px 14px;
        max-width: 900px;
      }

      .admin-stats {
        padding: 0 32px 14px;
        max-width: 900px;
        gap: 14px;
      }

      .stat-value { font-size: 30px; }

      .filter-tabs {
        padding: 10px 32px;
        max-width: 900px;
      }

      .admin-toolbar {
        padding: 4px 32px 12px;
        max-width: 900px;
      }

      .orders-list {
        padding: 0 32px 30px;
        max-width: 900px;
      }

      /* Order cards desktop — 2 kolom */
      .orders-list {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
        align-items: start;
      }

      /* Riwayat list desktop — 2 kolom */
      .riwayat-list {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        align-items: start;
      }

      /* Top nav stays above sidebar */
      .top-nav {
        left: 80px;
        z-index: 101;
      }

      .nav-logo {
        font-size: 18px;
      }

      /* Form card bigger padding */
      .form-card {
        padding: 28px 26px;
      }

      .testi-section {
        max-width: 1000px;
        padding: 0 32px 30px;
      }

      .testi-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }

      /* Input bigger on desktop */
      .input-field {
        font-size: 15px;
        padding: 14px 16px;
      }

      /* Payment cards */
      .payment-card {
        padding: 18px 22px;
      }

      .pm-number {
        font-size: 24px;
      }
    }

    @media (min-width: 1200px) {
      .card-container {
        grid-template-columns: repeat(5, 1fr);
        max-width: 1100px;
      }

      .order-section, .upload-section {
        max-width: 680px;
      }

      .orders-list, .orders-list {
        max-width: 1100px;
        grid-template-columns: repeat(2, 1fr);
      }
    }


    /* ══════════════════════════════
       ADMIN - KELOLA PRODUK
    ══════════════════════════════ */

    .admin-tab-bar {
      display: flex; gap: 0;
      max-width: 700px; margin: 0 auto 0;
      padding: 0 14px;
      border-bottom: 1px solid rgba(0,255,225,0.1);
    }

    .admin-tab-btn {
      padding: 12px 18px;
      font-family: 'Orbitron', sans-serif;
      font-size: 9px; letter-spacing: 2px;
      color: rgba(255,255,255,0.3);
      border: none; background: transparent;
      cursor: pointer; border-bottom: 2px solid transparent;
      transition: all 0.2s; text-transform: uppercase;
      position: relative; bottom: -1px;
      white-space: nowrap;
    }
    .admin-tab-btn.active { color: var(--neon); border-bottom-color: var(--neon); }

    .admin-section { display: none; }
    .admin-section.active { display: block; }

    /* Produk grid in admin */
    .produk-admin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 14px 14px 10px;
      max-width: 700px; margin: 0 auto;
    }

    @media(min-width:768px) {
      .produk-admin-grid { grid-template-columns: repeat(3,1fr); padding: 14px 32px 10px; max-width: 900px; }
    }

    .produk-admin-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 14px; overflow: hidden;
      backdrop-filter: blur(10px);
      animation: fadeUp 0.3s ease both;
      position: relative;
    }

    .pac-img {
      width: 100%; aspect-ratio: 1/0.8;
      object-fit: cover;
      background: rgba(0,255,225,0.05);
      display: block;
    }

    .pac-img-placeholder {
      width: 100%; aspect-ratio: 1/0.8;
      background: rgba(0,255,225,0.04);
      display: flex; align-items: center; justify-content: center;
      font-size: 32px; color: rgba(255,255,255,0.1);
    }

    .pac-body { padding: 10px 12px 12px; }

    .pac-name {
      font-family: 'Orbitron', sans-serif;
      font-size: 10px; font-weight: 700;
      color: #fff; letter-spacing: 1px;
      margin-bottom: 4px; text-transform: uppercase;
    }

    .pac-price {
      font-family: 'Rajdhani', sans-serif;
      font-size: 16px; font-weight: 700;
      color: var(--neon); margin-bottom: 10px;
    }

    .pac-actions {
      display: flex; gap: 6px;
    }

    .pac-btn {
      flex: 1; padding: 8px 6px;
      border-radius: 8px; cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-size: 8px; letter-spacing: 1px;
      border: none; transition: all 0.2s;
      text-transform: uppercase; font-weight: 700;
    }

    .pac-btn.edit { background: rgba(0,255,225,0.1); color: var(--neon); border: 1px solid rgba(0,255,225,0.25); }
    .pac-btn.del { background: rgba(255,77,109,0.1); color: var(--red); border: 1px solid rgba(255,77,109,0.22); }
    .pac-btn:active { transform: scale(0.95); }

    /* Add produk button */
    .btn-add-produk {
      display: flex; align-items: center; justify-content: center;
      gap: 8px;
      width: calc(100% - 28px); margin: 0 14px 14px;
      max-width: 672px;
      padding: 14px;
      background: rgba(0,255,225,0.06);
      border: 2px dashed rgba(0,255,225,0.25);
      border-radius: 14px; cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-size: 11px; letter-spacing: 2px;
      color: rgba(0,255,225,0.5);
      transition: all 0.2s; text-transform: uppercase;
    }
    .btn-add-produk:hover { background: rgba(0,255,225,0.1); border-color: rgba(0,255,225,0.5); color: var(--neon); }

    @media(min-width:768px) {
      .btn-add-produk { width: calc(100% - 64px); margin: 0 32px 14px; max-width: 868px; }
    }

    /* Produk modal */
    #produkModal {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.92);
      backdrop-filter: blur(16px);
      z-index: 8000;
      justify-content: center; align-items: flex-end;
      padding: 0;
    }

    .produk-modal-box {
      background: rgba(7,21,32,0.99);
      border: 1px solid rgba(0,255,225,0.2);
      border-radius: 24px 24px 0 0;
      padding: 28px 22px 36px;
      width: 100%; max-width: 480px;
      animation: slideUp 0.4s cubic-bezier(0.22,1,0.36,1);
      max-height: 88vh; overflow-y: auto; -webkit-overflow-scrolling: touch;
    }

    .modal-handle {
      width: 40px; height: 4px;
      background: rgba(255,255,255,0.15);
      border-radius: 2px; margin: 0 auto 22px;
    }

    .modal-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 14px; letter-spacing: 3px;
      color: var(--neon); margin-bottom: 20px;
      text-transform: uppercase; text-align: center;
    }

    /* Image upload in modal */
    .img-upload-zone {
      border: 2px dashed rgba(0,255,225,0.2);
      border-radius: 12px;
      aspect-ratio: 16/9;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      cursor: pointer; position: relative;
      overflow: hidden; margin-bottom: 14px;
      -webkit-tap-highlight-color: rgba(0,255,225,0.1);
      background: rgba(0,255,225,0.02);
      transition: all 0.2s;
    }

    .img-upload-zone:hover { border-color: rgba(0,255,225,0.45); background: rgba(0,255,225,0.05); }
    .img-upload-zone input { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; font-size: 100px; }
    .img-upload-zone img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
    .img-upload-zone .upload-hint { font-family: 'Share Tech Mono', monospace; font-size: 11px; color: rgba(0,255,225,0.4); letter-spacing: 1px; text-align: center; z-index: 1; }
    .img-upload-zone .upload-hint span { font-size: 28px; display: block; margin-bottom: 8px; }

    .modal-btns { display: flex; gap: 10px; margin-top: 6px; }

    .btn-modal-save {
      flex: 2; padding: 16px;
      background: linear-gradient(135deg,#00ffe1,#00b0a2);
      border: none; border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-size: 11px; font-weight: 700;
      letter-spacing: 2px; color: #040c12;
      cursor: pointer; text-transform: uppercase;
      transition: all 0.2s;
    }
    .btn-modal-save:active { transform: scale(0.97); }
    .btn-modal-save:disabled { opacity: 0.5; }

    .btn-modal-cancel {
      flex: 1; padding: 16px;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-size: 11px; letter-spacing: 2px;
      color: rgba(255,255,255,0.3);
      cursor: pointer; text-transform: uppercase;
    }

    .produk-empty-state {
      grid-column: 1/-1; text-align: center;
      padding: 40px 20px;
      color: rgba(0,255,225,0.25);
      font-family: 'Share Tech Mono', monospace;
      font-size: 13px; letter-spacing: 2px;
    }

    ::-webkit-scrollbar{width:3px;}::-webkit-scrollbar-track{background:var(--bg1);}::-webkit-scrollbar-thumb{background:rgba(0,255,225,0.2);border-radius:2px;}
  </style>
</head>
<body>

<canvas id="matrixCanvas"></canvas>
<canvas id="particleCanvas"></canvas>
<div class="bg-overlay"></div>

<!-- TOP NAV -->
<nav class="top-nav">
  <div class="nav-logo" id="navLogo" onclick="handleLogoTap()">
    NEOSTORE⚡
    <div class="tap-dots" id="tapDots">
      <div class="tap-dot" id="td0"></div><div class="tap-dot" id="td1"></div>
      <div class="tap-dot" id="td2"></div><div class="tap-dot" id="td3"></div>
      <div class="tap-dot" id="td4"></div>
    </div>
  </div>
  <div class="fb-status">
    <div class="fb-dot" id="fbDot"></div>
    <span id="fbStatusText" style="color:rgba(255,255,255,0.3)">connecting</span>
  </div>
</nav>

<!-- ═══ STORE ═══ -->
<div class="page active" id="page-store">
  <header>
    <div class="logo-wrap"><h1>NEOSTORE⚡</h1></div>
    <div class="tagline">Premium Digital Marketplace</div>
    <div class="header-line"></div>
  </header>

  <p class="section-title">— Pilih Produk —</p>
  <section class="card-container" id="produkGrid">
    <div style="grid-column:1/-1;text-align:center;padding:30px;color:rgba(0,255,225,0.3);font-family:'Share Tech Mono',monospace;font-size:12px;letter-spacing:2px;">
      <div class="spinner"></div>
    </div>
  </section>

  <section class="order-section">
    <div class="form-card">
      <div class="form-title">⚡ Form Order</div>
      <div class="selected-product-banner" id="selectedBanner">
        <span id="selectedName">—</span>
        <span id="selectedPriceTag" style="font-size:12px;opacity:0.65;"></span>
      </div>
      <div class="input-row"><label class="input-label">Username Fishit</label><input type="text" class="input-field" id="username" placeholder="Masukkan username..."></div>
      <div class="input-row"><label class="input-label">Metode Pembayaran</label>
        <select class="input-field" id="metode">
          <option value="">Pilih metode...</option>
          <option>DANA</option><option>OVO</option><option>GOPAY</option><option>QRIS</option>
        </select>
      </div>

      <!-- PAYMENT METHOD CARD -->
      <div class="payment-card dana" id="pm-DANA">
        <div class="pm-header">
          <div class="pm-logo">💙</div>
          <div class="pm-name">DANA</div>
        </div>
        <div class="pm-divider"></div>
        <div class="pm-label">Nomor DANA</div>
        <div class="pm-number">0813-2894-1033</div>
        <div class="pm-name-rek">a.n. m.yanis Zahiruddin</div>
        <button class="btn-copy" onclick="copyNomor('0813-2894-1033', this)">📋 Salin Nomor</button>
      </div>

      <div class="payment-card ovo" id="pm-OVO">
        <div class="pm-header">
          <div class="pm-logo">💜</div>
          <div class="pm-name">OVO</div>
        </div>
        <div class="pm-divider"></div>
        <div class="pm-label">Nomor OVO</div>
        <div class="pm-number">0813-2894-1033</div>
        <div class="pm-name-rek">a.n. m.yanis Zahiruddin</div>
        <button class="btn-copy" onclick="copyNomor('0813-2894-1033', this)">📋 Salin Nomor</button>
      </div>

      <div class="payment-card gopay" id="pm-GOPAY">
        <div class="pm-header">
          <div class="pm-logo">💚</div>
          <div class="pm-name">GOPAY</div>
        </div>
        <div class="pm-divider"></div>
        <div class="pm-label">Nomor GoPay</div>
        <div class="pm-number">0813-2894-1033</div>
        <div class="pm-name-rek">a.n. m.yanis Zahiruddin</div>
        <button class="btn-copy" onclick="copyNomor('0813-2894-1033', this)">📋 Salin Nomor</button>
      </div>

      <div class="payment-card qris" id="pm-QRIS">
        <div class="pm-header">
          <div class="pm-logo">⚡</div>
          <div class="pm-name">QRIS</div>
        </div>
        <div class="pm-divider"></div>
<div class="pm-label" style="font-size:14px;opacity:1;color:#00ffe1;font-weight:600;">QR Code akan tampil otomatis</div>
<div class="pm-number" style="font-size:14px;opacity:1;color:#00ffe1;font-weight:600;">Setelah Klik Order</div>
      </div>

      <div class="input-row"><label class="input-label">Jumlah Pembelian</label><input type="number" class="input-field" id="jumlah" min="1" value="1" oninput="updateTotal()"></div>
      <div class="total-display"><span class="total-label">Total Bayar</span><span class="total-amount" id="totalBox">Rp0</span></div>
      <div class="summary-box" id="summaryBox"></div>
      <div class="id-box" id="idPembayaranBox">🔑 ID: —</div>
      <button class="btn-order" id="btnOrder" onclick="submitOrder()">ORDER SEKARANG</button>
      <div class="divider">CEK STATUS</div>
      <div class="input-row"><label class="input-label">ID Pembayaran</label><input type="text" class="input-field" id="cekId" placeholder="NEO-XXXXX-XXX"></div>
      <button class="btn-cek" onclick="cekStatus()">🔍 Cek Status</button>
      <div class="hasil-cek" id="hasilCek"></div>
    </div>
  </section>
</div>

  <!-- UPLOAD BUKTI BAYAR -->
  <section class="upload-section" id="uploadSection" style="display:none">
    <p class="section-title" style="margin-top:0">— Upload Bukti Bayar —</p>
    <div class="upload-card">
      <div class="upload-title">📎 Bukti Transfer</div>
      <div class="upload-sub">Upload foto bukti bayar setelah melakukan pembayaran</div>

      <div class="upload-id-row">
        <input type="text" class="upload-id-input" id="uploadOrderId" placeholder="ID Order (NEO-XXXXX-XXX)" readonly>
        <button class="btn-autofill" onclick="autofillOrderId()">⚡ ID Terakhir</button>
      </div>

      <!-- Label trick: paling reliable di semua mobile browser -->
      <label for="buktiFile" class="drop-zone" id="dropZone">
        <div class="drop-icon">📸</div>
        <div class="drop-text">Tap untuk pilih foto</div>
        <div class="drop-sub">JPG, PNG — maks 5MB</div>
      </label>
      <input type="file" id="buktiFile" accept="image/*" onchange="handleFileSelect(event)" style="position:absolute;left:-9999px;opacity:0;width:1px;height:1px;">

      <div class="bukti-preview" id="buktiPreview">
        <img id="buktiPreviewImg" src="" alt="Preview">
        <div class="bukti-preview-overlay">
          <span class="bukti-preview-label">📎 Bukti Transfer</span>
        </div>
        <button class="bukti-remove" onclick="removeBukti()">✕</button>
      </div>

      <div class="upload-progress" id="uploadProgress">
        <div class="progress-bar-wrap">
          <div class="progress-bar-fill" id="progressFill"></div>
        </div>
        <div class="progress-label" id="progressLabel">Mengkompres foto...</div>
      </div>

      <button class="btn-upload-submit" id="btnUpload" onclick="submitBukti()">📤 KIRIM BUKTI BAYAR</button>
    </div>
  </section>

<!-- ═══ RIWAYAT ═══ -->
<div class="page" id="page-riwayat">
  <div class="riwayat-header">
    <div class="riwayat-title">📋 Riwayat Order</div>
    <div class="riwayat-sub">// tersimpan di perangkat ini</div>

    <div class="riwayat-stats">
      <div class="rw-stat s-total"><div class="rw-stat-label">Total</div><div class="rw-stat-val" id="rwTotal">0</div></div>
      <div class="rw-stat s-berhasil"><div class="rw-stat-label">Berhasil</div><div class="rw-stat-val" id="rwBerhasil">0</div></div>
      <div class="rw-stat s-pending"><div class="rw-stat-label">Pending</div><div class="rw-stat-val" id="rwPending">0</div></div>
    </div>

    <div class="riwayat-toolbar">
      <div class="rw-filter-tabs">
        <button class="rw-tab active" onclick="setRwFilter('semua',this)">Semua</button>
        <button class="rw-tab" onclick="setRwFilter('PENDING',this)">⏳ Pending</button>
        <button class="rw-tab" onclick="setRwFilter('BERHASIL',this)">✓ Berhasil</button>
        <button class="rw-tab" onclick="setRwFilter('GAGAL',this)">✕ Gagal</button>
      </div>
      <button class="btn-clear-riwayat" onclick="clearRiwayat()">🗑 Hapus</button>
    </div>

    <div class="riwayat-list" id="riwayatList"></div>
  </div>
</div>

<!-- ═══ ADMIN ═══ -->
<div class="page" id="page-admin">
  <div class="admin-header-bar">
    <div class="admin-title">⚙ Admin</div>
    <button class="btn-logout" onclick="logout()">⏏ Keluar</button>
  </div>

  <!-- Admin Tab Bar -->
  <div class="admin-tab-bar">
    <button class="admin-tab-btn active" id="atOrders" onclick="switchAdminTab('orders')">🛒 Orders</button>
    <button class="admin-tab-btn" id="atProduk" onclick="switchAdminTab('produk')">📦 Produk</button>
  </div>

  <!-- Orders Section -->
  <div class="admin-section active" id="as-orders">
  <div class="admin-stats">
    <div class="stat-card total"><div class="stat-label">Total</div><div class="stat-value total-v" id="statTotal">—</div></div>
    <div class="stat-card berhasil"><div class="stat-label">Berhasil</div><div class="stat-value berhasil-v" id="statBerhasil">—</div></div>
    <div class="stat-card pending"><div class="stat-label">Pending</div><div class="stat-value pending-v" id="statPending">—</div></div>
  </div>
  <div class="filter-tabs">
    <button class="filter-tab active" onclick="setFilter('semua',this)">Semua</button>
    <button class="filter-tab" onclick="setFilter('PENDING',this)">⏳ Pending</button>
    <button class="filter-tab" onclick="setFilter('BERHASIL',this)">✓ Berhasil</button>
    <button class="filter-tab" onclick="setFilter('GAGAL',this)">✕ Gagal</button>
  </div>
  <div class="admin-toolbar">
    <div class="live-badge" id="liveBadge" style="display:none"><div class="live-dot"></div> LIVE</div>
    <button class="btn-clear" onclick="clearAllOrders()">🗑 Hapus Semua</button>
  </div>
  <div class="orders-list" id="ordersList">
    <div class="loading-state"><div class="spinner"></div></div>
  </div>
  </div><!-- end as-orders -->

  <!-- Produk Section -->
  <div class="admin-section" id="as-produk">
    <button class="btn-add-produk" onclick="openProdukModal()">
      ＋ TAMBAH PRODUK BARU
    </button>
    <div class="produk-admin-grid" id="produkAdminGrid">
      <div class="loading-state" style="grid-column:1/-1"><div class="spinner"></div></div>
    </div>
  </div>

</div>

<!-- PRODUK MODAL -->
<div id="produkModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.92);backdrop-filter:blur(16px);z-index:8000;justify-content:center;align-items:flex-end;padding:0;">
  <div class="produk-modal-box">
    <div class="modal-handle"></div>
    <div class="modal-title" id="modalTitle">✚ Tambah Produk</div>
    <div class="input-row">
      <label class="input-label">Foto Produk</label>
      <label for="modalImgFile" class="img-upload-zone" id="modalImgZone">
        <div class="upload-hint" style="display:flex;flex-direction:column;align-items:center"><span style="font-size:28px;margin-bottom:8px">🖼</span>Tap untuk pilih foto produk</div>
      </label>
      <input type="file" id="modalImgFile" accept="image/*" onchange="handleModalImg(event)" style="position:absolute;left:-9999px;opacity:0;width:1px;height:1px;">
    </div>
    <div class="input-row">
      <label class="input-label">Nama Produk</label>
      <input type="text" class="input-field" id="modalNama" placeholder="Contoh: Megalodon...">
    </div>
    <div class="input-row">
      <label class="input-label">Harga (Rp)</label>
      <input type="number" class="input-field" id="modalHarga" placeholder="Contoh: 10000" min="0">
    </div>
    <div class="input-row">
      <label class="input-label">Deskripsi (opsional)</label>
      <input type="text" class="input-field" id="modalDeskripsi" placeholder="Contoh: Item langka S-tier...">
    </div>
    <div class="modal-btns">
      <button class="btn-modal-cancel" onclick="closeProdukModal()">Batal</button>
      <button class="btn-modal-save" id="btnModalSave" onclick="saveProduk()">💾 SIMPAN</button>
    </div>
  </div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="bottom-tab active" id="tabStore" onclick="showPage('store')">
    <div class="tab-icon">🛒</div>
    <div class="tab-label">Store</div>
  </button>
  <button class="bottom-tab" id="tabRiwayat" onclick="showPage('riwayat')" style="position:relative">
    <div class="tab-icon">📋</div>
    <div class="tab-label">Riwayat</div>
    <div class="tab-badge" id="rwBadge" style="display:none">0</div>
  </button>
</nav>

<!-- LIGHTBOX -->
<div id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">✕</button>
  <img id="lightboxImg" src="" alt="Bukti">
  <div class="lightbox-label" id="lightboxLabel"></div>
</div>

<!-- PIN POPUP -->
<div id="pwPopup">
  <div class="pw-box">
    <div class="pw-icon">🔐</div>
    <div class="pw-title">Admin Access</div>
    <div class="pw-sub">masukkan PIN untuk melanjutkan</div>
    <div class="pin-dots" id="pinDots">
      <div class="pin-dot" id="pd0"></div><div class="pin-dot" id="pd1"></div>
      <div class="pin-dot" id="pd2"></div><div class="pin-dot" id="pd3"></div>
    </div>
    <div class="numpad">
      <button class="num-btn" onclick="pinInput('1')">1</button><button class="num-btn" onclick="pinInput('2')">2</button><button class="num-btn" onclick="pinInput('3')">3</button>
      <button class="num-btn" onclick="pinInput('4')">4</button><button class="num-btn" onclick="pinInput('5')">5</button><button class="num-btn" onclick="pinInput('6')">6</button>
      <button class="num-btn" onclick="pinInput('7')">7</button><button class="num-btn" onclick="pinInput('8')">8</button><button class="num-btn" onclick="pinInput('9')">9</button>
      <button class="num-btn empty"></button><button class="num-btn" onclick="pinInput('0')">0</button><button class="num-btn del" onclick="pinDelete()">⌫</button>
    </div>
    <button class="pw-cancel" onclick="closePwPopup()">batal</button>
  </div>
</div>

<!-- QRIS -->
<div id="qrisPopup">
  <div class="qrisContent">
    <div class="qris-handle"></div>
    <h3>Scan QRIS</h3>
    <img src="img/qris.jpg" alt="QRIS">
    <div class="qris-amount" id="qrisAmount">Rp0</div>
    <div style="font-size:11px;color:rgba(255,255,255,0.3);letter-spacing:1px;font-family:'Share Tech Mono',monospace;">scan QR untuk membayar</div>
    <div class="qris-btns">
      <button class="btn-sudah" onclick="sudahBayar()">✓ Sudah Bayar</button>
      <button class="btn-tutup" onclick="tutupQR()">✕ Tutup</button>
    </div>
  </div>
</div>

<!-- MATRIX + PARTICLES -->
<script>
(function(){const c=document.getElementById('matrixCanvas'),ctx=c.getContext('2d');let cols,drops;const chars='アイウエオ0123456789ABCDEF'.split('');function resize(){c.width=window.innerWidth;c.height=window.innerHeight;cols=Math.floor(c.width/20);drops=Array(cols).fill(1);}function draw(){ctx.fillStyle='rgba(4,12,18,0.05)';ctx.fillRect(0,0,c.width,c.height);drops.forEach((y,i)=>{ctx.fillStyle=Math.random()>.95?'#fff':(Math.random()>.5?'rgba(0,255,225,0.85)':'rgba(0,180,200,0.4)');ctx.font='13px Share Tech Mono,monospace';ctx.fillText(chars[Math.floor(Math.random()*chars.length)],i*20,y*20);if(y*20>c.height&&Math.random()>.975)drops[i]=0;drops[i]++;});}resize();window.addEventListener('resize',resize);setInterval(draw,60);})();
(function(){const c=document.getElementById('particleCanvas'),ctx=c.getContext('2d');let p=[],mouse={x:-999,y:-999};function resize(){c.width=window.innerWidth;c.height=window.innerHeight;}resize();window.addEventListener('resize',resize);window.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY;});class P{constructor(){this.reset();}reset(){this.x=Math.random()*c.width;this.y=Math.random()*c.height;this.size=Math.random()*1.4+0.3;this.bx=this.x;this.by=this.y;this.vx=(Math.random()-.5)*.25;this.vy=(Math.random()-.5)*.25;this.op=Math.random()*.4+.08;this.col=Math.random()>.5?'0,255,225':'0,180,255';}update(){const dx=mouse.x-this.x,dy=mouse.y-this.y,d=Math.sqrt(dx*dx+dy*dy);if(d<80){const f=(80-d)/80;this.vx-=(dx/d)*f*.4;this.vy-=(dy/d)*f*.4;}this.vx+=(this.bx-this.x)*.002;this.vy+=(this.by-this.y)*.002;this.vx*=.96;this.vy*=.96;this.x+=this.vx;this.y+=this.vy;}draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle=`rgba(${this.col},${this.op})`;ctx.fill();}}for(let i=0;i<80;i++)p.push(new P());function animate(){ctx.clearRect(0,0,c.width,c.height);for(let i=0;i<p.length;i++)for(let j=i+1;j<p.length;j++){const dx=p[i].x-p[j].x,dy=p[i].y-p[j].y,d=Math.sqrt(dx*dx+dy*dy);if(d<85){ctx.beginPath();ctx.strokeStyle=`rgba(0,255,225,${.05*(1-d/85)})`;ctx.lineWidth=.5;ctx.moveTo(p[i].x,p[i].y);ctx.lineTo(p[j].x,p[j].y);ctx.stroke();}}p.forEach(pt=>{pt.update();pt.draw();});requestAnimationFrame(animate);}animate();})();
</script>

<script>
// ╔══════════════════════════╗
// ║  GANTI PIN DI SINI      ║
// ╚══════════════════════════╝
const ADMIN_PIN = '1212';

let dataOrder={}, allOrders=[], currentFilter='semua', rwFilter='semua';
let fbReady=false, isAdminLoggedIn=false, listenerStarted=false;

// ── Riwayat localStorage ──
const RW_KEY = 'neo_riwayat';

function getRiwayat() {
  try { return JSON.parse(localStorage.getItem(RW_KEY) || '[]'); } catch { return []; }
}

function saveToRiwayat(order) {
  const list = getRiwayat();
  // Update jika ID sudah ada, tambah jika belum
  const idx = list.findIndex(o => o.id === order.id);
  if (idx >= 0) list[idx] = order;
  else list.unshift(order); // terbaru di atas
  // Max 50 order tersimpan
  if (list.length > 50) list.splice(50);
  localStorage.setItem(RW_KEY, JSON.stringify(list));
  updateRwBadge();
}

function updateRwBadge() {
  const list = getRiwayat();
  const pending = list.filter(o => o.status === 'PENDING').length;
  const badge = document.getElementById('rwBadge');
  if (pending > 0) { badge.style.display = 'flex'; badge.textContent = pending; }
  else { badge.style.display = 'none'; }
}

// Sync status dari Firebase ke riwayat lokal
function syncRiwayatStatus(firebaseOrders) {
  const list = getRiwayat();
  let changed = false;
  list.forEach(local => {
    const fb = firebaseOrders.find(o => o.id === local.id);
    if (fb && fb.status !== local.status) {
      local.status = fb.status;
      changed = true;
    }
  });
  if (changed) {
    localStorage.setItem(RW_KEY, JSON.stringify(list));
    updateRwBadge();
    if (document.getElementById('page-riwayat').classList.contains('active')) renderRiwayat();
  }
}

// ── Firebase ──
window.addEventListener('firebase-ready', () => {
  fbReady = true;
  const text = Array.from(document.querySelectorAll('script[type="module"]')).map(s=>s.textContent).join('');
  const pid = text.match(/projectId:\s*"([^"]+)"/)?.[1];
  if (!pid || pid === 'GANTI_PROJECT_ID') { setFbStatus('error','belum config'); return; }
  setFbStatus('connected','online');
  startPublicSync();
  startProdukListener(); // Load produk realtime
});

function setFbStatus(type,text){
  const dot=document.getElementById('fbDot'),lbl=document.getElementById('fbStatusText');
  dot.className='fb-dot '+(type==='connected'?'connected':type==='error'?'error':'');
  lbl.textContent=text;
  lbl.style.color=type==='connected'?'var(--green)':type==='error'?'var(--red)':'rgba(255,255,255,0.3)';
}

// Listener publik untuk sync status order ke riwayat
function startPublicSync() {
  if (!window._fb) return;
  const { ordersRef, onSnapshot, query, orderBy } = window._fb;
  const q = query(ordersRef, orderBy('timestamp','desc'));
  onSnapshot(q, snap => {
    const fbOrders = snap.docs.map(d => ({ docId: d.id, ...d.data() }));
    // Selalu simpan allOrders, biar ready waktu admin login
    allOrders = fbOrders;
    syncRiwayatStatus(fbOrders);
    if (isAdminLoggedIn) {
      updateStats(); renderOrders();
      document.getElementById('liveBadge').style.display = 'inline-flex';
    }
  });
}

// ── Logo tap ──
let tapCount=0,tapTimer=null;
function handleLogoTap(){
  tapCount++;
  for(let i=0;i<5;i++) document.getElementById('td'+i).classList.toggle('active',i<tapCount);
  clearTimeout(tapTimer);
  tapTimer=setTimeout(()=>{ tapCount=0; for(let i=0;i<5;i++) document.getElementById('td'+i).classList.remove('active'); },2000);
  if(tapCount>=5){ tapCount=0; clearTimeout(tapTimer); for(let i=0;i<5;i++) document.getElementById('td'+i).classList.remove('active'); openPwPopup(); }
}

// ── PIN ──
let pinValue='';
function openPwPopup(){ pinValue=''; updatePinDots(); document.getElementById('pwPopup').style.display='flex'; }
function closePwPopup(){ pinValue=''; updatePinDots(); document.getElementById('pwPopup').style.display='none'; }
function pinInput(n){ if(pinValue.length>=4) return; pinValue+=n; updatePinDots(); if(pinValue.length===4) setTimeout(checkPin,200); }
function pinDelete(){ pinValue=pinValue.slice(0,-1); updatePinDots(); }
function updatePinDots(){ for(let i=0;i<4;i++){ const d=document.getElementById('pd'+i); d.classList.remove('filled','error'); if(i<pinValue.length) d.classList.add('filled'); } }
function checkPin(){
  if(pinValue===ADMIN_PIN){
    closePwPopup(); isAdminLoggedIn=true;
    showPage('admin'); showToast('✓ Selamat datang, Admin!');
    // Render semua admin panels dengan data yang sudah ada
    updateStats(); renderOrders();
    renderProdukAdmin();
    document.getElementById('liveBadge').style.display = 'inline-flex';
  } else {
    for(let i=0;i<4;i++){ const d=document.getElementById('pd'+i); d.classList.remove('filled'); d.classList.add('error'); }
    setTimeout(()=>{ pinValue=''; updatePinDots(); },800);
  }
}
function logout(){ isAdminLoggedIn=false; showPage('store'); showToast('⏏ Logout berhasil'); }

// ── Pages ──
function showPage(page){
  if(page==='admin'&&!isAdminLoggedIn){ openPwPopup(); return; }
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  document.getElementById('tabStore').classList.toggle('active',page==='store');
  document.getElementById('tabRiwayat').classList.toggle('active',page==='riwayat');
  if(page==='riwayat') renderRiwayat();
}

// ── Riwayat render ──
function setRwFilter(f,el){
  rwFilter=f;
  document.querySelectorAll('.rw-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  renderRiwayat();
}

function renderRiwayat() {
  const list = getRiwayat();
  const filtered = rwFilter === 'semua' ? list : list.filter(o => o.status === rwFilter);

  // Stats
  document.getElementById('rwTotal').textContent = list.length;
  document.getElementById('rwBerhasil').textContent = list.filter(o=>o.status==='BERHASIL').length;
  document.getElementById('rwPending').textContent = list.filter(o=>o.status==='PENDING').length;

  const container = document.getElementById('riwayatList');

  if (!filtered.length) {
    container.innerHTML = `
      <div class="riwayat-empty">
        <div class="riwayat-empty-icon">📭</div>
        ${list.length === 0 ? 'Belum ada order.<br><span style="font-size:11px">Yuk beli sesuatu!</span>' : 'Tidak ada order dengan filter ini.'}
      </div>`;
    return;
  }

  const icons = { BERHASIL:'✓', PENDING:'⏳', GAGAL:'✕' };
  const produkImg = { 'Batu Evo':'img/batu-evo.jpg', 'Secret Tumbal':'img/secret-tumbal.jpg', 'Maja Biru':'img/maja-biru.jpg', 'Maja Kuning':'img/maja-kuning.jpg', 'Megalodon':'img/megalodon.jpg' };

  container.innerHTML = filtered.map((o, i) => {
    const sc = (o.status||'PENDING').toLowerCase();
    const img = produkImg[o.produk] || '';
    const timeStr = o.waktu || '—';

    return `
      <div class="hc ${sc}" style="animation-delay:${i*0.06}s">
        <div class="hc-top">
          <span class="hc-id">${o.id||'—'}</span>
          <span class="hc-time">${timeStr.split(',')[0]||timeStr}</span>
        </div>
        <div class="hc-body">
          <div class="hc-icon" style="background-image:url('${img}')"></div>
          <div class="hc-info">
            <div class="hc-produk">${o.produk||'—'}</div>
            <div class="hc-detail">${o.jumlah||1}x · ${o.metode||'—'}</div>
          </div>
          <div class="hc-right">
            <div class="hc-total">Rp${(o.total||0).toLocaleString('id-ID')}</div>
            <div><span class="hc-badge ${sc}">${icons[o.status]||'?'} ${o.status||'PENDING'}</span></div>
          </div>
        </div>
        <div class="hc-toggle" id="toggle-${i}" onclick="toggleExpand(${i})">
          <span style="font-size:10px;letter-spacing:1px">DETAIL</span>
          <span class="hc-toggle-arrow">▼</span>
        </div>
        <div class="hc-expand" id="expand-${i}">
          <div class="hc-expand-grid">
            <div>
              <div class="hce-field-label">Username</div>
              <div class="hce-field-val">${o.username||'—'}</div>
            </div>
            <div>
              <div class="hce-field-label">Status</div>
              <div class="hce-field-val" style="color:${sc==='berhasil'?'var(--green)':sc==='gagal'?'var(--red)':'var(--orange)'}">${o.status||'PENDING'}</div>
            </div>
            <div>
              <div class="hce-field-label">Produk</div>
              <div class="hce-field-val">${o.produk||'—'}</div>
            </div>
            <div>
              <div class="hce-field-label">Jumlah</div>
              <div class="hce-field-val">${o.jumlah||1} pcs</div>
            </div>
            <div>
              <div class="hce-field-label">Total</div>
              <div class="hce-field-val" style="color:var(--neon)">Rp${(o.total||0).toLocaleString('id-ID')}</div>
            </div>
            <div>
              <div class="hce-field-label">Metode</div>
              <div class="hce-field-val">${o.metode||'—'}</div>
            </div>
          </div>
          <div class="hce-field-label" style="margin-bottom:4px">Waktu Order</div>
          <div class="hce-field-val" style="font-size:11px;margin-bottom:10px">${o.waktu||'—'}</div>
          ${o.status==='PENDING' ? `<button class="btn-recheck" onclick="recheckStatus('${o.id}')">🔄 Cek Status Terbaru</button>` : ''}
        </div>
      </div>`;
  }).join('');
}

function toggleExpand(i) {
  const exp = document.getElementById('expand-'+i);
  const tog = document.getElementById('toggle-'+i);
  exp.classList.toggle('open');
  tog.classList.toggle('open');
}

// Cek status terbaru dari Firebase ke riwayat lokal
async function recheckStatus(id) {
  if (!window._fb) { showToast('⚠ Tidak ada koneksi Firebase'); return; }
  showToast('🔄 Mengecek status...');
  const { ordersRef, query, orderBy } = window._fb;
  // Ambil dari allOrders yang sudah di-listen
  const found = allOrders.find ? allOrders.find(o => o.id === id) : null;
  if (found) {
    const list = getRiwayat();
    const idx = list.findIndex(o => o.id === id);
    if (idx >= 0 && list[idx].status !== found.status) {
      list[idx].status = found.status;
      localStorage.setItem(RW_KEY, JSON.stringify(list));
      renderRiwayat();
      showToast(`✓ Status diperbarui: ${found.status}`);
    } else {
      showToast(`Status: ${list[idx]?.status || 'PENDING'}`);
    }
  } else {
    showToast('ID tidak ditemukan di database');
  }
}

function clearRiwayat() {
  if (!confirm('Hapus semua riwayat di HP ini?')) return;
  localStorage.removeItem(RW_KEY);
  renderRiwayat();
  updateRwBadge();
  showToast('🗑 Riwayat dihapus.');
}

// ── Admin ──
function setFilter(f,el){ currentFilter=f; document.querySelectorAll('.filter-tab').forEach(t=>t.classList.remove('active')); el.classList.add('active'); renderOrders(); }
function updateStats(){ document.getElementById('statTotal').textContent=allOrders.length; document.getElementById('statBerhasil').textContent=allOrders.filter(o=>o.status==='BERHASIL').length; document.getElementById('statPending').textContent=allOrders.filter(o=>o.status==='PENDING').length; }
function renderOrders(){
  const list=document.getElementById('ordersList');
  let orders=currentFilter==='semua'?allOrders:allOrders.filter(o=>o.status===currentFilter);
  if(!orders.length){ list.innerHTML=`<div class="empty-state">[ BELUM ADA ORDER ]</div>`; return; }
  const icons={BERHASIL:'✓',PENDING:'⏳',GAGAL:'✕'};
  list.innerHTML=orders.map((o,i)=>{
    const sc=(o.status||'PENDING').toLowerCase();
    const act=o.status==='BERHASIL'?`<div class="oc-done">selesai ✓</div>`:o.status==='GAGAL'?`<div class="oc-done">ditolak ✕</div>`:`<div class="oc-actions"><button class="oc-btn confirm" onclick="adminConfirm('${o.docId}')">✓ KONFIRMASI</button><button class="oc-btn reject" onclick="adminReject('${o.docId}')">✕ TOLAK</button></div>`;
    return `<div class="order-card ${sc}" style="animation-delay:${i*.05}s">
      <div class="oc-header">
          <span class="oc-id">${o.id||'—'}</span>
          <div style="display:flex;align-items:center;gap:8px">
            ${o.buktiTransfer 
              ? '<img src="' + o.buktiTransfer + '" class="bukti-thumb" onclick="openLightbox(this.src,\'Bukti Transfer\')" title="Klik untuk lihat bukti">'
              : '<div class="no-bukti" title="Belum ada bukti">📷</div>'}
            <span class="oc-time">${o.waktu?o.waktu.split(' ')[1]||o.waktu:'—'}</span>
          </div>
        </div>
      <div class="oc-body">
        <div class="oc-user">👤 ${o.username||'—'}</div>
        <div class="oc-grid">
          <div class="oc-field"><div class="oc-field-label">Produk</div><div class="oc-field-value">${o.produk||'—'}</div></div>
          <div class="oc-field"><div class="oc-field-label">Jumlah</div><div class="oc-field-value">${o.jumlah||1} pcs</div></div>
          <div class="oc-field"><div class="oc-field-label">Metode</div><div class="oc-field-value">${o.metode||'—'}</div></div>
          <div class="oc-field"><div class="oc-field-label">Status</div><div><span class="status-badge ${sc}">${icons[o.status]||'?'} ${o.status||'PENDING'}</span></div></div>
        </div>
        <div class="oc-field"><div class="oc-field-label">Total</div><div class="oc-total">Rp${(o.total||0).toLocaleString('id-ID')}</div></div>
      </div>${act}</div>`;
  }).join('');
}

async function updateStatusFB(docId,status){ const{db,doc,updateDoc}=window._fb; await updateDoc(doc(db,'orders',docId),{status}); }
async function deleteOrderFB(docId){ const{db,doc,deleteDoc}=window._fb; await deleteDoc(doc(db,'orders',docId)); }
async function adminConfirm(docId){ await updateStatusFB(docId,'BERHASIL'); showToast('✓ Order dikonfirmasi!'); }
async function adminReject(docId){ await updateStatusFB(docId,'GAGAL'); showToast('✕ Order ditolak.'); }
async function clearAllOrders(){ if(!confirm('Hapus semua order?')) return; for(const o of allOrders) await deleteOrderFB(o.docId); showToast('🗑 Semua order dihapus.'); }


// ══════════════════════════════
// PRODUK MANAGEMENT
// ══════════════════════════════

let allProduks = [];
let editingProdukId = null;
let modalImgBase64 = null;
let selectedProduk = null;

// Listen produk dari Firebase (realtime)
function startProdukListener() {
  if (!window._fb) return;
  const { produksRef, onSnapshot } = window._fb;
  onSnapshot(produksRef, snap => {
    allProduks = snap.docs.map(d => ({ docId: d.id, ...d.data() }));
    // Sort by urutan/createdAt client side
    allProduks.sort((a,b) => (a.urutan||a.createdAt||0) - (b.urutan||b.createdAt||0));
    renderProdukStore();
    renderProdukAdmin();
    updateTestitProdukOptions();
  });
}

// Render produk di store (customer view)
function renderProdukStore() {
  const grid = document.getElementById('produkGrid');
  if (!allProduks.length) {
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:rgba(0,255,225,0.25);font-family:Share Tech Mono,monospace;font-size:12px;letter-spacing:2px">[ BELUM ADA PRODUK ]</div>';
    return;
  }
  grid.innerHTML = allProduks.map((p, i) => `
    <div class="card ${selectedProduk && selectedProduk.docId===p.docId ? 'selected' : ''}" id="pcard-${i}" onclick="selectProdukDynamic(${i})">
      ${p.gambar
        ? `<div class="card-img" style="background-image:url('${p.gambar}')"></div>`
        : `<div class="card-img" style="background:rgba(0,255,225,0.05);display:flex;align-items:center;justify-content:center;font-size:40px">📦</div>`}
      <div class="card-overlay"></div>
      <span class="card-select-badge">✓</span>
      <div class="card-content">
        <div class="card-name">${p.nama||'—'}</div>
        <div class="card-price">Rp${(p.harga||0).toLocaleString('id-ID')}</div>
      </div>
    </div>`).join('');
}

// Select produk dari dynamic grid
function selectProdukDynamic(idx) {
  const p = allProduks[idx];
  if (!p) return;
  selectedProduk = p;
  document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
  document.getElementById('pcard-' + idx)?.classList.add('selected');
  dataOrder.id = generateId();
  dataOrder.produk = p.nama;
  dataOrder.harga = p.harga;
  dataOrder.gambar = p.gambar || '';
  document.getElementById('selectedBanner').classList.add('visible');
  document.getElementById('selectedName').textContent = p.nama;
  document.getElementById('selectedPriceTag').textContent = 'Rp' + p.harga.toLocaleString('id-ID');
  updateTotal();
  document.querySelector('.order-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Render produk di admin panel
function renderProdukAdmin() {
  const grid = document.getElementById('produkAdminGrid');
  if (!allProduks.length) {
    grid.innerHTML = '<div class="produk-empty-state">[ BELUM ADA PRODUK ]<br><span style="font-size:11px;opacity:0.5">Klik + Tambah Produk Baru</span></div>';
    return;
  }
  grid.innerHTML = allProduks.map((p, i) => `
    <div class="produk-admin-card" style="animation-delay:${i*0.06}s">
      ${p.gambar
        ? `<img class="pac-img" src="${p.gambar}" alt="${p.nama}">`
        : `<div class="pac-img-placeholder">📦</div>`}
      <div class="pac-body">
        <div class="pac-name">${p.nama||'—'}</div>
        <div class="pac-price">Rp${(p.harga||0).toLocaleString('id-ID')}</div>
        <div class="pac-actions">
          <button class="pac-btn edit" onclick="editProduk('${p.docId}')">✏ Edit</button>
          <button class="pac-btn del" onclick="deleteProduk('${p.docId}','${p.nama}')">🗑 Hapus</button>
        </div>
      </div>
    </div>`).join('');
}

// Update dropdown produk di form testimoni
function updateTestitProdukOptions() {
  const sel = document.getElementById('testiProduk');
  if (!sel) return;
  const current = sel.value;
  // Keep default option
  sel.innerHTML = '<option value="">Pilih produk...</option>';
  allProduks.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p.nama; opt.textContent = p.nama;
    if (p.nama === current) opt.selected = true;
    sel.appendChild(opt);
  });
}

// ── Modal ──
function openProdukModal(docId) {
  editingProdukId = docId || null;
  modalImgBase64 = null;

  // Reset form
  document.getElementById('modalNama').value = '';
  document.getElementById('modalHarga').value = '';
  document.getElementById('modalDeskripsi').value = '';
  document.getElementById('modalImgFile').value = '';

  // Reset image zone
  const zone = document.getElementById('modalImgZone');
  const existingImg = zone.querySelector('img.preview-img');
  if (existingImg) existingImg.remove();
  zone.querySelector('.upload-hint').style.display = 'flex';

  if (docId) {
    // Edit mode — prefill
    const p = allProduks.find(x => x.docId === docId);
    if (p) {
      document.getElementById('modalTitle').textContent = '✏ Edit Produk';
      document.getElementById('modalNama').value = p.nama || '';
      document.getElementById('modalHarga').value = p.harga || '';
      document.getElementById('modalDeskripsi').value = p.deskripsi || '';
      if (p.gambar) {
        modalImgBase64 = p.gambar;
        showModalImgPreview(p.gambar);
      }
    }
  } else {
    document.getElementById('modalTitle').textContent = '✚ Tambah Produk';
  }

  document.getElementById('produkModal').style.display = 'flex';
}

function closeProdukModal() {
  document.getElementById('produkModal').style.display = 'none';
  editingProdukId = null;
  modalImgBase64 = null;
}

function handleModalImg(e) {
  const file = e.target.files[0];
  if (!file) return;
  compressImage(file, (b64) => {
    modalImgBase64 = b64;
    showModalImgPreview(b64);
  });
}

function showModalImgPreview(src) {
  const zone = document.getElementById('modalImgZone');
  const hint = zone.querySelector('.upload-hint');
  if (hint) hint.style.display = 'none';
  let img = zone.querySelector('img.preview-img');
  if (!img) { img = document.createElement('img'); img.className = 'preview-img'; zone.insertBefore(img, hint); }
  img.src = src;
}

async function saveProduk() {
  const nama = document.getElementById('modalNama').value.trim();
  const harga = parseInt(document.getElementById('modalHarga').value) || 0;
  const deskripsi = document.getElementById('modalDeskripsi').value.trim();

  if (!nama) { showToast('⚠ Nama produk wajib diisi!'); return; }
  if (!harga) { showToast('⚠ Harga wajib diisi!'); return; }

  const btn = document.getElementById('btnModalSave');
  btn.disabled = true; btn.textContent = 'MENYIMPAN...';

  const data = {
    nama, harga, deskripsi,
    gambar: modalImgBase64 || '',
    urutan: editingProdukId ? (allProduks.find(p=>p.docId===editingProdukId)?.urutan || Date.now()) : Date.now(),
    updatedAt: Date.now()
  };

  try {
    const { db, doc, updateDoc, addDoc, produksRef } = window._fb;
    if (editingProdukId) {
      await updateDoc(doc(db, 'produks', editingProdukId), data);
      showToast('✓ Produk diperbarui!');
    } else {
      await addDoc(produksRef, { ...data, createdAt: Date.now() });
      showToast('✓ Produk ditambahkan!');
    }
    closeProdukModal();
  } catch(e) { showToast('⚠ Gagal: ' + e.message); }

  btn.disabled = false; btn.textContent = '💾 SIMPAN';
}

function editProduk(docId) { openProdukModal(docId); }

async function deleteProduk(docId, nama) {
  if (!confirm('Hapus produk "' + nama + '"?')) return;
  const { db, doc, deleteDoc } = window._fb;
  await deleteDoc(doc(db, 'produks', docId));
  showToast('🗑 Produk dihapus.');
}

// ── Admin tab switch ──
function switchAdminTab(tab) {
  document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('as-' + tab).classList.add('active');
  document.getElementById('at' + (tab === 'orders' ? 'Orders' : 'Produk')).classList.add('active');
}

// ── Store ──
function selectProduct(produk, emoji, harga, idx){
  document.querySelectorAll('.card').forEach(c=>c.classList.remove('selected'));
  document.getElementById('card-'+idx).classList.add('selected');
  dataOrder.id=generateId(); dataOrder.produk=produk; dataOrder.harga=harga; dataOrder.emoji=emoji;
  document.getElementById('selectedBanner').classList.add('visible');
  document.getElementById('selectedName').textContent=produk;
  document.getElementById('selectedPriceTag').textContent='Rp'+harga.toLocaleString('id-ID');
  updateTotal();
  document.querySelector('.order-section').scrollIntoView({behavior:'smooth',block:'start'});
}

function updateTotal(){
  const j=parseInt(document.getElementById('jumlah').value)||1;
  const h=dataOrder.harga||0,t=j*h;
  dataOrder.total=t; dataOrder.jumlah=j;
  document.getElementById('totalBox').textContent='Rp'+t.toLocaleString('id-ID');
  if(dataOrder.produk){
    const sb=document.getElementById('summaryBox'); sb.classList.add('visible');
    sb.innerHTML=`<strong style="color:var(--neon);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px">RINGKASAN</strong><br><br>Produk : <strong style="color:#fff">${dataOrder.produk}</strong><br>Harga &nbsp;: Rp${h.toLocaleString('id-ID')}<br>Jumlah : ${j} pcs<br>Total &nbsp;: <strong style="color:var(--neon)">Rp${t.toLocaleString('id-ID')}</strong>`;
    document.getElementById('idPembayaranBox').textContent='🔑 '+dataOrder.id;
  }
}

function generateId(){ return 'NEO-'+Date.now().toString(36).toUpperCase()+'-'+Math.random().toString(36).slice(2,5).toUpperCase(); }

async function submitOrder(){
  if(!dataOrder.produk){ showToast('⚠ Pilih produk dulu!'); return; }
  const metode=document.getElementById('metode').value;
  if(!metode){ showToast('⚠ Pilih metode pembayaran!'); return; }
  const username=document.getElementById('username').value.trim();
  if(!username){ showToast('⚠ Masukkan username!'); return; }

  dataOrder.username=username;
  dataOrder.jumlah=parseInt(document.getElementById('jumlah').value)||1;
  dataOrder.total=dataOrder.jumlah*dataOrder.harga;
  dataOrder.metode=metode;
  dataOrder.status='PENDING';
  dataOrder.waktu=new Date().toLocaleString('id-ID');

  const btn=document.getElementById('btnOrder');
  btn.disabled=true; btn.textContent='MENYIMPAN...';

  try {
    if(fbReady&&window._fb){
      const{ordersRef,addDoc}=window._fb;
      await addDoc(ordersRef,{...dataOrder,timestamp:Date.now()});
      // Simpan ke riwayat lokal juga!
      saveToRiwayat({...dataOrder});
      showToast('✓ Order berhasil! Tersimpan di Riwayat 📋');
      showUploadSection(dataOrder.id);
    } else {
      saveToRiwayat({...dataOrder});
      showToast('✓ Order tersimpan di Riwayat!');
    }
  } catch(e) { showToast('⚠ '+e.message); }

  btn.disabled=false; btn.textContent='ORDER SEKARANG';

  if(metode==='QRIS'){
    document.getElementById('qrisAmount').textContent='Rp'+dataOrder.total.toLocaleString('id-ID');
    document.getElementById('qrisPopup').style.display='flex';
  } else { kirimWA(metode); }
}

function kirimWA(m){ const p=`Halo Admin, saya mau beli:\n\n🔑 ID: ${dataOrder.id}\n👤 Username: ${dataOrder.username}\n📦 Produk: ${dataOrder.produk}\n🔢 Jumlah: ${dataOrder.jumlah}\n💰 Total: Rp${dataOrder.total.toLocaleString('id-ID')}\n💳 Metode: ${m}\n\nTerimakasih sudah order di NEOSTORE ⚡`; window.open('https://wa.me/6281328941033?text='+encodeURIComponent(p),'_blank'); }
function tutupQR(){ document.getElementById('qrisPopup').style.display='none'; }

async function sudahBayar(){
  tutupQR();
  const o=allOrders.find(o=>o.id===dataOrder.id);
  if(o){ await updateStatusFB(o.docId,'BERHASIL'); saveToRiwayat({...dataOrder,status:'BERHASIL'}); }
  kirimWA('QRIS');
  showToast('✓ Pembayaran berhasil!');
}

function cekStatus(){
  const id=document.getElementById('cekId').value.trim();
  const hasil=document.getElementById('hasilCek');
  if(!id){ hasil.innerHTML='<span style="color:rgba(255,255,255,0.3)">Masukkan ID.</span>'; return; }
  // Cek dari riwayat lokal dulu
  const local=getRiwayat().find(o=>o.id===id);
  if(local){
    const colors={BERHASIL:'var(--green)',PENDING:'var(--orange)',GAGAL:'var(--red)'};
    const icons={BERHASIL:'✓',PENDING:'⏳',GAGAL:'✕'};
    hasil.innerHTML=`<span style="color:${colors[local.status]}">${icons[local.status]} ${id} — <strong>${local.status}</strong></span><br><span style="font-size:11px;color:rgba(255,255,255,0.4)">${local.produk} x${local.jumlah} · Rp${local.total.toLocaleString('id-ID')}</span>`;
  } else {
    hasil.innerHTML=`<span style="color:var(--red)">✕ ID tidak ditemukan</span>`;
  }
}

function showToast(msg){ document.querySelectorAll('.toast').forEach(t=>t.remove()); const t=document.createElement('div'); t.className='toast'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>{t.style.transition='opacity 0.4s';t.style.opacity='0';setTimeout(()=>t.remove(),400);},3500); }
document.getElementById('jumlah').addEventListener('input',updateTotal);

// ══════════════════════════════
// UPLOAD BUKTI TRANSFER
// ══════════════════════════════

let buktiBase64 = null;

// Show upload section after order
function showUploadSection(orderId) {
  const sec = document.getElementById('uploadSection');
  sec.style.display = 'block';
  document.getElementById('uploadOrderId').value = orderId || '';
  sec.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function autofillOrderId() {
  if (dataOrder.id) {
    document.getElementById('uploadOrderId').value = dataOrder.id;
    showToast('✓ ID terisi otomatis!');
  } else {
    showToast('⚠ Belum ada order aktif');
  }
}

function handleFileSelect(e) {
  const file = e.target.files[0];
  if (!file) return;
  if (file.size > 5 * 1024 * 1024) { showToast('⚠ Foto terlalu besar! Maks 5MB'); return; }
  compressImage(file, (compressed) => {
    buktiBase64 = compressed;
    document.getElementById('buktiPreview').classList.add('visible');
    document.getElementById('buktiPreviewImg').src = compressed;
    document.getElementById('dropZone').style.display = 'none';
  });
}

function removeBukti() {
  buktiBase64 = null;
  document.getElementById('buktiPreview').classList.remove('visible');
  document.getElementById('buktiPreviewImg').src = '';
  document.getElementById('dropZone').style.display = 'block';
  document.getElementById('buktiFile').value = '';
}

// Compress image to base64 — max 600px wide, quality 0.65
function compressImage(file, callback) {
  const reader = new FileReader();
  reader.onload = (e) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      const MAX = 600;
      let w = img.width, h = img.height;
      if (w > MAX) { h = Math.round(h * MAX / w); w = MAX; }
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, w, h);
      callback(canvas.toDataURL('image/jpeg', 0.65));
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

async function submitBukti() {
  const orderId = document.getElementById('uploadOrderId').value.trim();
  if (!orderId) { showToast('⚠ Masukkan ID Order!'); return; }
  if (!buktiBase64) { showToast('⚠ Pilih foto bukti dulu!'); return; }
  if (!window._fb) { showToast('⚠ Tidak ada koneksi Firebase'); return; }

  const btn = document.getElementById('btnUpload');
  btn.disabled = true; btn.textContent = 'MENGIRIM...';

  // Show progress
  const prog = document.getElementById('uploadProgress');
  const fill = document.getElementById('progressFill');
  const label = document.getElementById('progressLabel');
  prog.classList.add('visible');

  // Simulate compress progress
  fill.style.width = '30%'; label.textContent = 'Mengkompres foto...';
  await new Promise(r => setTimeout(r, 400));
  fill.style.width = '60%'; label.textContent = 'Mengunggah ke server...';

  try {
    // Find order in Firebase and attach bukti
    const order = allOrders.find(o => o.id === orderId);
    if (!order) {
      showToast('⚠ ID Order tidak ditemukan!');
      prog.classList.remove('visible');
      btn.disabled = false; btn.textContent = '📤 KIRIM BUKTI BAYAR';
      return;
    }

    const { db, doc, updateDoc } = window._fb;
    await updateDoc(doc(db, 'orders', order.docId), {
      buktiTransfer: buktiBase64,
      buktiWaktu: new Date().toLocaleString('id-ID')
    });

    fill.style.width = '100%'; label.textContent = 'Berhasil dikirim! ✓';
    await new Promise(r => setTimeout(r, 800));

    // Update local riwayat too
    const rwList = getRiwayat();
    const rwIdx = rwList.findIndex(o => o.id === orderId);
    if (rwIdx >= 0) { rwList[rwIdx].buktiTransfer = buktiBase64; localStorage.setItem(RW_KEY, JSON.stringify(rwList)); }

    showToast('✓ Bukti terkirim! Membuka WhatsApp...');
    prog.classList.remove('visible');
    fill.style.width = '0%';
    removeBukti();
    document.getElementById('uploadSection').style.display = 'none';
    // Buka WA setelah bukti terkirim
    setTimeout(() => kirimWA(dataOrder.metode), 800);

  } catch(e) {
    showToast('⚠ Gagal kirim: ' + e.message);
    prog.classList.remove('visible');
  }

  btn.disabled = false; btn.textContent = '📤 KIRIM BUKTI BAYAR';
}

// Lightbox
function openLightbox(src, label) {
  document.getElementById('lightboxImg').src = src;
  document.getElementById('lightboxLabel').textContent = label || '';
  document.getElementById('lightbox').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  document.getElementById('lightbox').style.display = 'none';
  document.body.style.overflow = '';
}

// Drag & drop
const dz = document.getElementById('dropZone');
if (dz) {
  dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('dragover'); });
  dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
  dz.addEventListener('drop', e => {
    e.preventDefault(); dz.classList.remove('dragover');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) {
      const fakeEvent = { target: { files: [file] } };
      handleFileSelect(fakeEvent);
    }
  });
}


// ── Payment method card ──
document.getElementById('metode').addEventListener('change', function() {
  // Hide all cards
  document.querySelectorAll('.payment-card').forEach(c => c.classList.remove('visible'));
  // Show selected
  const sel = this.value;
  if (sel) {
    const card = document.getElementById('pm-' + sel);
    if (card) card.classList.add('visible');
  }
});

function copyNomor(nomor, btn) {
  const clean = nomor.replace(/-/g, '');
  navigator.clipboard.writeText(clean).then(() => {
    const orig = btn.textContent;
    btn.textContent = '✓ Tersalin!';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 2000);
  }).catch(() => {
    // Fallback
    const el = document.createElement('textarea');
    el.value = clean; document.body.appendChild(el);
    el.select(); document.execCommand('copy');
    document.body.removeChild(el);
    btn.textContent = '✓ Tersalin!';
    setTimeout(() => { btn.textContent = '📋 Salin Nomor'; }, 2000);
  });
}

// Helper: trigger file input (works on all mobile browsers)
function triggerFileInput(id) {
  document.getElementById(id).click();
}

// Init
updateRwBadge();
</script>
</body>
  </html>
  